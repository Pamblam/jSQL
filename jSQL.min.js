/*! jsql-official - v3.2.2 */
!function(){var isNode=!("undefined"==typeof module||!module.exports),jSQL=function(){"use strict";function jSQL_Error(e){this.error=e,this.stack=void 0;var t=new Error;t.stack&&(this.stack=t.stack),jSQL_Error.message_codes[e]?this.message=jSQL_Error.message_codes[e]:this.message="Unknown error.",this.toString=function(){return void 0===this.error?"jSQL Error - "+this.message:"jSQL Error #"+this.error+" - "+this.message}}jSQL_Error.message_codes={"0001":"Corrupted function stored in data.","0003":"Invalid datatype definition.","0004":"DataType must have a `type` property.","0005":"DataType must have a `serialize` function.","0006":"DataType must have an `unserialize` function.","0007":"Unsupported data type.","0010":"Invalid constraint.","0011":"This table already has a primary key.","0012":"renameColumn expects and old column name and a new one, both must be strings.","0013":"Column does not exist.","0014":"Data must be an array.","0015":"Data not structured properly.","0016":"Cannot insert a null value in a primary column.","0017":"Primary Key violated.","0018":"Cannot insert a null value in a unique column.","0019":"Unique key violated.","0020":"Data type's serialize() method did not return a string.","0021":"Table does not exist.","0022":"Method does not apply to query type.","0023":"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or undefined.","0024":"Expected number or quoted string.","0025":"Expected 'ORDER BY'.","0026":"Must call ORDER BY before using ASC.","0027":"Must call ORDER BY before using DESC.","0028":"Unintelligible query. Expected 'FROM'.","0029":"Unintelligible query. Expected 'TABLE'.","0030":"Unintelligible query. Expected 'INTO'.","0031":"Unintelligible query. Expected 'VALUES'.","0032":"Unintelligible query. Too many values.","0033":"Unintelligible query. Columns mismatch.","0034":"Invalid Column definition.","0035":"Unintelligible query. Expected 'NOT'.","0036":"Unintelligible query. Expected 'EXISTS'.","0037":"Unintelligible query. expected ')'.","0038":"Invalid Arg definition.","0039":"Unintelligible query. Expected 'SET'.","0040":"Unintelligible query. Expected 'FROM'.","0041":"Unintelligible query. WTF?","0042":"Must add a conditional before adding another 'Where' condition.","0043":"Column name must be a string.","0044":"Must add a 'where' clause before the 'equals' call.","0045":"Must add a 'where' clause before the 'preparedLike' call.","0046":"Must add a 'where' clause before the 'doesNotEqual' call.","0047":"Must add a 'where' clause before the 'lessThan' call.","0048":"Must add a 'where' clause before the 'greaterThan' call.","0049":"Must add a 'where' clause before the 'contains' call.","0050":"Must add a 'where' clause before the 'endsWith' call.","0051":"Must add a 'where' clause before the 'beginsWith' call.","0052":"Must use orderBy clause before using ASC.","0053":"Must use orderBy clause before using DESC.","0054":"Could not execute query.","0055":"Error creating table.","0056":"Error opening database.","0057":"indexedDB is not supported in this browser.","0058":"Could not add data after 10 seconds.","0059":"Error updating datastore version.","0060":"Could not connect to the indexedDB datastore.","0061":"Could not initiate a transaction.","0062":"Could not initiate a request.","0063":"Browser doesn't support Web SQL or IndexedDB.","0064":"Unable towrite to datastore file.","0065":"AUTO_INCREMENT column must be a key.","0066":"AUTO_INCREMENT column must be an INT type.","0067":"API is out of memory, cannot store more data.","0068":"Invalid ENUM value.","0069":"NUMERIC or INT type invalid or out of range.","0070":"Unknown Lexer Error.","0071":"Unknown Parser Error.","0072":"Inserting null into a non-null column."};function jSQL_Lexer_Error(e,t){var r=t.length>e+25?25:t.length-e,n=t.substr(e,r);this.error="0070",this.message="Unknown token near char "+e+" of "+t.length+' "'+n+'".',this.stack=void 0;var i=new Error;i.stack&&(this.stack=i.stack),this.toString=function(){return"jSQL Lexer Error #"+this.error+" - "+this.message}}function jSQL_Parse_Error(e,t){this.error="0071",this.message="Unexpected "+e.type+" ("+e.name+") at character "+e.input_pos+".",t&&(this.message+=" Expected "+t+"."),this.stack=void 0;var r=new Error;r.stack&&(this.stack=r.stack),this.toString=function(){return"jSQL Parse Error #"+this.error+" - "+this.message}}var error_handler_function=function(){},mute_jsql_errors=!1;function _throw(e,t){throw!0!==t&&!0!==mute_jsql_errors&&error_handler_function(e),e}function onError(e){"function"==typeof e&&(error_handler_function=e)}function jSQLDataTypeList(){this.list=[{type:"NUMERIC",aliases:["NUMBER","DECIMAL","FLOAT"],serialize:function(e,t){return null===e&&(e=0),!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))}},{type:"ENUM",serialize:function(e,t){if(null===e)return"jsqlNull";for(var r=t.length;r--;)if(e===removeQuotes(t[r]))return e;return _throw(new jSQL_Error("0068"))},unserialize:function(e,t){if("jsqlNull"===e)return null;for(var r=t.length;r--;)if(e===removeQuotes(t[r]))return e;return _throw(new jSQL_Error("0068"))}},{type:"TINYINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&e>=-128&&e<=127?parseInt(e):0},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0}},{type:"SMALLINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&e>=-32768&&e<=32767?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"MEDIUMINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&e>=-8388608&&e<=8388607?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"INT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&e>=-2147483648&&e<=2147483647?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"BIGINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&e>=-9007199254740991&&e<=9007199254740991?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"JSON",aliases:["ARRAY","OBJECT"],serialize:function(e){return null===e?"jsqlNull":"string"==typeof e?e:JSON.stringify(e)},unserialize:function(e){return"jsqlNull"===e?null:JSON.parse(e)}},{type:"FUNCTION",serialize:function(value){if(null===value)return"jsqlNull";if("function"!=typeof value){var f=null;try{eval("f = "+value)}catch(e){}"function"==typeof f?value=f:_throw(new jSQL_Error("0001"))}return"jSQLFunct-"+value.toString()},unserialize:function(value){if("jsqlNull"===value)return null;var p=value.split("-");if("jSQLFunct"!==p.shift())return _throw(new jSQL_Error("0001"));p=value.split("-"),p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}return"function"==typeof f?f:_throw(new jSQL_Error("0001"))}},{type:"BOOLEAN",aliases:["BOOL"],serialize:function(e){return null===e?"jsqlNull":!0===e||"TRUE"==e.toUpperCase()||1==e?"1":"0"},unserialize:function(e){return"jsqlNull"===e?null:!0===e||"TRUE"==e.toUpperCase()||1==e}},{type:"CHAR",serialize:function(e,t){return null===e?"jsqlNull":""+e},unserialize:function(e,t){if("jsqlNull"===e)return null;var r=t[0]>>0,n=" ";return e.length>r?e.substr(0,t[0]):((r-=e.length)>n.length&&(n+=n.repeat(r/n.length)),String(e)+n.slice(0,r))}},{type:"VARCHAR",aliases:["LONGTEXT","MEDIUMTEXT"],serialize:function(e,t){return null===e?"jsqlNull":""+e},unserialize:function(e,t){return"jsqlNull"===e?null:""+e}},{type:"DATE",serialize:function(e){return null===e?"jsqlNull":e instanceof Date?e.getTime():new Date(e).getTime()},unserialize:function(e){return"jsqlNull"===e?null:new Date(e)}},{type:"AMBI",serialize:function(e){return null===e?"jsqlNull":e instanceof Date?e.getTime():"function"==typeof e?"jSQLFunct-"+e.toString():!isNaN(parseFloat(e))&&isFinite(e)?e:""+e},unserialize:function(value){if("jsqlNull"===value)return null;if("string"==typeof value&&"jSQLFunct"===value.split("-")[0]){var p=value.split("-");p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f}return value}}],this.add=function(e){return"object"!=typeof e?_throw(new jSQL_Error("0003")):void 0===e.type?_throw(new jSQL_Error("0004")):"function"!=typeof e.serialize?_throw(new jSQL_Error("0005")):"function"!=typeof e.unserialize?_throw(new jSQL_Error("0006")):void this.list.push({type:e.type.toUpperCase(),aliases:Array.isArray(e.aliases)?e.aliases:[],serialize:e.serialize,unserialize:e.unserialize})},this.exists=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return!0;return!1},this.getByType=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return this.list[t];return _throw(new jSQL_Error("0007"))}}function jSQLTable(e,t,r,n,i,s){if(this.name="",this.columns=[],this.data=[],this.colmap={},this.types=[],this.auto_inc_col=!1,this.auto_inc_seq=0,this.keys={primary:{column:!1,map:{}},unique:[]},this.name=e,void 0===n&&(n=[]),Array.isArray(t)&&void 0===r&&(r=t,t=[]),Array.isArray(t)&&!Array.isArray(t[0])&&"object"==typeof t[0]){var a,o=[];for(a in t[0])t[0].hasOwnProperty(a)&&o.push(a);r=t,t=o}this.initColumns(t,n),this.initKeys(i,s),this.initAI(s),void 0!==r&&this.loadData(r)}jSQLTable.prototype.initColumns=function(e,t){this.columns=e;var r;for(r=0;r<e.length;r++)this.types[r]=void 0===t[r]||void 0===t[r].type?{type:"ambi",args:[],default:void 0,null:!0}:t[r];for(r=this.types.length;r--;){var n=this.types[r].type.toUpperCase();if(!jSQL.types.exists(n))return _throw(new jSQL_Error("0007"));this.types[r].type=n}for(r=0;r<e.length;r++)this.colmap[e[r]]=r},jSQLTable.prototype.initKeys=function(e){for(var t,r=["primary","unique"],n=0;n<e.length;n++){if(!(t=e[n]).hasOwnProperty("column")||!Array.isArray(t.column)&&-1===this.columns.indexOf(t.column))return _throw(new jSQL_Error("0010"));if(Array.isArray(t.column))for(var i=0;i<t.column.length;i++)if(-1===this.columns.indexOf(t.column[i]))return _throw(new jSQL_Error("0010"));var s=t.hasOwnProperty("type")&&-1!==r.indexOf(t.type.toLowerCase())?t.type.toLowerCase():"unique";if("primary"===s&&!1!==this.keys.primary.column)return _throw(new jSQL_Error("0011"));"primary"===s&&(this.keys.primary.column=t.column),"unique"===s&&this.keys.unique.push({column:t.column,map:{}})}},jSQLTable.prototype.initAI=function(e){if(e){for(var t=Array.isArray(this.keys.primary.column)&&this.keys.primary.column.indexOf(e)>-1,r=this.keys.primary.column===e,n=!1,i=this.keys.unique.length;i--;){var s=Array.isArray(this.keys.unique[i].column)&&this.keys.unique[i].column.indexOf(e)>-1,a=this.keys.unique[i].column===e;(s||a)&&(n=!0)}if(!(t||r||n))return _throw(new jSQL_Error("0065"));if("INT"!==this.types[this.colmap[e]].type)return _throw(new jSQL_Error("0066"));this.auto_inc_col=e}},jSQLTable.prototype.renameColumn=function(e,t){if(void 0===e||"string"!=typeof t)return _throw(new jSQL_Error("0012"));if(this.columns.indexOf(e)<0)return _throw(new jSQL_Error("0013"));if(this.columns.splice(this.columns.indexOf(e),1,t),this.keys.primary.column===e&&(this.keys.primary.column=t),Array.isArray(this.keys.primary.column))for(var r=this.keys.primary.column.length;r--;)this.keys.primary.column[r]===e&&(this.keys.primary.column[r]=t);for(var n=this.keys.unique.length;n--;)if(this.keys.unique[n].column===e&&(this.keys.unique[n].column=t),Array.isArray(this.keys.unique[n].column))for(r=this.keys.unique[n].column.length;r--;)this.keys.unique[n].column[r]===e&&(this.keys.unique[n].column[r]=t);var i={};for(var s in this.colmap)this.colmap.hasOwnProperty(s)&&(s===e?i[t]=this.colmap[s]:i[s]=this.colmap[s]);this.colmap=i,this.auto_inc_col===e&&(this.auto_inc_col=t)},jSQLTable.prototype.addColumn=function(e,t,r){if(void 0!==r&&void 0!==r.type||(r={type:"AMBI",args:[],null:!0,default:void 0}),r.type=r.type.toUpperCase(),void 0===t&&(t=null),"string"!=typeof e){var n=this;e=function e(t){for(var r=0;r<n.columns.length;r++)if(n.columns[r]==="u"+t)return e(t+1);return"u"+t}(0)}this.columns.push(e);for(var i=this.data.length;i--;)this.data[i].push(t);if(this.colmap[e]=this.columns.length-1,!jSQL.types.exists(r.type))return _throw(new jSQL_Error("0007"));this.types.push(r)},jSQLTable.prototype.loadData=function(e){if(!Array.isArray(e))return _throw(new jSQL_Error("0014"));for(var t=e.length;t--;)this.insertRow(e[t])},jSQLTable.prototype.normalizeInsertRowData=function(e){var t,r=[];if(Array.isArray(e)){for(;e.length>this.columns.length;)this.addColumn();for(;e.length<this.columns.length;)e.push(null);for(t=0;t<e.length;t++)r.push(e[t]);for(;r.length<this.columns.length;)r.push(null)}else{if("object"!=typeof e)return _throw(new jSQL_Error("0015"));for(t=0;t<this.columns.length;t++)void 0===e[this.columns[t]]&&(e[this.columns[t]]=null);var n=this;for(var i in e)if(!e.hasOwnProperty(i))continue;if(function(e){for(;e--;)if(n.columns[e]===i)return 0;return 1}(this.columns.length))if(this.columns.indexOf("u0")>-1){this.renameColumn("u0",i);for(;this.columns.indexOf("u1")>-1;)this.renameColumn("u1","u0")}else this.addColumn(i);for(t=0;t<this.columns.length;t++)r.push(e[this.columns[t]])}return r},jSQLTable.prototype.insertRow=function(e,t){for(var r=this.normalizeInsertRowData(e),n=r.length;n--;)this.columns[n]===this.auto_inc_col&&(r[n]||(r[n]=this.auto_inc_seq,this.auto_inc_seq++),r[n]>=this.auto_inc_seq&&(this.auto_inc_seq=parseInt(r[n],10)+1)),r[n]=this.normalizeColumnStoreValue(this.columns[n],r[n]);if(!1===this.updateKeysOnInsert(r,t))return!1;this.data.push(r)},jSQLTable.prototype.updateKeysOnInsert=function(e,t){if(this.keys.primary.column){for(var r,n=Array.isArray(this.keys.primary.column)?this.keys.primary.column:[this.keys.primary.column],i=[],s=0;s<n.length;s++){r=n[s];var a=this.colmap[r];if(null===e[a])return!0!==t&&_throw(new jSQL_Error("0016"));i.push(e[a])}if(i=JSON.stringify(i),this.keys.primary.map.hasOwnProperty(i))return!0!==t&&_throw(new jSQL_Error("0017"));this.keys.primary.map[i]=this.data.length}for(var o,u=0;u<this.keys.unique.length;u++){o=this.keys.unique[u];for(var l,h=Array.isArray(o.column)?o.column:[o.column],c=[],f=0;f<h.length;f++){l=h[f];var p=this.colmap[l];if(null===e[p])return!0!==t&&_throw(new jSQL_Error("0018"));c.push(e[p])}if(c=JSON.stringify(c),o.map.hasOwnProperty(c))return!0!==t&&_throw(new jSQL_Error("0019"));this.keys.unique[u].map[c]=this.data.length}},jSQLTable.prototype.normalizeColumnStoreValue=function(e,t){var r=this.types[this.colmap[e]];if([!1,void 0].indexOf(r.null)>-1&&null===t)return _throw(new jSQL_Error("0072"));null===t&&void 0!==r.default&&(t=r.default);var n=jSQL.types.getByType(r.type.toUpperCase()).serialize(t,r.args);return!isNaN(parseFloat(n))&&isFinite(n)||"string"==typeof n?n:_throw(new jSQL_Error("0020"))},jSQLTable.prototype.normalizeColumnFetchValue=function(e,t){var r=this.types[this.colmap[e]];return jSQL.types.getByType(r.type.toUpperCase()).unserialize(t,r.args)};function jSQLQuery(e){var t=this;t.type=e.toUpperCase(),t.tablename=null,t.columns=[],t.data=[],t.INEFlag=!1,t.coltypes=[],t.table=null,t.newvals={},t.whereClause=new jSQLWhereClause(t),t.resultSet=[];for(var r=["init","ifNotExists","execute","fetch","ignore","fetchAll","values","set","where","from","orderBy","asc","desc","limit","distinct"],n={CREATE:jSQLCreateQuery,UPDATE:jSQLUpdateQuery,SELECT:jSQLSelectQuery,INSERT:jSQLInsertQuery,DROP:jSQLDropQuery,DELETE:jSQLDeleteQuery},i=0;i<r.length;i++)!function(e){t[r[e]]=function(){var i=new n[t.type];return"function"==typeof i[r[e]]?i[r[e]].apply(t,arguments):_throw(new jSQL_Error("0022"))}}(i)}function jSQLDeleteQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],this)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],r=[],n=0;n<this.table.data.length;n++){var i=this.table.data[n],s=this.table.keys.primary.column,a=!1;if(!1!==s){Array.isArray(s)||(s=[s]);var o;a=[];for(var u=0;o=s[u];u++){var l=this.table.colmap[o];if(null===i[l])return _throw(new jSQL_Error("0016"));a.push(i[l])}a=JSON.stringify(a),this.table.keys.primary.map.hasOwnProperty(a)&&this.table.keys.primary.map[a]==n&&(e.indexOf(n)>-1?delete this.table.keys.primary.map[a]:this.table.keys.primary.map[a]=r.length)}for(var h,c=0;h=this.table.keys.unique[c];c++){for(var f,p=Array.isArray(h.column)?h.column:[h.column],y=[],m=0;f=p[m];m++){var S=this.table.colmap[f];if(null===i[S])return _throw(new jSQL_Error("0018"));y.push(i[S])}if(y=JSON.stringify(y),h.map.hasOwnProperty(y)&&h.map[y]==n){if(!0===this.ignoreFlag)return this;e.indexOf(n)>-1?delete this.table.keys.unique[c].map[y]:this.table.keys.unique[c].map[y]=r.length}}e.indexOf(n)>-1?t.push(i):r.push(this.table.data[n])}return this.table.data=r,this.resultSet=t,this},this.where=function(e){return this.whereClause.where(e)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLDropQuery(){this.init=function(e){return this.tablename=e,this},this.execute=function(){return void 0===jSQL.tables[this.tablename]?_throw(new jSQL_Error("0021")):(delete jSQL.tables[this.tablename],this)},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLInsertQuery(){this.init=function(e){return this.table=e,this.ignoreFlag=!1,this},this.values=function(e){return void 0===jSQL.tables[this.table]?_throw(new jSQL_Error("0021")):(this.data=e,this)},this.execute=function(e){if(void 0!==e&&Array.isArray(e)&&e.length>0)if(Array.isArray(this.data))for(var t=this.data.length;t--&&e.length;)"?"==this.data[t]&&(this.data[t]=e.shift());else for(var t in this.data)this.data.hasOwnProperty(t)&&e.length&&"?"==this.data[t]&&(this.data[t]=e.shift());return jSQL.tables[this.table].insertRow(this.data,this.ignoreFlag),this},this.ignore=function(){return this.ignoreFlag=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLSelectQuery(){this.init=function(e){return this.columns=Array.isArray(e)?e:[e],this},this.from=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],"*"==this.columns[0]&&(this.columns=this.table.columns),this)},this.where=function(e){return this.whereClause.where(e)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],r=0;r<e.length;r++)t.push(this.table.data[e[r]]);var n=[];for(r=0;r<t.length;r++){for(var i={},s=0;s<this.columns.length;s++)i[this.columns[s]]=t[r][this.table.colmap[this.columns[s]]];n.push(i)}return this.resultSet=n,this},this.fetch=function(e){if(void 0===e&&(e="ASSOC"),"ASSOC"!==(e=e.toUpperCase())&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;var t=this.resultSet.shift();for(var r in t)if(t.hasOwnProperty(r)){var n=this.table.normalizeColumnFetchValue(r,t[r]);t[r]=n}if("ARRAY"==e){n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);t=n}return t},this.fetchAll=function(e){if(void 0===e&&(e="ASSOC"),"ASSOC"!==(e=e.toUpperCase())&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;for(var t=[];this.resultSet.length>0;)t.push(this.fetch(e));return t},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLUpdateQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=this.table=jSQL.tables[e],this.ignoreFlag=!1,this)},this.set=function(e){this.newvals=e;for(var t in e)e.hasOwnProperty(t)&&this.columns.push(t);return this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(e){if(void 0!==e&&Array.isArray(e))for(var t in this.newvals)this.newvals.hasOwnProperty(t)&&"?"==this.newvals[t]&&e.length&&(this.newvals[t]=e.shift());var r=this.whereClause.getResultRowIndexes(),n=[],i=[];for(t=0;t<r.length;t++){for(var s=r[t],a=this.table.data[s].slice(0),o=0;o<this.columns.length;o++)this.columns[o]===this.table.auto_inc_col&&(this.newvals[this.columns[o]]||(this.newvals[this.columns[o]]=this.table.auto_inc_seq,this.table.auto_inc_seq++),this.newvals[this.columns[o]]>=this.table.auto_inc_seq&&(this.table.auto_inc_seq=this.newvals[this.columns[o]]+1)),a[this.table.colmap[this.columns[o]]]=this.table.normalizeColumnStoreValue(this.columns[o],this.newvals[this.columns[o]]);var u=this.table.keys.primary.column,l=!1;if(!1!==u){Array.isArray(u)||(u=[u]);var h;l=[];for(var c=0;h=u[c];c++){var f=this.table.colmap[h];if(null===a[f])return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0016"));l.push(a[f])}if(l=JSON.stringify(l),this.table.keys.primary.map.hasOwnProperty(l)&&this.table.keys.primary.map[l]!==s)return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0017"))}for(var p,y=[],m=0;p=this.table.keys.unique[m];m++){for(var S=Array.isArray(p.column)?p.column:[p.column],d=[],E=0;g=S[E];E++){var L=this.table.colmap[g];if(null===a[L])return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0018"));d.push(a[L])}if(d=JSON.stringify(d),p.map.hasOwnProperty(d)&&p.map[d]!==s)return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0019"));y.push(d)}i.push({rowIndex:s,row:a,pk_vals:l,uni_vals:y})}for(t=0;t<i.length;t++){n.push(i[t].row),this.table.data[i[t].rowIndex]=i[t].row;for(var g in this.table.keys.primary.map)if(this.table.keys.primary.map.hasOwnProperty(g)&&this.table.keys.primary.map[g]==i[t].rowIndex){delete this.table.keys.primary.map[g],this.table.keys.primary.map[i[t].pk_vals]=s;break}for(m=0;p=this.table.keys.unique[m];m++)for(var g in this.table.keys.unique[m].map)if(this.table.keys.unique[m].map.hasOwnProperty(g)&&this.table.keys.unique[m].map[g]==i[t].rowIndex){delete this.table.keys.unique[m].map[g],this.table.keys.unique[m].map[i[t].uni_vals[m]]=s;break}}return this.resultSet=n,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ignore=function(){return this.ignoreFlag=!0,this},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLCreateQuery(){this.init=function(e,t,r,n,i){return this.tablename=e,this.columns=t,this.coltypes=r,this.keys=n,this.ai_col=i,this},this.ifNotExists=function(){return this.INEFlag=!0,this},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(jSQL.tables[this.tablename]=new jSQLTable(this.tablename,this.columns,this.data,this.coltypes,this.keys,this.ai_col)),this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLLexer(e){this.input=e,this.pos=0,this.real_pos=0,this.tokens=[],this.token_matches=[]}jSQLLexer.prototype.getNextToken=function(){for(var e,t=0;t<jSQLLexer.token_types.length;t++)for(;null!=(e=jSQLLexer.token_types[t].pattern.exec(this.input));)if(e.index===this.pos){var r=new jSQLToken(this.pos,e[0],t);return this.pos+=r.length,r}return!1},jSQLLexer.prototype.getTokens=function(){if(this.tokens.length)return this.tokens;this.pos=0,this.tokens=[];for(var e,t=["COMMENT","WHITESPACE"];0!=(e=this.getNextToken());)-1===t.indexOf(e.type)&&this.tokens.push(e);if(this.pos!==this.input.length){var r;if(this.tokens.length){var n=this.tokens[this.tokens.length-1];r=n.input_pos+n.length}else r=0;return _throw(new jSQL_Lexer_Error(r,this.input))}return this.tokens},jSQLLexer.token_types=[{pattern:/"(?:[^"\\]|\\.)*"/g,type:"STRING",name:"DQ STRING"},{pattern:/'(?:[^'\\]|\\.)*'/g,type:"STRING",name:"SQ STRING"},{pattern:/--.*[\n\r$]/g,type:"COMMENT",name:"SINGLE LINE COMMENT"},{pattern:/\/\*([\s\S]*?)\*\//g,type:"COMMENT",name:"MULTI LINE COMMENT"},{pattern:/\r?\n|\r/g,type:"WHITESPACE",name:"LINEBREAK"},{pattern:/[ \t]/g,type:"WHITESPACE",name:"WHITESPACE"},{pattern:/\d+/g,type:"NUMBER",name:"INTEGER"},{pattern:/\d+.\.\d+/g,type:"NUMBER",name:"FLOAT"},{pattern:/if not exists/gi,type:"QUALIFIER",name:"IF NOT EXISTS"},{pattern:/!=/gi,type:"SYMBOL",name:"NOT EQUAL"},{pattern:/<>/gi,type:"SYMBOL",name:"NOT EQUAL"},{pattern:/\(/gi,type:"SYMBOL",name:"LEFT PEREN"},{pattern:/\)/gi,type:"SYMBOL",name:"RIGHT PEREN"},{pattern:/,/gi,type:"SYMBOL",name:"COMMA"},{pattern:/\?/gi,type:"SYMBOL",name:"QUESTION MARK"},{pattern:/,/gi,type:"SYMBOL",name:"COMMA"},{pattern:/\*/gi,type:"SYMBOL",name:"ASTERISK"},{pattern:/;/gi,type:"SYMBOL",name:"SEMICOLON"},{pattern:/=/gi,type:"SYMBOL",name:"EQUALS"},{pattern:/>/gi,type:"SYMBOL",name:"GREATER THAN"},{pattern:/</gi,type:"SYMBOL",name:"LESS THAN"},{pattern:/primary key/gi,type:"KEYWORD",name:"PRIMARY KEY"},{pattern:/unique key/gi,type:"KEYWORD",name:"UNIQUE KEY"},{pattern:/values/gi,type:"KEYWORD",name:"VALUES"},{pattern:/from/gi,type:"KEYWORD",name:"FROM"},{pattern:/auto_increment/gi,type:"KEYWORD",name:"AUTO_INCREMENT"},{pattern:/ignore/gi,type:"KEYWORD",name:"IGNORE"},{pattern:/into/gi,type:"KEYWORD",name:"INTO"},{pattern:/all/gi,type:"KEYWORD",name:"ALL"},{pattern:/distinct/gi,type:"KEYWORD",name:"DISTINCT"},{pattern:/distinctrow/gi,type:"KEYWORD",name:"DISTINCTROW"},{pattern:/where/gi,type:"KEYWORD",name:"WHERE"},{pattern:/and/gi,type:"KEYWORD",name:"AND"},{pattern:/like/gi,type:"KEYWORD",name:"LIKE"},{pattern:/order by/gi,type:"KEYWORD",name:"ORDER BY"},{pattern:/or/gi,type:"KEYWORD",name:"OR"},{pattern:/limit/gi,type:"KEYWORD",name:"LIMIT"},{pattern:/offset/gi,type:"KEYWORD",name:"OFFSET"},{pattern:/asc/gi,type:"KEYWORD",name:"ASC"},{pattern:/desc/gi,type:"KEYWORD",name:"DESC"},{pattern:/set/gi,type:"KEYWORD",name:"SET"},{pattern:/not null/gi,type:"KEYWORD",name:"NOT NULL"},{pattern:/null/gi,type:"KEYWORD",name:"NULL"},{pattern:/default/gi,type:"KEYWORD",name:"DEFAULT"},{pattern:/create table/gi,type:"DIRECTIVE",name:"CREATE TABLE"},{pattern:/insert/gi,type:"DIRECTIVE",name:"INSERT"},{pattern:/delete from/gi,type:"DIRECTIVE",name:"DELETE FROM"},{pattern:/drop table/gi,type:"DIRECTIVE",name:"DROP TABLE"},{pattern:/update/gi,type:"DIRECTIVE",name:"UPDATE"},{pattern:/select/gi,type:"DIRECTIVE",name:"SELECT"},{pattern:/`[0-9a-zA-Z$_]*[0-9a-zA-Z$_]`/gi,type:"IDENTIFIER",name:"QTD IDENTIFIER"},{pattern:/[0-9a-zA-Z$_]*[0-9a-zA-Z$_]/gi,type:"IDENTIFIER",name:"UNQTD IDENTIFIER"}];function jSQLToken(e,t,r){this.type_id=r,this.input_pos=e,this.literal=t,this.value=t,this.length=t.length,this.type=jSQLLexer.token_types[r].type,this.name=jSQLLexer.token_types[r].name,"IDENTIFIER"===this.type&&"UNQTD IDENTIFIER"===this.name&&jSQL.types.exists(this.literal)&&(this.name="DATA TYPE"),"IDENTIFIER"===this.type&&"QTD IDENTIFIER"===this.name&&(this.value=t.replace(/`/g,"")),"STRING"===this.type&&"DQ STRING"===this.name&&(this.value=t.substr(1,t.length-2).replace(/\"/g,'"')),"STRING"===this.type&&"SQ STRING"===this.name&&(this.value=t.substr(1,t.length-2).replace(/\'/g,"'")),"NUMBER"===this.type&&(this.value=parseFloat(this.literal)),"KEYWORD"===this.type&&"NULL"===this.name&&(this.value=null)}function jSQLParseQuery(e){var t=jSQL.tokenize(e);if(!t||!Array.isArray(t)||!t.length)return _throw(new jSQL_Error("0041"));if("DIRECTIVE"!==t[0].type)return _throw(new jSQL_Parse_Error(t[0],"DIRECTIVE"));switch(t.shift().name){case"CREATE TABLE":return jSQLParseCreateTokens(t);case"INSERT":return jSQLParseInsertTokens(t);case"SELECT":return jSQLParseSelectTokens(t);case"UPDATE":return jSQLParseUpdateTokens(t);case"DELETE FROM":return jSQLParseDeleteTokens(t);case"DROP TABLE":return jSQLParseDropTokens(t)}return _throw(new jSQL_Error("0041"))}jSQLParseQuery.validateTableNameToken=function(e){for(var t in jSQL.tables)if(jSQL.tables.hasOwnProperty(t)&&e.value.toUpperCase()==t.toUpperCase())return t;return _throw(new jSQL_Error("0021"))},jSQLParseQuery.validateColumnName=function(e,t){for(var r=jSQL.tables[t].columns.length;r--;)if(e.toUpperCase()===jSQL.tables[t].columns[r].toUpperCase())return jSQL.tables[t].columns[r];return _throw(new jSQL_Error("0013"))};function jSQLParseCreateTokens(e){var t,r=!1,n=!1,i=[],s={};if("QUALIFIER"===(t=e.shift()).type&&"IF NOT EXISTS"===t.name&&(n=!0,t=e.shift()),"IDENTIFIER"===t.type&&(r=t.value),!r)return _throw(new jSQL_Parse_Error(t,"TABLE NAME"));if(s[r]=[],"SYMBOL"!==(t=e.shift()).type||"LEFT PEREN"!==t.name)return _throw(new jSQL_Parse_Error(t,"LEFT PEREN"));for(;e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("KEYWORD"!==t.type||"UNIQUE KEY"!==t.name&&"PRIMARY KEY"!==t.name){if("IDENTIFIER"!==t.type)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));var a=t.value,o={name:a,type:"AMBI",args:[],null:!0,default:void 0};if("DATA TYPE"===(t=e.shift()).name&&(o.type=t.literal.toUpperCase(),"SYMBOL"===(t=e.shift()).type&&"LEFT PEREN"===t.name)){for(;e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("STRING"!==t.type&&"NUMBER"!==t.type)return _throw(new jSQL_Parse_Error(t,"DATA TYPE PARAM OR CLOSING PEREN"));o.args.push(t.value)}t=e.shift()}"KEYWORD"!==t.type||"NULL"!==t.name&&"NOT NULL"!==t.name||(o.null="NULL"===t.name,t=e.shift()),"KEYWORD"===t.type&&"DEFAULT"===t.name&&(o.default=e.shift().value,t=e.shift()),"KEYWORD"===t.type&&"AUTO_INCREMENT"===t.name&&(o.auto_increment=!0,t=e.shift()),"KEYWORD"!==t.type||"UNIQUE KEY"!==t.name&&"PRIMARY KEY"!==t.name||(i.push({column:a,type:t.name.split(" ")[0].toLowerCase()}),t=e.shift()),s[r].push(o)}else{var u=t.name.split(" ")[0].toLowerCase();if("SYMBOL"!==(t=e.shift()).type||"LEFT PEREN"!==t.name)return _throw(new jSQL_Parse_Error(t,"LEFT PEREN"));for(var l=[];e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("IDENTIFIER"!==t.type)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));var h=t.value;l.push(h)}if(!l.length)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));i.push({column:l,type:u})}}if(e.length&&("SYMBOL"!==(t=e.shift()).type||"SEMICOLON"!==t.name))return _throw(new jSQL_Parse_Error(t,"END OF STATEMENT"));var c=jSQL.createTable(s,i);return n&&c.ifNotExists(),c}function jSQLParseInsertTokens(e){var t,r=[],n=[],i=!1,s=e.shift();if("KEYWORD"===s.type&&"IGNORE"===s.name&&(i=!0,s=e.shift()),"KEYWORD"!==s.type&&"INTO"===s.name)return _throw(new jSQL_Parse_Error(s,"INTO"));if(s=e.shift(),t=jSQLParseQuery.validateTableNameToken(s),"KEYWORD"!==(s=e.shift()).type&&"VALUES"!==s.name){if("SYMBOL"!==s.type||"LEFT PEREN"!==s.name)return _throw(new jSQL_Parse_Error(s,"COLUMN LIST OR VALUES"));for(;e.length;)if("SYMBOL"!==(s=e.shift()).type||"COMMA"!==s.name){if("SYMBOL"===s.type&&"RIGHT PEREN"===s.name){s=e.shift();break}if("IDENTIFIER"!==s.type)return _throw(new jSQL_Parse_Error(s,"COLUMN NAME"));var a=jSQLParseQuery.validateColumnName(s.value,t);r.push(a)}}if("KEYWORD"!==s.type&&"VALUES"!==s.name)return _throw(new jSQL_Parse_Error(s,"VALUES"));if("SYMBOL"!==(s=e.shift()).type||"LEFT PEREN"!==s.name)return _throw(new jSQL_Parse_Error(s,"VALUES LIST"));for(;e.length;)if("SYMBOL"!==(s=e.shift()).type||"COMMA"!==s.name){if("SYMBOL"===s.type&&"RIGHT PEREN"===s.name)break;n.push(s.value)}if(e.length&&("SYMBOL"!==(s=e.shift()).type||"SEMICOLON"!==s.name))return _throw(new jSQL_Parse_Error(s,"END OF STATEMENT"));if(!r.length)for(var o=0;o<n.length;o++){if(void 0===jSQL.tables[t].columns[o])return _throw(new jSQL_Error("0032"));r.push(jSQL.tables[t].columns[o])}if(n.length!==r.length)return _throw(new jSQL_Error("0033"));var u={};for(o=0;o<r.length;o++)u[r[o]]=n[o];var l=jSQL.insertInto(t).values(u);return i?l.ignore():l}function jSQLParseSelectTokens(e){var t,r,n=[],i=!1,s=e.shift();for("KEYWORD"===s.type&&"ALL"===s.name&&(s=e.shift()),"KEYWORD"!==s.type||"DISTINCT"!==s.name&&"DISTINCTROW"!==s.name||(i=!0,s=e.shift());e.length;)if(n.push(s.value),"SYMBOL"!==(s=e.shift()).type||"COMMA"!==s.name){if("KEYWORD"===s.type&&"FROM"===s.name)break}else s=e.shift();if("KEYWORD"!==s.type&&"FROM"!==s.name)return _throw(new jSQL_Parse_Error(s,"FROM"));if(s=e.shift(),t=jSQLParseQuery.validateTableNameToken(s),1==n.length&&"*"==n[0])n="*";else for(var a=0;a<n.length;a++)n[a]=jSQLParseQuery.validateColumnName(n[a],t);return r=jSQL.select(n).from(t),i&&(r=r.distinct()),r=jSQLParseWhereClause(r,e,t)}function jSQLParseUpdateTokens(e){var t,r={},n=e.shift();if(t=jSQLParseQuery.validateTableNameToken(n),"KEYWORD"!==(n=e.shift()).type&&"SET"!==n.name)return _throw(new jSQL_Parse_Error(n,"SET"));for(;e.length;){var i=jSQLParseQuery.validateColumnName(e.shift().value,t);if("SYMBOL"!==(n=e.shift()).type&&"EQUALS"!==n.name)return _throw(new jSQL_Parse_Error(n,"EQUALS"));var s=e.shift().value;if(r[i]=s,!e.length)break;if(("SYMBOL"!==(n=e.shift()).type||"COMMA"!==n.name)&&"KEYWORD"===n.type&&"WHERE"===n.name){e.unshift(n);break}}return jSQLParseWhereClause(jSQL.update(t).set(r),e,t)}function jSQLParseDeleteTokens(e){var t=e.shift(),r=jSQLParseQuery.validateTableNameToken(t),n=jSQL.deleteFrom(r);return n=jSQLParseWhereClause(n,e,r)}function jSQLParseDropTokens(e){var t=e.shift(),r=jSQLParseQuery.validateTableNameToken(t);return jSQL.dropTable(r)}function jSQLParseWhereClause(e,t,r){for(var n=[];t.length;){switch((u=t.shift()).type){case"KEYWORD":switch(u.name){case"WHERE":case"AND":e=e.where(jSQLParseQuery.validateColumnName(t.shift().value,r));break;case"LIKE":var i=t.shift().value;e="%"==i.substr(0,1)&&"%"==i.substr(i.length-1,1)?e.contains(i.substr(1,i.length-2)):"%"==i.substr(0,1)?e.endsWith(i.substr(1,i.length-1)):"%"==i.substr(i.length-1,1)?e.beginsWith(i.substr(0,i.length-1)):"?"===i?e.preparedLike():e.equals(i);break;case"OR":e=e.or(jSQLParseQuery.validateColumnName(t.shift().value,r));break;case"LIMIT":var s,a=t.shift().value,o=!1;if("SYMBOL"===(u=t.shift()).type&&"COMMA"===u.name?o=!0:t.unshift(u),o&&(s=a,a=t.shift().value),t.length&&!o){"KEYWORD"===(u=t.shift()).type&&"OFFSET"===u.name?s=t.shift().value:t.unshift(u)}e=e.limit(a,s);break;case"ORDER BY":for(;t.length;){var u;if("SYMBOL"!==(u=t.shift()).type||"COMMA"!==u.name)try{var l=jSQLParseQuery.validateColumnName(u.value,r);n.push(l)}catch(e){t.unshift(u);break}}e=e.orderBy(n);break;case"ASC":if(!n.length)return _throw(new jSQL_Error("0026"));e=e.asc();break;case"DESC":if(!n.length)return _throw(new jSQL_Error("0027"));e=e.desc();break;default:return _throw(new jSQL_Parse_Error(u))}break;case"SYMBOL":switch(u.name){case"EQUALS":e=e.equals(t.shift().value);break;case"GREATER THAN":e=e.greaterThan(t.shift().value);break;case"LESS THAN":e=e.lessThan(t.shift().value);break;case"NOT EQUAL":e=e.doesNotEqual(t.shift().value);break;default:return _throw(new jSQL_Parse_Error(u))}break;default:return _throw(new jSQL_Parse_Error(u,"SYMBOL OR KEYWORD"))}}return e}function jSQLWhereClause(e){var t=this;t.context=e,t.pendingColumn="",t.conditions=[],t.LIMIT=0,t.OFFSET=0,t.finalConditions=[],t.sortColumn=[],t.sortDirection="ASC",t.isDistinct=!1,t.where=function(e){return""!==t.pendingColumn?_throw(new jSQL_Error("0042")):"string"!=typeof e?_throw(new jSQL_Error("0043")):(t.pendingColumn=e,t)},t.equals=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0044")):(t.conditions.push({col:t.pendingColumn,type:"=",value:e}),t.pendingColumn="",t)},t.preparedLike=function(){return""==t.pendingColumn?_throw(new jSQL_Error("0045")):(t.conditions.push({col:t.pendingColumn,type:"pl",value:"?"}),t.pendingColumn="",t)},t.doesNotEqual=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0046")):(t.conditions.push({col:t.pendingColumn,type:"!=",value:e}),t.pendingColumn="",t)},t.lessThan=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0047")):(t.conditions.push({col:t.pendingColumn,type:"<",value:e}),t.pendingColumn="",t)},t.greaterThan=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0048")):(t.conditions.push({col:t.pendingColumn,type:">",value:e}),t.pendingColumn="",t)},t.contains=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0049")):(t.conditions.push({col:t.pendingColumn,type:"%%",value:e}),t.pendingColumn="",t)},t.endsWith=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0050")):(t.conditions.push({col:t.pendingColumn,type:"%-",value:e}),t.pendingColumn="",t)},t.beginsWith=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0051")):(t.conditions.push({col:t.pendingColumn,type:"-%",value:e}),t.pendingColumn="",t)},t.and=function(e){return t.where(e)},t.or=function(e){return t.finalConditions.push(t.conditions),t.conditions=[],t.where(e)},t.limit=function(e,r){return t.LIMIT=parseInt(e),void 0!==r&&(t.OFFSET=parseInt(r)),t},t.orderBy=function(e){return Array.isArray(e)||(e=[e]),t.sortColumn=e,t},t.asc=function(){return""==t.sortColumn?_throw(new jSQL_Error("0052")):(t.sortDirection="ASC",t)},t.desc=function(){return""==t.sortColumn?_throw(new jSQL_Error("0053")):(t.sortDirection="DESC",t)},t.execute=function(e){if(void 0===e&&(e=[]),t.conditions.length>0&&t.finalConditions.push(t.conditions),e.length>0)for(var r=t.finalConditions.length;r--;)for(var n=t.finalConditions[r].length;n--;)if("?"===t.finalConditions[r][n].value&&"pl"===t.finalConditions[r][n].type){var i=e.pop();"%"==i.substr(0,1)&&"%"==i.substr(i.length-1,1)?(t.finalConditions[r][n].value=i.substr(1,i.length-2),t.finalConditions[r][n].type="%%"):"%"==i.substr(0,1)?(t.finalConditions[r][n].value=i.substr(1,i.length-1),t.finalConditions[r][n].type="%-"):"%"==i.substr(i.length-1,1)?(t.finalConditions[r][n].value=i.substr(0,i.length-1),t.finalConditions[r][n].type="-%"):(t.finalConditions[r][n].value=i,t.finalConditions[r][n].type="=")}else"?"===t.finalConditions[r][n].value&&e.length>0&&(t.finalConditions[r][n].value=e.pop());return t.context.execute(e)},t.fetch=function(e){return t.context.fetch(e)},t.fetchAll=function(e){return t.context.fetchAll(e)},t.getResultRowIndexes=function(){for(var e=[],r=0;r<t.context.table.data.length;r++)if(t.finalConditions.length<1)e.push(r);else{for(var n=!1,i=t.finalConditions.length;i--;){for(var s=t.finalConditions[i],a=!0,o=s.length;o--;){var u=s[o],l=t.context.table.colmap[u.col],h=t.context.table.data[r][l];switch(u.type){case">":(isNaN(parseFloat(h))||h<=u.value)&&(a=!1);break;case"<":(isNaN(parseFloat(h))||h>=u.value)&&(a=!1);break;case"=":h!=u.value&&(a=!1);break;case"!=":break;case"%%":h.indexOf(u.value)<0&&(a=!1);break;case"%-":h.indexOf(u.value)!=h.length-u.value.length&&(a=!1);break;case"-%":0!=h.indexOf(u.value)&&(a=!1)}if(!a)break}if(a){n=!0;break}}n&&e.push(r)}if(t.sortColumn.length>0&&(e.sort(function(e,r){return e=t.context.table.data[e],r=t.context.table.data[r],function n(i){if(void 0===t.sortColumn[i])return 0;var s=t.sortColumn[i],a=t.context.table.colmap[s];return e[a]<r[a]?-1:e[a]>r[a]?1:n(i+1)}(0)}),"DESC"==t.sortDirection&&e.reverse()),t.isDistinct){var c=[];for(r=0;r<e.length;r++)c.push(t.context.table.data[e[r]]);var f=[],p=[];for(r=0;r<c.length;r++){for(var y={},m=0;m<t.context.columns.length;m++)y[t.context.columns[m]]=c[r][t.context.table.colmap[t.context.columns[m]]];var S=JSON.stringify(y);f.indexOf(S)>-1||(p.push(e[r]),f.push(S))}e=p}return t.LIMIT>0&&e.length>t.LIMIT&&(t.OFFSET>e.length&&(e=[]),t.LIMIT>e.length&&(t.LIMIT=e.length),e.length&&(e=e.slice(t.OFFSET,t.OFFSET+t.LIMIT))),e}}var API={cookieAPI:function(){var e=this,t=function(e,t){var r=new Date;r.setTime(r.getTime()+864e9);var n="expires="+r.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"},r=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""};e.init=function(t,r){"function"!=typeof r&&(r=function(){});for(var n,i=0;n=t[i];i++)e.insert(n.name,n.rows);r()},e.insert=function(e,n,i){"function"!=typeof i&&(i=function(){});var s;try{s=JSON.parse(r(e))}catch(e){s=[]}Array.isArray(s)||(s=[]);for(var a=0;a<n.length;a++)s.push(n[a]);var o=JSON.stringify(s);if(t(e,o),r(e)!==o){for(var u=100;u--&&r(e)!==o;)s.pop(),o=JSON.stringify(s),t(e,o);return _throw(new jSQL_Error("0067"))}i()},e.delete=function(e,r){"function"!=typeof r&&(r=function(){}),t(e,JSON.stringify([])),r()},e.select=function(e,t){"function"!=typeof t&&(t=function(){});t(JSON.parse(r(e)))}},localStorageAPI:function(){var e=this;e.init=function(t,r){"function"!=typeof r&&(r=function(){});for(var n,i=0;n=t[i];i++)e.insert(n.name,n.rows);r()},e.insert=function(e,t,r){"function"!=typeof r&&(r=function(){});var n;try{n=JSON.parse(localStorage.getItem(e))}catch(e){n=[]}Array.isArray(n)||(n=[]);for(var i=0;i<t.length;i++)n.push(t[i]);var s=JSON.stringify(n);if(localStorage.setItem(e,s),localStorage.getItem(e)!==s){for(var a=100;a--&&localStorage.getItem(e)!==s;)n.pop(),s=JSON.stringify(n),localStorage.setItem(e,s);return _throw(new jSQL_Error("0067"))}r()},e.delete=function(e,t){"function"!=typeof t&&(t=function(){}),localStorage.setItem(e,JSON.stringify([])),t()},e.select=function(e,t){"function"!=typeof t&&(t=function(){});t(JSON.parse(localStorage.getItem(e)))}},nodeAPI:function(){this.db=null;var e=require("fs");this.init=function(t,r){if("function"!=typeof r&&(r=function(){}),!e.existsSync(".jsqldatastore"))try{e.writeFileSync(".jsqldatastore",JSON.stringify(t))}catch(e){return _throw(new jSQL_Error("0064"))}r()},this.insert=function(t,r,n){"function"!=typeof n&&(n=function(){});var i,s=JSON.parse(e.readFileSync(".jsqldatastore",{encoding:"utf8"}));for(i=s.length;i--&&!s[i].name===t;);for(var a=0;a<r.length;a++)s[i].rows.push(r[a]);e.writeFileSync(".jsqldatastore",JSON.stringify(s)),n()},this.delete=function(t,r){"function"!=typeof r&&(r=function(){});for(var n=JSON.parse(e.readFileSync(".jsqldatastore",{encoding:"utf8"})),i=n.length;i--;)if(!n[i].name!==t){n[i].rows=[];break}e.writeFileSync(".jsqldatastore",JSON.stringify(n)),r()},this.select=function(t,r){"function"!=typeof r&&(r=function(){});for(var n=JSON.parse(e.readFileSync(".jsqldatastore",{encoding:"utf8"})),i=n.length;i--;)if(!n[i].name!==t)return void r(n[i].rows)}},indexedDBAPI:function(){var e=this;e.db=null;var t,r;e.init=function(n,i){"function"!=typeof i&&(i=function(){});try{t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,r=window.hasOwnProperty("IDBTransaction")?window.IDBTransaction:window.webkitIDBTransaction,window.hasOwnProperty("IDBKeyRange")?window.IDBKeyRange:window.webkitIndexedDB}catch(e){return _throw(new jSQL_Error("0057"))}if(!t)return _throw(new jSQL_Error("0057"));var s=1,a=window.location.href.replace(/\W+/g,""),o=t.open("jSQL_"+a,s),u=function(){for(var t=n.length;t--;)e.db.objectStoreNames.contains(n[t].name)&&e.db.deleteObjectStore(n[t].name),e.db.createObjectStore(n[t].name,{keyPath:"_id",autoIncrement:!0});var r=!1,i=setInterval(function(){if(!r){r=!0;try{for(var t=n.length;t--;){var s=n[t].name,a=void 0==n[t].rows?[]:n[t].rows;e.insert(s,a)}clearInterval(i)}catch(e){0,r=!1}}},10)};o.onsuccess=function(t){var r;e.db=t.target.result,s=String(s),e.db.setVersion&&s!==e.db.version?((r=e.db.setVersion(s)).onfailure=function(){return _throw(new jSQL_Error("0059"))},r.onsuccess=function(e){u(),r.result.oncomplete=function(){i()}}):i()},o.onupgradeneeded=function(t){e.db=t.target.result,u()},o.onerror=function(e){return _throw(new jSQL_Error("0060"))}},e.insert=function(t,n,i){"function"!=typeof i&&(i=function(){});var s,a,o,u=e.db.transaction([t],void 0===r.READ_WRITE?"readwrite":r.READ_WRITE),l=n.length,h=function(){0===(l-=1)&&i(l)};u.onerror=function(){return _throw(new jSQL_Error("0061"))},s=u.objectStore(t);for(a in n)n.hasOwnProperty(a)&&((o=s.add(n[a])).onsuccess=h,o.onerror=function(){return _throw(new jSQL_Error("0062"))})},e.delete=function(t,n){"function"!=typeof n&&(n=function(){});var i,s=e.db.transaction([t],void 0===r.READ_WRITE?"readwrite":r.READ_WRITE);s.onerror=function(){return _throw(new jSQL_Error("0061"))},(i=s.objectStore(t).clear()).onerror=function(){return _throw(new jSQL_Error("0062"))},i.onsuccess=n},e.select=function(t,n){"function"!=typeof n&&(n=function(){});var i,s=e.db.transaction([t],void 0===r.READ_ONLY?"readonly":r.READ_ONLY),a=[];s.onerror=function(){return _throw(new jSQL_Error("0061"))},(i=s.objectStore(t).openCursor()).onerror=function(){return _throw(new jSQL_Error("0062"))};var o=!1;i.onsuccess=function(e){if(!o){var t=e.target.result;if(!t)return o=!0,void n(a);a.push(t.value),t.continue()}}}},WebSQLAPI:function(){var e=this;e.db=null;var t=function(t,r,n,i){"function"!=typeof n&&(n=function(){}),"function"!=typeof i&&(i=function(){return _throw(new jSQL_Error("0054"))});var s,a,o;Array.isArray(r[0])||(r=[r]),o=r.length;var u=function(e,t){var r,i,s=[];if(!(o-=1)){for(r=0,i=t.rows.length;r<i;r+=1){var a=t.rows.item(r).json;s.push(a)}n(s)}};e.db.transaction(function(e){for(s=0,a=r.length;s<a;s+=1)e.executeSql(t,r[s],u,i)})};e.init=function(r,n){"function"!=typeof n&&(n=function(){});try{var i=window.location.href.replace(/\W+/g,"");e.db=openDatabase("jSQL_"+i,"1.0","jSQL "+i,5242880)}catch(e){return _throw(new jSQL_Error("0056"))}t("SELECT COUNT(*) FROM "+r[0].name,[],null,function(){!function(){try{for(var n=r.length;n--;)!function(r,n){t("DROP TABLE IF EXISTS "+r,[],function(){t("CREATE TABLE IF NOT EXISTS "+r+"(json TEXT)",[],function(){e.insert(r,n)})})}(r[n].name,r[n].rows)}catch(e){return _throw(new jSQL_Error("0055"))}}()}),n()},e.insert=function(e,r,n){"function"!=typeof n&&(n=function(){});var i,s,a=[];for(0===r.length&&n(),i=0,s=r.length;i<s;i+=1)a[i]=[JSON.stringify(r[i])];t("INSERT INTO "+e+" (json) VALUES (?);",a,n)},e.delete=function(e,r){"function"!=typeof r&&(r=function(){}),t("DELETE FROM "+e,[],r)},e.select=function(e,r){t("SELECT json FROM "+e,[],function(e){for(var t=[],n=e.length;n--;)t.push(JSON.parse(e[n]));r(t)})}}},persistenceManager=new function(){var e=this;e.api=null,e.error=!1,e.loaded=!1,e.isLoading=!1,e.initiated=!1,e.loadingCallbacks=[],e.api_default_priority=["indexedDBAPI","WebSQLAPI","localStorageAPI","cookieAPI"],e.api_user_priority=[],e.setApiPriority=function(){e.api_user_priority=1===arguments.length?[arguments[0]]:Array.apply(null,arguments)},e.getApi=function(){var t=!1;try{t=e.api.constructor.name}catch(e){t=!1}return t},e.commit=function(t){if("function"==typeof t&&(t=function(){}),!1!==e.error)return _throw(e.error);var r=[];for(var n in jSQL.tables)if(jSQL.tables.hasOwnProperty(n)){for(var i=[],s=0;s<jSQL.tables[n].keys.unique.length;s++)i.push({column:jSQL.tables[n].keys.unique[s].column,type:"unique"});jSQL.tables[n].keys.primary.column&&i.push({column:jSQL.tables[n].keys.primary.column,type:"primary"});var a=jSQL.select("*").from(n).execute().fetchAll();a.length||r.push({table:n,data:JSON.stringify(jSQL.tables[n].columns),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(i),ai_col:jSQL.tables[n].auto_inc_col});for(s=a.length;s--;){var o=a[s];for(var u in o)o.hasOwnProperty(u)&&(o[u]=jSQL.tables[n].normalizeColumnStoreValue(u,o[u]));r.push({table:n,data:JSON.stringify(o),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(i),ai_col:jSQL.tables[n].auto_inc_col})}}e.api.delete("jSQL_data_schema",function(){e.api.insert("jSQL_data_schema",r,t)})},e.load=function(t){if("function"!=typeof t&&(t=function(){}),e.loadingCallbacks.push(t),e.loaded)for(;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();e.isLoading||(e.isLoading=!0,e.initiated?e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()}):e.init(function(){e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()})}))},e.rollback=function(t){"function"!=typeof t&&(t=function(){}),mute_jsql_errors=!0,function r(n){try{e.api.select("jSQL_data_schema",function(e){if(jSQL.tables={},0===e.length)return mute_jsql_errors=!1,void t();for(var r=e.length;r--;){var n=e[r].table,i=JSON.parse(e[r].data),s=JSON.parse(e[r].colTypes),a=JSON.parse(e[r].keys),o=e[r].ai_col;if(void 0===jSQL.tables[n])if(Array.isArray(i))u=i,jSQL.createTable(n,u,s,a,o).execute();else{var u=[];for(var l in i)i.hasOwnProperty(l)&&u.push(l);jSQL.createTable(n,u,s,a,o).execute()}if(!Array.isArray(i)){for(var l in i)i.hasOwnProperty(l)&&(i[l]=jSQL.tables[n].normalizeColumnFetchValue(l,i[l]));jSQL.tables[n].insertRow(i)}}mute_jsql_errors=!1,t()})}catch(t){if(n>500){for(mute_jsql_errors=!1,e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();return}setTimeout(function(){r(n+1)},10)}}(0)},e.init=function(t){if("function"!=typeof t&&(t=function(){}),e.initiated=!0,isNode)e.api=new API.nodeAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}],t);else{var r=e.api_user_priority.concat(e.api_default_priority),n=[],i=!1;!function s(a){if(a>=r.length&&!i)return _throw(new jSQL_Error("0063"));if(-1===e.api_default_priority.indexOf(r[a]))return s(1+a);if(n.indexOf(r[a])>-1)return s(1+a);try{e.api=new API[r[a]],e.api.init([{name:"jSQL_data_schema",rows:[]}],t),i=!0}catch(e){i=!1}i||s(1+a)}(0)}}};function createTable(e,t,r,n,i){var s=void 0===t&&void 0===r&&"object"==typeof e&&void 0===n,a=Array.isArray(t)&&void 0===r&&"object"==typeof e&&void 0===n;if(s||a){a&&(n=void 0===t?[]:t),void 0===n&&(n=[]),t=[],r=[];for(var o in e)if(e.hasOwnProperty(o)){var u=e[o];e=o;for(var l=0;l<u.length;l++){var h=u[l].name;t.push(h),r.push({type:u[l].type,args:void 0===u[l].args?[]:u[l].args,default:void 0===u[l].default?void 0:u[l].default,null:void 0===u[l].null||u[l].null}),u[l].hasOwnProperty("key")&&Array.isArray(n)&&n.push({column:u[l].name,type:u[l].key}),u[l].hasOwnProperty("auto_increment")&&!0===u[l].auto_increment&&(i=u[l].name)}break}}return Array.isArray(t)||(t=[t]),void 0===n&&(n=[]),Array.isArray(n)||(n=[n]),new jSQLQuery("CREATE").init(e,t,r,n,i)}function select(e){return Array.isArray(e)||(e=[e]),new jSQLQuery("SELECT").init(e)}function update(e){return new jSQLQuery("UPDATE").init(e)}function insertInto(e){return new jSQLQuery("INSERT").init(e)}function dropTable(e){return new jSQLQuery("DROP").init(e)}function deleteFrom(e){return new jSQLQuery("DELETE").init(e)}function tokenize(e){return new jSQLLexer(e).getTokens()}function jSQLReset(){jSQL.tables={},jSQL.commit()}function jSQLMinifier(e){for(var t=new jSQLLexer(e).getTokens(),r=[],n=0;n<t.length;n++)r.push(t[n].literal);return r.join(" ")}function removeQuotes(e){for(var t=['"',"'","`"],r=t.length;r--;)if(e.substr(0,1)==t[r]&&e.substr(e.length-1,1)==t[r])return e.substr(1,e.length-2);return e}function jsql_export(e,t){e=void 0===e||!!e,t=t||[];var r=[];for(var n in jSQL.tables)if(jSQL.tables.hasOwnProperty(n)&&(!t.length||~t.indexOf(n))){if(e){for(var i=[],s=0;s<jSQL.tables[n].columns.length;s++){var a=[];a.push("`"+jSQL.tables[n].columns[s]+"` ");var o="";jSQL.tables[n].types[s].args.length&&(o=JSON.stringify(jSQL.tables[n].types[s].args).trim().slice(1,-1)),a.push(jSQL.tables[n].types[s].type+"("+o+") "),a.push(jSQL.tables[n].types[s].null?"NULL ":"NOT NULL "),jSQL.tables[n].types[s].default&&a.push("DEFAULT "+JSON.stringify(jSQL.tables[n].types[s].default)+" "),jSQL.tables[n].columns[s]===jSQL.tables[n].auto_inc_col&&a.push("AUTO_INCREMENT"),i.push("\n\t"+a.join("").trim())}if(jSQL.tables[n].keys.primary.column){if(a=[],Array.isArray(jSQL.tables[n].keys.primary.column))for(s=0;s<jSQL.tables[n].keys.primary.column.length;s++)a.push("`"+jSQL.tables[n].keys.primary.column[s]+"`");else a.push("`"+jSQL.tables[n].keys.primary.column+"`");i.push("\n\tPRIMARY KEY ("+a.join(",")+")")}if(jSQL.tables[n].keys.unique.length)for(var u=0;u<jSQL.tables[n].keys.unique.length;u++){if(a=[],Array.isArray(jSQL.tables[n].keys.unique[u].column))for(s=0;s<jSQL.tables[n].keys.unique[u].column.length;s++)a.push("`"+jSQL.tables[n].keys.unique[u].column[s]+"`");else a.push("`"+jSQL.tables[n].keys.unique[u].column+"`");i.push("\n\tUNIQUE KEY ("+a.join(",")+")")}r.push("CREATE TABLE `"+n+"` ("+i.join(",")+"\n)")}for(s=0;s<jSQL.tables[n].data.length;s++){var l=JSON.stringify(jSQL.tables[n].data[s]).trim().slice(1,-1).replace(/"jsqlNull"/g,"null");r.push("INSERT INTO `"+n+"` (`"+jSQL.tables[n].columns.join("`,`")+"`) VALUES ("+l+")")}}var h=["-- Exported by jSQL v"+jSQL.version+" "+(new Date).toUTCString()],c="-".repeat(h[0].length);return h.unshift(c),h.push(c),h.join("\n")+"\n"+r.join(";\n")}function jsql_import(e){e=e.split(";\n");for(var t=0;t<e.length;t++)jSQL.query(e[t]).execute()}return{version:"3.2.2",tables:{},query:jSQLParseQuery,createTable:createTable,dropTable:dropTable,select:select,update:update,deleteFrom:deleteFrom,insertInto:insertInto,types:new jSQLDataTypeList,load:persistenceManager.load,onError:onError,reset:jSQLReset,minify:jSQLMinifier,commit:persistenceManager.commit,rollback:persistenceManager.rollback,setApiPriority:persistenceManager.setApiPriority,getApi:persistenceManager.getApi,tokenize:tokenize,export:jsql_export,import:jsql_import}}();isNode?module.exports=jSQL:window.jSQL=jSQL}();