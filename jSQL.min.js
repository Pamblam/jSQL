window.jSQL=function(){"use strict";function t(t,e,n){var a=this;a.name="",a.columns=[],a.data=[],a.colmap={},a.init=function(t,e,n){if(a.name=t,Array.isArray(e)&&void 0===n&&(n=e,e=[]),Array.isArray(e)&&!Array.isArray(e[0])&&"object"==typeof e[0]){var r=[];for(var t in e[0])e[0].hasOwnProperty(t)&&r.push(t);n=e,e=r}if(!Array.isArray(e))throw"Columns must be an array.";a.columns=e;for(var i=0;i<e.length;i++)a.colmap[e[i]]=i;void 0!==n&&a.loadData(n)},a.renameColumn=function(t,e){if(void 0===t||"string"!=typeof e)throw"renameColumn expects and old column name and a new one, both must be strings.";if(a.columns.indexOf(t)<0)throw"The column "+t+" does not exist in this table.";a.columns.splice(a.columns.indexOf(t),1,e)},a.addColumn=function(t,e){void 0===e&&(e=null),"string"!=typeof t&&(t=function r(t){for(var e=0;e<a.columns.length;e++)if(a.columns[e]=="u"+t)return r(t+1);return"u"+t}(0)),a.columns.push(t);for(var n=a.data.length;n--;)a.data[n].push(e);a.colmap[t]=a.columns.length-1},a.loadData=function(t){if(!Array.isArray(t))throw"Data must be an array.";var e=t.length;for(a.columns.length;e--;)a.insertRow(t[e])},a.insertRow=function(t){var e=[];if(Array.isArray(t)){for(;t.length>a.columns.length;)a.addColumn();for(;t.length<a.columns.length;)t.push(null);for(var n=0;n<t.length;n++)e.push(t[n]);for(;e.length<a.columns.length;)e.push(null)}else{if("object"!=typeof t)throw"Data not structured properly.";for(var n=0;n<a.columns.length;n++)void 0===t[a.columns[n]]&&(t[a.columns[n]]=null);for(var r in t)if(function(t){for(;t--;)if(a.columns[t]==r)return 0;return 1}(a.columns.length))if(a.columns.indexOf("u0")>-1){a.renameColumn("u0",r);for(var i=1;a.columns.indexOf("u"+i)>-1;)a.renameColumn("u"+i,"u"+(i-1))}else a.addColumn(r);for(var n=0;n<a.columns.length;n++)e.push(t[a.columns[n]])}a.data.push(e)},a.init(t,e,n)}function e(t){var e=this;e.type=t.toUpperCase(),e.tablename=null,e.columns=[],e.data=[],e.INEFlag=!1,e.table=null,e.newvals={},e.whereClause=new u(e),e.resultSet=[],e.init=function(){switch(e.type){case"CREATE":return(new o).init.apply(e,arguments);case"UPDATE":return(new s).init.apply(e,arguments);case"SELECT":return(new i).init.apply(e,arguments);case"INSERT":return(new r).init.apply(e,arguments);case"DROP":return(new a).init.apply(e,arguments);case"DELETE":return(new n).init.apply(e,arguments)}},e.ifNotExists=function(){switch(e.type){case"CREATE":return(new o).ifNotExists.apply(e,arguments);case"UPDATE":return(new s).ifNotExists.apply(e,arguments);case"SELECT":return(new i).ifNotExists.apply(e,arguments);case"INSERT":return(new r).ifNotExists.apply(e,arguments);case"DROP":return(new a).ifNotExists.apply(e,arguments);case"DELETE":return(new n).ifNotExists.apply(e,arguments)}},e.execute=function(){switch(e.type){case"CREATE":return(new o).execute.apply(e,arguments);case"UPDATE":return(new s).execute.apply(e,arguments);case"SELECT":return(new i).execute.apply(e,arguments);case"INSERT":return(new r).execute.apply(e,arguments);case"DROP":return(new a).execute.apply(e,arguments);case"DELETE":return(new n).execute.apply(e,arguments)}},e.fetch=function(){switch(e.type){case"CREATE":return(new o).fetch.apply(e,arguments);case"UPDATE":return(new s).fetch.apply(e,arguments);case"SELECT":return(new i).fetch.apply(e,arguments);case"INSERT":return(new r).fetch.apply(e,arguments);case"DROP":return(new a).fetch.apply(e,arguments);case"DELETE":return(new n).fetch.apply(e,arguments)}},e.fetchAll=function(){switch(e.type){case"CREATE":return(new o).fetchAll.apply(e,arguments);case"UPDATE":return(new s).fetchAll.apply(e,arguments);case"SELECT":return(new i).fetchAll.apply(e,arguments);case"INSERT":return(new r).fetchAll.apply(e,arguments);case"DROP":return(new a).fetchAll.apply(e,arguments);case"DELETE":return(new n).fetchAll.apply(e,arguments)}},e.values=function(){switch(e.type){case"CREATE":return(new o).values.apply(e,arguments);case"UPDATE":return(new s).values.apply(e,arguments);case"SELECT":return(new i).values.apply(e,arguments);case"INSERT":return(new r).values.apply(e,arguments);case"DROP":return(new a).values.apply(e,arguments);case"DELETE":return(new n).values.apply(e,arguments)}},e.set=function(){switch(e.type){case"CREATE":return(new o).set.apply(e,arguments);case"UPDATE":return(new s).set.apply(e,arguments);case"SELECT":return(new i).set.apply(e,arguments);case"INSERT":return(new r).set.apply(e,arguments);case"DROP":return(new a).set.apply(e,arguments);case"DELETE":return(new n).set.apply(e,arguments)}},e.where=function(){switch(e.type){case"CREATE":return(new o).where.apply(e,arguments);case"UPDATE":return(new s).where.apply(e,arguments);case"SELECT":return(new i).where.apply(e,arguments);case"INSERT":return(new r).where.apply(e,arguments);case"DROP":return(new a).where.apply(e,arguments);case"DELETE":return(new n).where.apply(e,arguments)}},e.from=function(){switch(e.type){case"CREATE":return(new o).from.apply(e,arguments);case"UPDATE":return(new s).from.apply(e,arguments);case"SELECT":return(new i).from.apply(e,arguments);case"INSERT":return(new r).from.apply(e,arguments);case"DROP":return(new a).from.apply(e,arguments);case"DELETE":return(new n).from.apply(e,arguments)}}}function n(){this.init=function(t){if(void 0===jSQL.tables[t])throw"Table: "+t+" doesn't exist.";return this.table=this.table=jSQL.tables[t],this},this.execute=function(){for(var t=[],e=0;e<this.table.data.length&&!(this.whereClause.LIMIT>0&&t.length==this.whereClause.LIMIT);e++)if(this.whereClause.finalConditions.length<1)t.push(e);else{for(var n=!1,a=this.whereClause.finalConditions.length;a--;){for(var r=this.whereClause.finalConditions[a],i=!0,s=r.length;s--;){var o=r[s];switch(o.type){case">":(isNaN(parseFloat(this.table.data[e][this.table.colmap[o.col]]))||this.table.data[e][this.table.colmap[o.col]]<o.value)&&(i=!1);break;case"<":(isNaN(parseFloat(this.table.data[e][this.table.colmap[o.col]]))||this.table.data[e][this.table.colmap[o.col]]>o.value)&&(i=!1);break;case"=":this.table.data[e][this.table.colmap[o.col]]!=o.value&&(i=!1);break;case"!=":break;case"%%":this.table.data[e][this.table.colmap[o.col]].indexOf(o.value)<0&&(i=!1);break;case"%-":this.table.data[e][this.table.colmap[o.col]].indexOf(o.value)!=this.table.data[e][this.table.colmap[o.col]].length-o.value.length&&(i=!1);break;case"-%":0!=this.table.data[e][this.table.colmap[o.col]].indexOf(o.value)&&(i=!1)}if(!i)break}if(i){n=!0;break}}n&&t.push(e)}for(var l=[],u=[],h=t.length;h--;)for(var c=t[h],e=this.table.data.length;e--;)e===c?u.push(this.table.data[e]):l.push(this.table.data[e]);return this.table.data=l,this.resultSet=t,this},this.where=function(t){return this.whereClause.where(t)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a delete query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a delete query"},this.set=function(){throw"set() is not a valid method for a delete query"},this.from=function(){throw"from() is not a valid method for a delete query"}}function a(){this.init=function(t){return this.tablename=t,this},this.execute=function(){if(void 0===jSQL.tables[this.tablename])throw"Table "+this.tablename+" does not exist.";return delete jSQL.tables[this.tablename],this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a drop query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a drop query"},this.set=function(){throw"set() is not a valid method for a drop query"},this.where=function(){throw"where() is not a valid method for a drop query"},this.from=function(){throw"from() is not a valid method for a drop query"}}function r(){this.init=function(t){return this.table=t,this},this.values=function(t){if(void 0===jSQL.tables[this.table])throw"Table: "+this.table+" doesn't exist.";return this.data=t,this},this.execute=function(t){if(void 0!==t&&Array.isArray(t)&&t.length>0)if(Array.isArray(this.data))for(var e=this.data.length;e--&&t.length;)"?"==this.data[e]&&(this.data[e]=t.shift());else for(var e in this.data)this.data.hasOwnProperty(e)&&t.length&&"?"==this.data[e]&&(this.data[e]=t.shift());jSQL.tables[this.table].insertRow(this.data)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for an insert query"},this.set=function(){throw"set() is not a valid method for an insert query"},this.where=function(){throw"where() is not a valid method for an insert query"},this.from=function(){throw"from() is not a valid method for an insert query"}}function i(){this.init=function(t){return this.columns=Array.isArray(t)?t:[t],this},this.from=function(t){if(void 0===jSQL.tables[t])throw"Table: "+t+" doesn't exist.";return this.table=jSQL.tables[t],"*"==this.columns[0]&&(this.columns=this.table.columns),this},this.where=function(t){return this.whereClause.where(t)},this.execute=function(){for(var t=[],e=0;e<this.table.data.length&&!(this.whereClause.LIMIT>0&&t.length==this.whereClause.LIMIT);e++)if(this.whereClause.finalConditions.length<1){for(var n={},a=0;a<this.columns.length;a++)n[this.columns[a]]=this.table.data[e][this.table.colmap[this.columns[a]]];t.push(n)}else{for(var r=!1,i=this.whereClause.finalConditions.length;i--;){for(var s=this.whereClause.finalConditions[i],o=!0,l=s.length;l--;){var u=s[l];switch(u.type){case">":(isNaN(parseFloat(this.table.data[e][this.table.colmap[u.col]]))||this.table.data[e][this.table.colmap[u.col]]<u.value)&&(o=!1);break;case"<":(isNaN(parseFloat(this.table.data[e][this.table.colmap[u.col]]))||this.table.data[e][this.table.colmap[u.col]]>u.value)&&(o=!1);break;case"=":this.table.data[e][this.table.colmap[u.col]]!=u.value&&(o=!1);break;case"!=":break;case"%%":this.table.data[e][this.table.colmap[u.col]].indexOf(u.value)<0&&(o=!1);break;case"%-":this.table.data[e][this.table.colmap[u.col]].indexOf(u.value)!=this.table.data[e][this.table.colmap[u.col]].length-u.value.length&&(o=!1);break;case"-%":0!=this.table.data[e][this.table.colmap[u.col]].indexOf(u.value)&&(o=!1)}if(!o)break}if(o){r=!0;break}}if(r){for(var n={},a=0;a<this.columns.length;a++)n[this.columns[a]]=this.table.data[e][this.table.colmap[this.columns[a]]];t.push(n)}}return this.whereClause.sortColumn.length>0&&(t.sort(function(t,e){return function n(a){return void 0===this.whereClause.sortColumn[a]?0:t[this.whereClause.sortColumn[a]]<e[this.whereClause.sortColumn[a]]?-1:t[this.whereClause.sortColumn[a]]>e[this.whereClause.sortColumn[a]]?1:n(a+1)}(0)}),"DESC"==this.whereClause.sortDirection&&t.reverse()),this.resultSet=t,this},this.fetch=function(t){if(void 0===t&&(t="ASSOC"),t=t.toUpperCase(),"ASSOC"!==t&&"ARRAY"!==t)throw"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or blank";if(!this.resultSet.length)return!1;var e=this.resultSet.shift();if("ARRAY"==t){var n=[];for(var a in e)e.hasOwnProperty(a)&&n.push(e[a]);e=n}return e},this.fetchAll=function(t){if(void 0===t&&(t="ASSOC"),t=t.toUpperCase(),"ASSOC"!==t&&"ARRAY"!==t)throw"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or blank";if(!this.resultSet.length)return!1;for(var e=[];this.resultSet.length>0;)e.push(this.fetch(t));return e},this.values=function(){throw"values() is not a valid method for a select query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a select query"},this.set=function(){throw"set() is not a valid method for a select query"}}function s(){this.init=function(t){if(void 0===jSQL.tables[t])throw"Table: "+t+" doesn't exist.";return this.table=this.table=jSQL.tables[t],this},this.set=function(t){this.newvals=t;for(var e in t)t.hasOwnProperty(e)&&this.columns.push(e);return this},this.where=function(t){return this.whereClause.where(t)},this.execute=function(t){if(void 0!==t&&Array.isArray(t))for(var e in this.newvals)this.newvals.hasOwnProperty(e)&&"?"==this.newvals[e]&&t.length&&(this.newvals[e]=t.shift());for(var n=[],e=0;e<this.table.data.length&&!(this.whereClause.LIMIT>0&&n.length==this.whereClause.LIMIT);e++)if(this.whereClause.finalConditions.length<1){for(var a={},r=0;r<this.columns.length;r++)this.table.data[e][this.table.colmap[this.columns[r]]]=this.newvals[this.columns[r]],a[this.columns[r]]=this.table.data[e][this.table.colmap[this.columns[r]]];n.push(a)}else{for(var i=!1,s=this.whereClause.finalConditions.length;s--;){for(var o=this.whereClause.finalConditions[s],l=!0,u=o.length;u--;){var h=o[u];switch(h.type){case">":(isNaN(parseFloat(this.table.data[e][this.table.colmap[h.col]]))||this.table.data[e][this.table.colmap[h.col]]<h.value)&&(l=!1);break;case"<":(isNaN(parseFloat(this.table.data[e][this.table.colmap[h.col]]))||this.table.data[e][this.table.colmap[h.col]]>h.value)&&(l=!1);break;case"=":this.table.data[e][this.table.colmap[h.col]]!=h.value&&(l=!1);break;case"!=":break;case"%%":this.table.data[e][this.table.colmap[h.col]].indexOf(h.value)<0&&(l=!1);break;case"%-":this.table.data[e][this.table.colmap[h.col]].indexOf(h.value)!=this.table.data[e][this.table.colmap[h.col]].length-h.value.length&&(l=!1);break;case"-%":0!=this.table.data[e][this.table.colmap[h.col]].indexOf(h.value)&&(l=!1)}if(!l)break}if(l){i=!0;break}}if(i){for(var a={},r=0;r<this.columns.length;r++)this.table.data[e][this.table.colmap[this.columns[r]]]=this.newvals[this.columns[r]],a[this.columns[r]]=this.table.data[e][this.table.colmap[this.columns[r]]];n.push(a)}}return this.resultSet=n,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for an update query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for an update query"},this.from=function(){throw"from() is not a valid method for an update query"}}function o(){this.init=function(t,e){return this.tablename=t,this.columns=e,this},this.ifNotExists=function(){this.INEFlag=!0},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(window.jSQL.tables[this.tablename]=new t(this.tablename,this.columns,this.data)),this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a create query"},this.set=function(){throw"set() is not a valid method for a create query"},this.where=function(){throw"where() is not a valid method for a create query"},this.from=function(){throw"from() is not a valid method for a create query"}}function l(t){var e=function(t){for(var e=['"',"'","`"],n=e.length;n--;)if(t.substr(0,1)==e[n]&&t.substr(t.length-1,1)==e[n])return t.substr(1,t.length-2);return t},n=function(t){for(var n=0;n<jSQL.tables[o].columns.length;n++)if(e(t.toUpperCase())==jSQL.tables[o].columns[n].toUpperCase())return jSQL.tables[o].columns[n];throw t+" column not found in "+o+" table"},a=function(t){for(var e,n=[],a=!1,r=[],i=0;i<t.length;i++)if("'"===t[i]||'"'===t[i])if(a)if(t[i]!==e)r.push(t[i]);else if(i>0&&"\\"===t[i-1])if(i>1&&"\\"===t[i-2]){a=!1,n.push(r.join(""));var r=[]}else r[r.length-1]=t[i];else{a=!1,n.push(r.join(""));var r=[]}else e=t[i],a=!0;else if(a){if("\\"===t[i]&&i>0&&"\\"===t[i-1])continue;r.push(t[i])}else if("?"===t[i])n.push("?");else if(" "!==t[i]&&","!==t[i])return n;return n},r=function(t){for(var n=t.split(","),a={},r="",i=0,s=0;s<n.length;s++){var o=n[s].trim(),l="",u="",h=null,c=!1,f=o.split("");4!==i&&(i=0);for(var p=0;p<f.length;p++){var d=f[p];switch(i){case 0:if("="!==d&&" "!==d)l+=d;else if("="===d)if(" "==f[p+1]&&(p++,d=f[p]),isNaN(f[p+1]))if('"'==f[p+1]||"'"==f[p+1])h=f[p+1],i=1,p++;else{if("?"!=f[p+1])throw"Expected number or quoted string";p++,d=f[p],a[e(l)]="?",i=3}else i=2,c=!0;break;case 1:d===h?"\\"==f[p-1]?u+=d:(a[e(l)]=u,i=3):u+=d;break;case 2:" "==d&&(p++,d=f[p]),isNaN(d)&&"."!=d?(a[e(l)]=parseFloat(u),r+=d,i=3):u+=""+d;break;case 3:if(" "==d&&(p++,d=f[p]),void 0===d)break;i=4,r+=d;break;case 4:r+=d}}""!==u&&(a[e(l)]=c?parseFloat(u):u)}return{newVals:a,whereClause:r}},i=function(t,a){for(;a.length;){var r=a.shift();switch(r.toUpperCase()){case"WHERE":case"AND":var i;try{i=n(a.shift())}catch(s){return new function(t){this.execute=function(){throw t},this.fetch=function(){throw t},this.fetchAll=function(){throw t}}(s.message)}t=t.where(i);break;case"=":t=t.equals(e(a.shift()));break;case">":t=t.greaterThan(e(a.shift()));break;case"<":t=t.lessThan(e(a.shift()));break;case"!=":case"<>":t=t.doesNotEqual(e(a.shift()));break;case"LIKE":var o=e(a.shift());t="%"==o.substr(0,1)&&"%"==o.substr(o.length-1,1)?t.contains(o.substr(1,o.length-2)):"%"==o.substr(0,1)?t.endsWith(o.substr(1,o.length-1)):"%"==o.substr(o.length-1,1)?t.beginsWith(o.substr(0,o.length-1)):"?"===o?t.preparedLike():t.equals(o);break;case"OR":var i;try{i=n(a.shift())}catch(s){throw s.message}t=t.or(i);break;case"LIMIT":t=t.limit(a.shift());break;case"ORDER":if("BY"!=a.shift().toUpperCase())throw"Expected 'ORDER BY', got something else.";for(;a.length>0;){var l=a.shift();try{for(;l.indexOf(",")==l.length-1;)l=l.substr(0,l.length-1);l=n(l),w.push(l)}catch(u){a.unshift(l);break}}t=t.orderBy(w);break;case"ASC":if(!w.length)throw"Must call ORDER BY before using ASC.";t=t.asc();break;case"DESC":if(!w.length)throw"Must call ORDER BY before using DESC.";t=t.desc()}}return t};t=t.replace(/(\r\n|\n|\r)/gm," ").replace(/ +(?= )/g,"").trim();var s=t.split(" ");switch(s.shift().toUpperCase()){case"DELETE":if("FROM"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'TABLE'";var o=e(s.shift());if(void 0===jSQL.tables[o])throw"Table "+o+" does not exist.";var t=jSQL.deleteFrom(o);return t=i(t,s);case"DROP":if("TABLE"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'TABLE'";var o=e(s.shift());if(void 0===jSQL.tables[o])throw"Table "+o+" does not exist.";return jSQL.dropTable(o);case"INSERT":var o,l=[],u=[];if("INTO"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'INTO'";if(o=e(s.shift()),void 0===jSQL.tables[o])throw"Table "+o+" does not exist.";s=s.join(" ").split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" ");for(var h=s.shift();s.length&&"VALUES"!==h.toUpperCase();)l.push(e(h)),h=s.shift();if("VALUES"!==h.toUpperCase())throw"Unintelligible query. Expected 'VALUES' near '"+h+"'";var c=s.join(" ");if(u=a(c),!l.length)for(var f=0;f<u.length;f++){if(void 0===jSQL.tables[o].columns[f])throw"Error: too many values.";l.push(jSQL.tables[o].columns[f])}if(u.length!==l.length)throw"Error: Columns mismatch.";for(var p={},f=0;f<l.length;f++)p[l[f]]=u[f];return jSQL.insertInto(o).values(p);case"CREATE":var o,l=[],d=!1;if("TABLE"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'TABLE'";if(s=s.join(" ").split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" "),o=e(s.shift()),"IF"===o.toUpperCase()){if("NOT"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'NOT'";if("EXISTS"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'EXISTS'";o=e(s.shift()),d=!0}for(;s.length>0;)l.push(e(s.shift()));var t=jSQL.createTable(o,l);return d&&t.ifNotExists(),t;case"UPDATE":var o,t,w=[];o=e(s.shift());var m=s.shift().toUpperCase();if("SET"!==m)throw"Unintelligible query. Expected 'SET.'";var b=r(s.join(" "));return t=jSQL.update(o).set(b.newVals),t=i(t,b.whereClause.split(" "));case"SELECT":var o,g,t,w=[],v=t.toUpperCase().split(" ");v.shift();var y=v.indexOf("FROM");if(0>y)throw"Unintelligible query. Expected 'FROM'";g=s.splice(0,y);for(var f=g.length;f--;)for(;g[f].indexOf(",")==g[f].length-1;)g[f]=g[f].substr(0,g[f].length-1);s.shift(),o=s.shift();for(var E in jSQL.tables)if(jSQL.tables.hasOwnProperty(E)&&E.toUpperCase()==e(o.toUpperCase())){o=E;break}if(void 0===jSQL.tables[o])return new function(t){this.execute=function(){throw t},this.fetch=function(){throw t},this.fetchAll=function(){throw t}}("Table: "+o+" does not exist.");if(1==g.length&&"*"==g[0])g="*";else for(var f=0;f<g.length;f++)try{g[f]=n(g[f])}catch(C){throw C.message}return t=jSQL.select(g).from(o),t=i(t,s);default:throw"Unintelligible query. Error near: "+s[0]}}function u(t){var e=this;e.context=t,e.pendingColumn="",e.conditions=[],e.LIMIT=0,e.finalConditions=[],e.sortColumn=[],e.sortDirection="ASC",e.where=function(t){if(""!==e.pendingColumn)throw"Must add a conditional before adding another 'Where' condition.";if("string"!=typeof t)throw"Column name must be a string.";return e.pendingColumn=t,e},e.equals=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'equals' call.";return e.conditions.push({col:e.pendingColumn,type:"=",value:t}),e.pendingColumn="",e},e.preparedLike=function(){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'preparedLike' call.";return e.conditions.push({col:e.pendingColumn,type:"pl",value:"?"}),e.pendingColumn="",e},e.doesNotEqual=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'doesNotEqual' call.";return e.conditions.push({col:e.pendingColumn,type:"!=",value:t}),e.pendingColumn="",e},e.lessThan=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'lessThan' call.";return e.conditions.push({col:e.pendingColumn,type:"<",value:t}),e.pendingColumn="",e},e.greaterThan=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'greaterThan' call.";return e.conditions.push({col:e.pendingColumn,type:">",value:t}),e.pendingColumn="",e},e.contains=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'contains' call.";return e.conditions.push({col:e.pendingColumn,type:"%%",value:t}),e.pendingColumn="",e},e.endsWith=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'endsWith' call.";return e.conditions.push({col:e.pendingColumn,type:"%-",value:t}),e.pendingColumn="",e},e.beginsWith=function(t){if(""==e.pendingColumn)throw"Must add a 'where' clause before the 'beginsWith' call.";return e.conditions.push({col:e.pendingColumn,type:"-%",value:t}),e.pendingColumn="",e},e.and=function(t){return e.where(t)},e.or=function(t){return e.finalConditions.push(e.conditions),e.conditions=[],e.where(t)},e.limit=function(t){return e.LIMIT=parseInt(t),e},e.orderBy=function(t){return Array.isArray(t)||(t=[t]),e.sortColumn=t,e},e.asc=function(){if(""==e.sortColumn)throw"Must use orderBy clause before using ASC";return e.sortDirection="ASC",e},e.desc=function(){if(""==e.sortColumn)throw"Must use orderBy clause before using DESC";return e.sortDirection="DESC",e},e.execute=function(t){if(void 0===t&&(t=[]),e.conditions.length>0&&e.finalConditions.push(e.conditions),t.length>0)for(var n=e.finalConditions.length;n--;)for(var a=e.finalConditions[n].length;a--;)if("?"===e.finalConditions[n][a].value&&"pl"===e.finalConditions[n][a].type){var r=t.pop();"%"==r.substr(0,1)&&"%"==r.substr(r.length-1,1)?(e.finalConditions[n][a].value=r.substr(1,r.length-2),e.finalConditions[n][a].type="%%"):"%"==r.substr(0,1)?(e.finalConditions[n][a].value=r.substr(1,r.length-1),e.finalConditions[n][a].type="%-"):"%"==r.substr(r.length-1,1)?(e.finalConditions[n][a].value=r.substr(0,r.length-1),e.finalConditions[n][a].type="-%"):(e.finalConditions[n][a].value=r,e.finalConditions[n][a].type="=")}else"?"===e.finalConditions[n][a].value&&t.length>0&&(e.finalConditions[n][a].value=t.pop());return e.context.execute(t)},e.fetch=function(t){return e.context.fetch(t)},e.fetchAll=function(t){return e.context.fetchAll(t)}}function h(){var t=this;t.db=null;var e=function(e,n,a,r){"function"!=typeof a&&(a=function(){}),"function"!=typeof r&&(r=function(){throw"Could not execute query: "+e});var i,s,o;Array.isArray(n[0])||(n=[n]),o=n.length;var l=function(t,e){var n,r,i=[];if(o-=1,!o){for(n=0,r=e.rows.length;r>n;n+=1){var s=e.rows.item(n).json;i.push(s)}a(i)}};t.db.transaction(function(t){for(i=0,s=n.length;s>i;i+=1)t.executeSql(e,n[i],l,r)})};t.init=function(n,a){"function"!=typeof a&&(a=function(){});var r=function(){try{for(var a=n.length;a--;)(function(n,a){e("DROP TABLE IF EXISTS "+n,[],function(){e("CREATE TABLE IF NOT EXISTS "+n+"(json TEXT)",[],function(){t.insert(n,a)})})})(n[a].name,n[a].rows)}catch(r){throw"Error creating table"}};try{var i=window.location.href.replace(/\W+/g,"");t.db=openDatabase("jSQL_"+i,"1.0","jSQL "+i,5242880)}catch(s){throw"Error opening database"}e("SELECT COUNT(*) FROM "+n[0].name,[],null,function(){r()}),a()},t.insert=function(t,n,a){"function"!=typeof a&&(a=function(){});var r,i,s=n.length,o=[];for(0===s&&a(),r=0,i=n.length;i>r;r+=1)o[r]=[JSON.stringify(n[r])];e("INSERT INTO "+t+" (json) VALUES (?);",o,a)},t["delete"]=function(t,n){"function"!=typeof n&&(n=function(){}),e("DELETE FROM "+t,[],n)},t.select=function(t,n){e("SELECT json FROM "+t,[],function(t){for(var e=[],a=t.length;a--;)e.push(JSON.parse(t[a]));n(e)})}}function c(){var t=this;t.db=null;var e,n,a;t.init=function(r,i){"function"!=typeof i&&(i=function(){});try{e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,n=window.hasOwnProperty("webkitIndexedDB")?window.webkitIDBTransaction:window.IDBTransaction,a=window.hasOwnProperty("webkitIndexedDB")?window.webkitIDBKeyRange:window.IDBKeyRange}catch(s){throw"indexedDB is not supported in this browser"}if(!e)throw"indexedDB is not supported in this browser";var o=1,l=window.location.href.replace(/\W+/g,""),u=e.open("jSQL_"+l,o),h=function(){for(var e=r.length;e--;)t.db.objectStoreNames.contains(r[e].name)&&t.db.deleteObjectStore(r[e].name),t.db.createObjectStore(r[e].name,{keyPath:"_id",autoIncrement:!0});var n=0,a=!1,i=setInterval(function(){if(!a){a=!0;try{for(var e=r.length;e--;){var s=r[e].name,o=void 0==r[e].rows?[]:r[e].rows;t.insert(s,o)}clearInterval(i)}catch(l){if(n>1e3)throw clearInterval(i),"Could not add data after 10 seconds.";a=!1}}},10)};u.onsuccess=function(e){var n;t.db=e.target.result,o=String(o),t.db.setVersion&&o!==t.db.version?(n=t.db.setVersion(o),n.onfailure=function(){throw"Error updating datastore version"},n.onsuccess=function(t){h(),n.result.oncomplete=function(){i()}}):i()},u.onupgradeneeded=function(e){t.db=e.target.result,h()},u.onerror=function(t){throw"Could not connect to the indexedDB datastore."}},t.insert=function(e,a,r){"function"!=typeof r&&(r=function(){});var i,s,o,l=t.db.transaction([e],n.READ_WRITE||"readwrite"),u=a.length,h=function(){u-=1,0===u&&r(u)};l.onerror=function(){throw"Could not initiate a transaction"},i=l.objectStore(e);for(s in a)a.hasOwnProperty(s)&&(o=i.add(a[s]),o.onsuccess=h,o.onerror=function(){throw"Could not initiate a request"})},t["delete"]=function(e,a){"function"!=typeof a&&(a=function(){});var r,i,s=t.db.transaction([e],n.READ_WRITE||"readwrite");s.onerror=function(){throw"Could not initiate a transaction"},r=s.objectStore(e),i=r.clear(),i.onerror=function(){throw"Could not initiate a request"},i.onsuccess=a},t.select=function(e,a){"function"!=typeof a&&(a=function(){});var r,i,s=t.db.transaction([e],n.READ_ONLY||"readonly"),o=[];s.onerror=function(){throw"Could not initiate a transaction"},r=s.objectStore(e),i=r.openCursor(),i.onerror=function(){throw"Could not initiate a request"};var l=!1;i.onsuccess=function(t){if(!l){var e=t.target.result;return e?(o.push(e.value),void e["continue"]()):(l=!0,void a(o))}}}}function f(t,n){return Array.isArray(n)||(n=[n]),new e("CREATE").init(t,n)}function p(t){return Array.isArray(t)||(t=[t]),new e("SELECT").init(t)}function d(t){return new e("UPDATE").init(t)}function w(t){return new e("INSERT").init(t)}function m(t){return new e("DROP").init(t)}function b(t){return new e("DELETE").init(t)}var g=new function(){var t=this;t.api=null,t.error=!1,t.persist=function(e){if("function"==typeof e&&(e=function(){}),t.error!==!1)throw t.error;var n=[];for(var a in jSQL.tables)if(jSQL.tables.hasOwnProperty(a))for(var r=jSQL.select("*").from(a).execute().fetchAll(),i=r.length;i--;){var s=r[i];for(var o in s)s.hasOwnProperty(o)&&"function"==typeof s[o]&&(s[o]="#jSQLFunct#"+s[o].toString());n.push({table:a,data:JSON.stringify(s)})}t.api["delete"]("jSQL_data_schema",function(){t.api.insert("jSQL_data_schema",n,e)})},t.load=function(e){"function"!=typeof e&&(e=function(){}),function n(a){try{t.api.select("jSQL_data_schema",function(t){if(jSQL.tables={},0===t.length)return e();for(var n=t.length;n--;){var a=t[n].table,r=JSON.parse(t[n].data);if(void 0===jSQL.tables[a]){var i=[];for(var s in r)r.hasOwnProperty(s)&&i.push(s);jSQL.createTable(a,i).execute()}for(var s in r)r.hasOwnProperty(s)&&"string"==typeof r[s]&&0===r[s].indexOf("#jSQLFunct#")&&(r[s]=exec(r[s].substr(11)));jSQL.tables[a].insertRow(r)}return e()})}catch(r){if(a>500)return e();setTimeout(function(){n(a+1)},10)}}(0)},function(){try{t.api=new c,t.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(e){try{t.api=new h,t.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(n){t.error="Browser doesn't support Web SQL or IndexedDB"}}}()};return{tables:{},query:l,createTable:f,dropTable:m,select:p,update:d,deleteFrom:b,insertInto:w,persist:g.persist,load:g.load}}();