/**
 * jSQL.js v2
 * A Javascript Query Language Database Engine
 * @author Robert Parham
 * @website https://github.com/Pamblam/jSQL#jsql
 * @license http://www.apache.org/licenses/LICENSE-2.0
 */
window.jSQL=function(){"use strict";function jSQLDataTypeList(){this.list=[{type:"NUMERIC",aliases:["NUMBER","DECIMAL","FLOAT"],serialize:function(e,t){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):0},unserialize:function(e,t){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):0}},{type:"JSON",aliases:["ARRAY","OBJECT"],serialize:function(e,t){return JSON.stringify(e)},unserialize:function(e,t){return JSON.parse(e)}},{type:"FUNCTION",serialize:function(e,t){return"function"!=typeof e&&(e=function(){}),"jSQLFunct-"+e.toString()},unserialize:function(value,args){var p=value.split("-");if("jSQLFunct"!==p.shift())throw"Corrupted function stored in data";p=value.split("-"),p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f;throw"Corrupted function stored in data"}},{type:"BOOLEAN",aliases:["BOOL"],serialize:function(e,t){return!!e},unserialize:function(e,t){return!!e}},{type:"INT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0}},{type:"CHAR",aliases:["VARCHAR","LONGTEXT","MEDIUMTEXT"],serialize:function(e,t){return""+e},unserialize:function(e,t){return""+e}},{type:"DATE",serialize:function(e,t){return e instanceof Date?e.getTime():new Date(0).getTime()},unserialize:function(e,t){return new Date(e)}},{type:"AMBI",serialize:function(e,t){return e instanceof Date?e.getTime():"function"==typeof e?"jSQLFunct-"+e.toString():!isNaN(parseFloat(e))&&isFinite(e)?e:""+e},unserialize:function(value,args){if("string"==typeof value&&"jSQLFunct"===value.split("-")[0]){var p=value.split("-");p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f}return value}}],this.add=function(e){if("object"!=typeof e)throw"Invalid datatype definition";if(void 0===e.type)throw"DataType must have a `type` property.";if("function"!=typeof e.serialize)throw"DataType must have a `serialize` function.";if("function"!=typeof e.unserialize)throw"DataType must have an `unserialize` function.";this.list.push({type:e.type.toUpperCase(),aliases:Array.isArray(e.aliases)?e.aliases:[],serialize:e.serialize,unserialize:e.unserialize})},this.exists=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return!0;return!1},this.getByType=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return this.list[t];throw e+" is not a supported datatype"}}function jSQLTable(e,t,n,r,i){var a=this;a.name="",a.columns=[],a.data=[],a.colmap={},a.types=[],a.keys={primary:{column:!1,map:{}},unique:[]},a.init=function(e,t,n,r,i){if(a.name=e,void 0===r&&(r=[]),!Array.isArray(r))throw"Invalid table types array";if(Array.isArray(t)&&void 0===n&&(n=t,t=[]),Array.isArray(t)&&!Array.isArray(t[0])&&"object"==typeof t[0]){var s=[];for(var e in t[0])t[0].hasOwnProperty(e)&&s.push(e);n=t,t=s}if(!Array.isArray(t))throw"Columns must be an array.";a.columns=t;for(var o=0;o<t.length;o++)a.types[o]=void 0===r[o]||void 0===r[o].type?{type:"ambi",args:[]}:r[o];for(var o=a.types.length;o--;){var u=a.types[o].type.toUpperCase();if(!jSQL.types.exists(u))throw u+" is not a supported data type";a.types[o].type=u}for(var o=0;o<t.length;o++)a.colmap[t[o]]=o;for(var l,c=["primary","unique"],h=0;l=i[h];h++){if(!l.hasOwnProperty("column")||!Array.isArray(l.column)&&-1===a.columns.indexOf(l.column))throw"Invalid constraint";if(Array.isArray(l.column))for(var f=0;f<l.column.length;f++)if(-1===a.columns.indexOf(l.column[f]))throw"Invalid constraint";var u=l.hasOwnProperty("type")&&-1!==c.indexOf(l.type.toLowerCase())?l.type.toLowerCase():"unique";if("primary"==u&&a.keys.primary.column!==!1)throw"This table already has a primary key";"primary"==u&&(a.keys.primary.column=l.column),"unique"==u&&a.keys.unique.push({column:l.column,map:{}})}void 0!==n&&a.loadData(n)},a.renameColumn=function(e,t){if(void 0===e||"string"!=typeof t)throw"renameColumn expects and old column name and a new one, both must be strings.";if(a.columns.indexOf(e)<0)throw"The column "+e+" does not exist in this table.";if(a.columns.splice(a.columns.indexOf(e),1,t),a.keys.primary.column===e&&(a.keys.primary.column=t),Array.isArray(a.keys.primary.column))for(var n=a.keys.primary.column.length;n--;)a.keys.primary.column[n]===e&&(a.keys.primary.column[n]=t);for(var r=a.keys.unique.length;r--;)if(a.keys.unique[r].column===e&&(a.keys.unique[r].column=t),Array.isArray(a.keys.unique[r].column))for(var n=a.keys.unique[r].column.length;n--;)a.keys.unique[r].column[n]===e&&(a.keys.unique[r].column[n]=t);var i={};for(var s in a.colmap)a.colmap.hasOwnProperty(s)&&(s===e?i[t]=a.colmap[s]:i[s]=a.colmap[s]);a.colmap=i},a.addColumn=function(e,t,n){(void 0===n||void 0===n.type)&&(n={type:"AMBI",args:[]}),n.type=n.type.toUpperCase(),void 0===t&&(t=null),"string"!=typeof e&&(e=function i(e){for(var t=0;t<a.columns.length;t++)if(a.columns[t]=="u"+e)return i(e+1);return"u"+e}(0)),a.columns.push(e);for(var r=a.data.length;r--;)a.data[r].push(t);if(a.colmap[e]=a.columns.length-1,!jSQL.types.exists(n.type))throw n.type+" is not a supported data type";a.types.push(n)},a.loadData=function(e){if(!Array.isArray(e))throw"Data must be an array.";var t=e.length;for(a.columns.length;t--;)a.insertRow(e[t])},a.insertRow=function(e,t){var n=[];if(Array.isArray(e)){for(;e.length>a.columns.length;)a.addColumn();for(;e.length<a.columns.length;)e.push(null);for(var r=0;r<e.length;r++)n.push(e[r]);for(;n.length<a.columns.length;)n.push(null)}else{if("object"!=typeof e)throw"Data not structured properly.";for(var r=0;r<a.columns.length;r++)void 0===e[a.columns[r]]&&(e[a.columns[r]]=null);for(var i in e)if(!e.hasOwnProperty(i))continue;if(function(e){for(;e--;)if(a.columns[e]==i)return 0;return 1}(a.columns.length))if(a.columns.indexOf("u0")>-1){a.renameColumn("u0",i);for(var s=1;a.columns.indexOf("u"+s)>-1;)a.renameColumn("u"+s,"u"+(s-1))}else a.addColumn(i);for(var r=0;r<a.columns.length;r++)n.push(e[a.columns[r]])}for(var s=n.length;s--;)n[s]=a.normalizeColumnStoreValue(a.columns[s],n[s]);if(a.keys.primary.column){for(var o,u=Array.isArray(a.keys.primary.column)?a.keys.primary.column:[a.keys.primary.column],l=[],c=0;o=u[c];c++){var h=a.colmap[o];if(null===n[h]){if(t===!0)return;throw"Cannot insert a null value in a primary column"}l.push(n[h])}if(l=JSON.stringify(l),a.keys.primary.map.hasOwnProperty(l)){if(t===!0)return;throw"Primary key violated"}a.keys.primary.map[l]=a.data.length}for(var f,p=0;f=a.keys.unique[p];p++){for(var d,y=Array.isArray(f.column)?f.column:[f.column],m=[],g=0;d=y[g];g++){var w=a.colmap[d];if(null===n[w]){if(t===!0)return;throw"Cannot insert a null value in a unique column"}m.push(n[w])}if(m=JSON.stringify(m),f.map.hasOwnProperty(m)){if(t===!0)return;throw"Unique key violated"}a.keys.unique[p].map[m]=a.data.length}a.data.push(n)},a.normalizeColumnStoreValue=function(e,t){var n=a.types[a.colmap[e]],r=jSQL.types.getByType(n.type.toUpperCase()).serialize(t,n.args);if(!isNaN(parseFloat(r))&&isFinite(r)||"string"==typeof r)return r;throw n.type.toUpperCase()+".serialize() must return a number or a string."},a.normalizeColumnFetchValue=function(e,t){var n=a.types[a.colmap[e]];return jSQL.types.getByType(n.type.toUpperCase()).unserialize(t,n.args)},a.init(e,t,n,r,i)}function jSQLQuery(e){var t=this;t.type=e.toUpperCase(),t.tablename=null,t.columns=[],t.data=[],t.INEFlag=!1,t.coltypes=[],t.table=null,t.newvals={},t.whereClause=new jSQLWhereClause(t),t.resultSet=[],t.init=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).init.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).init.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).init.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).init.apply(t,arguments);case"DROP":return(new jSQLDropQuery).init.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).init.apply(t,arguments)}},t.ifNotExists=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).ifNotExists.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).ifNotExists.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).ifNotExists.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).ifNotExists.apply(t,arguments);case"DROP":return(new jSQLDropQuery).ifNotExists.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).ifNotExists.apply(t,arguments)}},t.execute=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).execute.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).execute.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).execute.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).execute.apply(t,arguments);case"DROP":return(new jSQLDropQuery).execute.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).execute.apply(t,arguments)}},t.fetch=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).fetch.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).fetch.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).fetch.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).fetch.apply(t,arguments);case"DROP":return(new jSQLDropQuery).fetch.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).fetch.apply(t,arguments)}},t.ignore=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).ignore.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).ignore.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).ignore.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).ignore.apply(t,arguments);case"DROP":return(new jSQLDropQuery).ignore.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).ignore.apply(t,arguments)}},t.fetchAll=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).fetchAll.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).fetchAll.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).fetchAll.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).fetchAll.apply(t,arguments);case"DROP":return(new jSQLDropQuery).fetchAll.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).fetchAll.apply(t,arguments)}},t.values=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).values.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).values.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).values.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).values.apply(t,arguments);case"DROP":return(new jSQLDropQuery).values.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).values.apply(t,arguments)}},t.set=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).set.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).set.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).set.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).set.apply(t,arguments);case"DROP":return(new jSQLDropQuery).set.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).set.apply(t,arguments)}},t.where=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).where.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).where.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).where.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).where.apply(t,arguments);case"DROP":return(new jSQLDropQuery).where.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).where.apply(t,arguments)}},t.from=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).from.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).from.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).from.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).from.apply(t,arguments);case"DROP":return(new jSQLDropQuery).from.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).from.apply(t,arguments)}},t.orderBy=function(e){switch(t.type){case"CREATE":return(new jSQLCreateQuery).orderBy.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).orderBy.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).orderBy.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).orderBy.apply(t,arguments);case"DROP":return(new jSQLDropQuery).orderBy.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).orderBy.apply(t,arguments)}},t.asc=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).asc.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).asc.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).asc.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).asc.apply(t,arguments);case"DROP":return(new jSQLDropQuery).asc.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).asc.apply(t,arguments)}},t.desc=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).desc.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).desc.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).desc.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).desc.apply(t,arguments);case"DROP":return(new jSQLDropQuery).desc.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).desc.apply(t,arguments)}},t.limit=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).limit.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).limit.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).limit.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).limit.apply(t,arguments);case"DROP":return(new jSQLDropQuery).limit.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).limit.apply(t,arguments)}},t.distinct=function(){switch(t.type){case"CREATE":return(new jSQLCreateQuery).distinct.apply(t,arguments);case"UPDATE":return(new jSQLUpdateQuery).distinct.apply(t,arguments);case"SELECT":return(new jSQLSelectQuery).distinct.apply(t,arguments);case"INSERT":return(new jSQLInsertQuery).distinct.apply(t,arguments);case"DROP":return(new jSQLDropQuery).distinct.apply(t,arguments);case"DELETE":return(new jSQLDeleteQuery).distinct.apply(t,arguments)}}}function jSQLDeleteQuery(){this.init=function(e){if(void 0===jSQL.tables[e])throw"Table: "+e+" doesn't exist.";return this.table=jSQL.tables[e],this},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],n=[],r=0;r<this.table.data.length;r++)e.indexOf(r)>-1?t.push(this.table.data[r]):n.push(this.table.data[r]);return this.table.data=n,this.resultSet=t,this},this.where=function(e){return this.whereClause.where(e)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a delete query"},this.ignore=function(){throw"ignore() is not a valid method for a delete query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a delete query"},this.set=function(){throw"set() is not a valid method for a delete query"},this.from=function(){throw"from() is not a valid method for a delete query"},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLDropQuery(){this.init=function(e){return this.tablename=e,this},this.execute=function(){if(void 0===jSQL.tables[this.tablename])throw"Table "+this.tablename+" does not exist.";return delete jSQL.tables[this.tablename],this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a drop query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a drop query"},this.set=function(){throw"set() is not a valid method for a drop query"},this.where=function(){throw"where() is not a valid method for a drop query"},this.from=function(){throw"from() is not a valid method for a drop query"},this.orderBy=function(){throw"orderBy() is not a valid method for a drop query"},this.asc=function(){throw"asc() is not a valid method for a drop query"},this.desc=function(){throw"desc() is not a valid method for a drop query"},this.limit=function(){throw"limit() is not a valid method for a drop query"},this.distinct=function(){throw"distinct() is not a valid method for a drop query"},this.ignore=function(){throw"ignore() is not a valid method for a drop query"}}function jSQLInsertQuery(){this.init=function(e){return this.table=e,this.ignoreFlag=!1,this},this.values=function(e){if(void 0===jSQL.tables[this.table])throw"Table: "+this.table+" doesn't exist.";return this.data=e,this},this.execute=function(e){if(void 0!==e&&Array.isArray(e)&&e.length>0)if(Array.isArray(this.data))for(var t=this.data.length;t--&&e.length;)"?"==this.data[t]&&(this.data[t]=e.shift());else for(var t in this.data)this.data.hasOwnProperty(t)&&e.length&&"?"==this.data[t]&&(this.data[t]=e.shift());return jSQL.tables[this.table].insertRow(this.data,this.ignoreFlag),this},this.ignore=function(){return this.ignoreFlag=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for an insert query"},this.set=function(){throw"set() is not a valid method for an insert query"},this.where=function(){throw"where() is not a valid method for an insert query"},this.from=function(){throw"from() is not a valid method for an insert query"},this.orderBy=function(){throw"orderBy() is not a valid method for an update query"},this.asc=function(){throw"asc() is not a valid method for an update query"},this.desc=function(){throw"desc() is not a valid method for an update query"},this.limit=function(){throw"limit() is not a valid method for an insert query"},this.distinct=function(){throw"distinct() is not a valid method for an insert query"}}function jSQLSelectQuery(){this.init=function(e){return this.columns=Array.isArray(e)?e:[e],this},this.from=function(e){if(void 0===jSQL.tables[e])throw"Table: "+e+" doesn't exist.";return this.table=jSQL.tables[e],"*"==this.columns[0]&&(this.columns=this.table.columns),this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],n=0;n<e.length;n++)t.push(this.table.data[e[n]]);for(var r=[],n=0;n<t.length;n++){for(var i={},a=0;a<this.columns.length;a++)i[this.columns[a]]=t[n][this.table.colmap[this.columns[a]]];r.push(i)}return this.resultSet=r,this},this.fetch=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)throw"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or blank";if(!this.resultSet.length)return!1;var t=this.resultSet.shift();for(var n in t)if(t.hasOwnProperty(n)){var r=this.table.normalizeColumnFetchValue(n,t[n]);t[n]=r}if("ARRAY"==e){var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push(t[i]);t=r}return t},this.fetchAll=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)throw"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or blank";if(!this.resultSet.length)return!1;for(var t=[];this.resultSet.length>0;)t.push(this.fetch(e));return t},this.ignore=function(){throw"ignore() is not a valid method for a select query"},this.values=function(){throw"values() is not a valid method for a select query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for a select query"},this.set=function(){throw"set() is not a valid method for a select query"},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLUpdateQuery(){this.init=function(e){if(void 0===jSQL.tables[e])throw"Table: "+e+" doesn't exist.";return this.table=this.table=jSQL.tables[e],this},this.set=function(e){this.newvals=e;for(var t in e)e.hasOwnProperty(t)&&this.columns.push(t);return this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(e){if(void 0!==e&&Array.isArray(e))for(var t in this.newvals)this.newvals.hasOwnProperty(t)&&"?"==this.newvals[t]&&e.length&&(this.newvals[t]=e.shift());for(var n=this.whereClause.getResultRowIndexes(),r=[],t=0;t<n.length;t++){for(var i=n[t],a={},s=0;s<this.columns.length;s++)this.table.data[i][this.table.colmap[this.columns[s]]]=this.newvals[this.columns[s]],a[this.columns[s]]=this.table.data[i][this.table.colmap[this.columns[s]]];r.push(a)}return this.resultSet=r,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for an update query"},this.ifNotExists=function(){throw"ifNotExists() is not a valid method for an update query"},this.from=function(){throw"from() is not a valid method for an update query"},this.ignore=function(){throw"ignore() is not a valid method for an update query"},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLCreateQuery(){this.init=function(e,t,n,r){return this.tablename=e,this.columns=t,this.coltypes=n,this.keys=r,this},this.ifNotExists=function(){return this.INEFlag=!0,this},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(window.jSQL.tables[this.tablename]=new jSQLTable(this.tablename,this.columns,this.data,this.coltypes,this.keys)),this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){throw"values() is not a valid method for a create query"},this.set=function(){throw"set() is not a valid method for a create query"},this.where=function(){throw"where() is not a valid method for a create query"},this.from=function(){throw"from() is not a valid method for a create query"},this.orderBy=function(){throw"orderBy() is not a valid method for a create query"},this.asc=function(){throw"asc() is not a valid method for a create query"},this.desc=function(){throw"desc() is not a valid method for a create query"},this.limit=function(){throw"limit() is not a valid method for a create query"},this.distinct=function(){throw"distinct() is not a valid method for a create query"},this.ignore=function(){throw"ignore() is not a valid method for a create query"}}function jSQLParseQuery(e){var t=function(e){for(var t=['"',"'","`"],n=t.length;n--;)if(e.substr(0,1)==t[n]&&e.substr(e.length-1,1)==t[n])return e.substr(1,e.length-2);return e},n=function(e){for(var n=0;n<jSQL.tables[u].columns.length;n++)if(t(e.toUpperCase())==jSQL.tables[u].columns[n].toUpperCase())return jSQL.tables[u].columns[n];throw e+" column not found in "+u+" table"},r=function(e){for(var t,n="+,-,0,1,2,3,4,5,6,7,8,9,0,.".split(","),r=[],i=!1,a=[],s=0;s<e.length;s++)if("'"===e[s]||'"'===e[s])if(i)if(e[s]!==t)a.push(e[s]);else if(s>0&&"\\"===e[s-1])if(s>1&&"\\"===e[s-2]){i=!1,r.push(a.join(""));var a=[]}else a[a.length-1]=e[s];else{i=!1,r.push(a.join(""));var a=[]}else t=e[s],i=!0;else if(i){if("\\"===e[s]&&s>0&&"\\"===e[s-1])continue;a.push(e[s])}else if("?"===e[s])r.push("?");else if(n.indexOf(e[s])>-1){for(var o="";n.indexOf(e[s])>-1&&s<e.length;)o+=e[s],s++;r.push(parseFloat(o))}else if(" "!==e[s]&&","!==e[s])return r;return r},i=function(e){for(var n=[],r="",i=["'",'"',"`"],a=!1,s="",o=0;o<e.length;o++)!a&&i.indexOf(e[o])>-1?(a=!0,s=e[o],r+=e[o]):a&&e[o]===s?(a=!1,s="",r+=e[o]):a||","!==e[o]?r+=e[o]:(n.push(r),r="");n.push(r),r="";for(var u={},l="",c=0,o=0;o<n.length;o++){var h=n[o].trim(),f="",p="",s=null,d=!1,y=h.split("");4!==c&&(c=0);for(var m=0;m<y.length;m++){var g=y[m];switch(c){case 0:if("="!==g&&" "!==g)f+=g;else if("="===g)if(" "==y[m+1]&&(m++,g=y[m]),isNaN(y[m+1]))if('"'==y[m+1]||"'"==y[m+1])s=y[m+1],c=1,m++;else{if("?"!=y[m+1])throw"Expected number or quoted string";m++,g=y[m],u[t(f)]="?",c=3}else c=2,d=!0;break;case 1:g===s?"\\"==y[m-1]?p+=g:(u[t(f)]=p,c=3):p+=g;break;case 2:" "==g&&(m++,g=y[m]),isNaN(g)&&"."!=g?(u[t(f)]=parseFloat(p),l+=g,c=3):p+=""+g;break;case 3:if(" "==g&&(m++,g=y[m]),void 0===g)break;c=4,l+=g;break;case 4:l+=g}}l+=",",""!==p&&(u[t(f)]=d?parseFloat(p):p)}return","===l.substring(l.length-1)&&(l=l.substring(0,l.length-1)),{newVals:u,whereClause:l}},a=function(e,r){for(;r.length;){var i=r.shift();switch(i.toUpperCase()){case"WHERE":case"AND":var a;try{a=n(r.shift())}catch(s){return new function(e){this.execute=function(){throw e},this.fetch=function(){throw e},this.fetchAll=function(){throw e}}(s.message)}e=e.where(a);break;case"=":e=e.equals(t(r.shift()));break;case">":e=e.greaterThan(t(r.shift()));break;case"<":e=e.lessThan(t(r.shift()));break;case"!=":case"<>":e=e.doesNotEqual(t(r.shift()));break;case"LIKE":var u=t(r.shift());e="%"==u.substr(0,1)&&"%"==u.substr(u.length-1,1)?e.contains(u.substr(1,u.length-2)):"%"==u.substr(0,1)?e.endsWith(u.substr(1,u.length-1)):"%"==u.substr(u.length-1,1)?e.beginsWith(u.substr(0,u.length-1)):"?"===u?e.preparedLike():e.equals(u);break;case"OR":var a;try{a=n(r.shift())}catch(s){throw s.message}e=e.or(a);break;case"LIMIT":var l,c=r.shift(),h=!1;if(","===c[c.length-1]&&(c=c.substring(0,c.length-1),h=!0),!h&&c.indexOf(",")>0){var f=c.split(",");c=f[0],r.unshift(f[1]),h=!0}if(!h&&r.length){var p=r.shift();","===p[0]?(h=!0,p.length>1&&(p=p.substring(1,c.length),r.unshift(p))):r.unshift(p)}if(h&&(l=c,c=r.shift()),r.length&&!h){var p=r.shift();"OFFSET"===p.toUpperCase()?l=r.shift():r.unshift(p)}e=e.limit(c,l);break;case"ORDER":if("BY"!=r.shift().toUpperCase())throw"Expected 'ORDER BY', got something else.";for(;r.length>0;){var p=r.shift();try{for(;p.indexOf(",")==p.length-1;)p=p.substr(0,p.length-1);p=n(p),o.push(p)}catch(d){r.unshift(p);break}}e=e.orderBy(o);break;case"ASC":if(!o.length)throw"Must call ORDER BY before using ASC.";e=e.asc();break;case"DESC":if(!o.length)throw"Must call ORDER BY before using DESC.";e=e.desc()}}return e};e=jSQL.minify(e);var s=e.split(" ");switch(s.shift().toUpperCase()){case"DELETE":var o=[];if("FROM"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'FROM'";var u=t(s.shift());if(void 0===jSQL.tables[u])throw"Table "+u+" does not exist.";var e=jSQL.deleteFrom(u);return e=a(e,s);case"DROP":if("TABLE"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'TABLE'";var u=t(s.shift());if(0===u.indexOf("`")){u=u.substring(1);for(var l=" "+s.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&s.shift(),u+=h}u=t("`"+u)}if(void 0===jSQL.tables[u])throw"Table "+u+" does not exist.";return jSQL.dropTable(u);case"INSERT":var u,f=[],p=[],d=!1,y=s.shift().toUpperCase();if("IGNORE"===y&&(d=!0,y=s.shift().toUpperCase()),"INTO"!==y)throw"Unintelligible query. Expected 'INTO'";if(u=t(s.shift()),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+s.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&s.shift(),u+=h}u=t("`"+u)}if(void 0===jSQL.tables[u])throw"Table "+u+" does not exist.";s=s.join(" ").split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" ");for(var m=s.shift();s.length&&"VALUES"!==m.toUpperCase();)f.push(t(m)),m=s.shift();if("VALUES"!==m.toUpperCase())throw"Unintelligible query. Expected 'VALUES' near '"+m+"'";var g=s.join(" ");if(p=r(g),!f.length)for(var c=0;c<p.length;c++){if(void 0===jSQL.tables[u].columns[c])throw"Error: too many values.";f.push(jSQL.tables[u].columns[c])}if(p.length!==f.length)throw"Error: Columns mismatch.";for(var w={},c=0;c<f.length;c++)w[f[c]]=p[c];var v=jSQL.insertInto(u).values(w);return d?v.ignore():v;case"CREATE":var u,S,Q={},f=[],b=!1;if("TABLE"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'TABLE'";var E=s.join(" "),L="",C=(E.match(/\(/g)||[]).length,j=(E.match(/\)/g)||[]).length;if(C!==j)throw"Invalid Column definition.";if(C>0&&(L=E.substring(E.indexOf("(")+1,E.lastIndexOf(")"))),s=E.split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" "),u=t(s.shift()),"IF"===u.toUpperCase()){if("NOT"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'NOT'";if("EXISTS"!==s.shift().toUpperCase())throw"Unintelligible query. Expected 'EXISTS'";u=t(s.shift()),b=!0}if(0===u.indexOf("`")){u=u.substring(1);for(var l=" "+s.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&s.shift(),u+=h}u=t("`"+u)}Q[u]=[];for(var T=L.split(","),c=0;c<T.length;c++){for(var E=T[c];(E.match(/\(/g)||[]).length!==(E.match(/\)/g)||[]).length;)E+=","+T[c+1],T[c+1]="",T[c]=E;""!==E.trim()&&f.push(E.trim())}for(var A=[],c=0;c<f.length;c++){var x=f[c].split(" "),D=t(x.shift());if("PRIMARY"!=D.toUpperCase()&&"UNIQUE"!=D.toUpperCase()){if(Q[u][c]={name:D,type:"AMBI",args:[]},x.length){for(var O=[],I=!1,R=!1,U=0;U<x.length;U++)"PRIMARY"===x[U].toUpperCase()?I=U:"UNIQUE"===x[U].toUpperCase()?R=U:"KEY"===x[U].toUpperCase()&&I!==!1&&U===1+I||"KEY"===x[U].toUpperCase()&&R!==!1&&U===1+R||O.push(x[U]);if(x=O,!1!==I&&A.push({column:D,type:"primary"}),!1!==R&&A.push({column:D,type:"unique"}),!x.length)continue;var N=x.shift().toUpperCase();if((N.match(/\(/g)||[]).length){for(;!(N.match(/\)/g)||[]).length;){if(!x.length)throw"Invalid query, expected ')'";N+=" "+x.shift()}""!==N.substring(N.lastIndexOf(")")+1)&&(x.unshift(N.substring(N.lastIndexOf(")")+1)),N.substring(0,N.lastIndexOf(")")))}!(N.match(/\(/g)||[]).length&&x.length&&"("===x[0].charAt(0)&&(N+=x[0].substring(0,x[0].indexOf(")")+1),x[0]=x[0].substring(x[0].indexOf(")")+1));var q="";if(N.indexOf("(")>-1){var C=(N.match(/\(/g)||[]).length,j=(N.match(/\)/g)||[]).length;if(C!==j)throw"Invalid Arg definition: "+N;C>0&&(q=N.substring(N.indexOf("(")+1,N.lastIndexOf(")")))}if(""!==q.trim())for(var k=q.split(","),P=0;P<k.length;P++)""!==k[P].trim()&&Q[u][c].args.push(k[P].trim());Q[u][c].type=N.split("(")[0].trim().toUpperCase()}}else{for(var h,B=!1,F=!1,M=[],z="",S=0;h=f[c][S];S++)if("("!==h){if(B)if(-1===['"',"`","'"].indexOf(h))if(" "!==h||F){if(B===!0&&")"===h){""!==z&&M.push(z),z="";break}(","!=h||F)&&(z+=h)}else""!==z&&M.push(z),z="";else F===!1?F=h:F===h?(F=!1,M.push(z),z=""):z+=h}else B=!0;A.push({column:M,type:D.toLowerCase()})}}var e=jSQL.createTable(Q,A);return b&&e.ifNotExists(),e;case"UPDATE":var u,e,o=[];if(u=t(s.shift()),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+s.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&s.shift(),u+=h}u=t("`"+u)}for(var W in jSQL.tables)if(jSQL.tables.hasOwnProperty(W)&&W.toUpperCase()==t(u.toUpperCase())){u=W;break}var _=s.shift().toUpperCase();if("SET"!==_)throw"Unintelligible query. Expected 'SET.'";var T=i(s.join(" "));return e=jSQL.update(u).set(T.newVals),e=a(e,T.whereClause.split(" "));case"SELECT":var u,Y,e,o=[],V=!1,J=e.toUpperCase().split(" ");J.shift();var X=J.indexOf("FROM");if(0>X)throw"Unintelligible query. Expected 'FROM'";Y=s.splice(0,X),"ALL"===Y[0].toUpperCase()&&Y.shift(),("DISTINCT"===Y[0].toUpperCase()||"DISTINCTROW"===Y[0].toUpperCase())&&(Y.shift(),V=!0);for(var c=Y.length;c--;)for(;Y[c].indexOf(",")==Y[c].length-1;)Y[c]=Y[c].substr(0,Y[c].length-1);if(s.shift(),u=s.shift(),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+s.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&s.shift(),u+=h}u=t("`"+u)}for(var W in jSQL.tables)if(jSQL.tables.hasOwnProperty(W)&&W.toUpperCase()==t(u.toUpperCase())){u=W;break}if(void 0===jSQL.tables[u])return new function(e){this.execute=function(){throw e},this.fetch=function(){throw e},this.fetchAll=function(){throw e}}("Table: "+u+" does not exist.");if(1==Y.length&&"*"==Y[0])Y="*";else for(var c=0;c<Y.length;c++)try{Y[c]=n(Y[c])}catch(K){throw K.message}return e=jSQL.select(Y).from(u),
V&&(e=e.distinct()),e=a(e,s);default:throw"Unintelligible query. Error near: "+s[0]}}function jSQLWhereClause(e){var t=this;t.context=e,t.pendingColumn="",t.conditions=[],t.LIMIT=0,t.OFFSET=0,t.finalConditions=[],t.sortColumn=[],t.sortDirection="ASC",t.isDistinct=!1,t.where=function(e){if(""!==t.pendingColumn)throw"Must add a conditional before adding another 'Where' condition.";if("string"!=typeof e)throw"Column name must be a string.";return t.pendingColumn=e,t},t.equals=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'equals' call.";return t.conditions.push({col:t.pendingColumn,type:"=",value:e}),t.pendingColumn="",t},t.preparedLike=function(){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'preparedLike' call.";return t.conditions.push({col:t.pendingColumn,type:"pl",value:"?"}),t.pendingColumn="",t},t.doesNotEqual=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'doesNotEqual' call.";return t.conditions.push({col:t.pendingColumn,type:"!=",value:e}),t.pendingColumn="",t},t.lessThan=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'lessThan' call.";return t.conditions.push({col:t.pendingColumn,type:"<",value:e}),t.pendingColumn="",t},t.greaterThan=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'greaterThan' call.";return t.conditions.push({col:t.pendingColumn,type:">",value:e}),t.pendingColumn="",t},t.contains=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'contains' call.";return t.conditions.push({col:t.pendingColumn,type:"%%",value:e}),t.pendingColumn="",t},t.endsWith=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'endsWith' call.";return t.conditions.push({col:t.pendingColumn,type:"%-",value:e}),t.pendingColumn="",t},t.beginsWith=function(e){if(""==t.pendingColumn)throw"Must add a 'where' clause before the 'beginsWith' call.";return t.conditions.push({col:t.pendingColumn,type:"-%",value:e}),t.pendingColumn="",t},t.and=function(e){return t.where(e)},t.or=function(e){return t.finalConditions.push(t.conditions),t.conditions=[],t.where(e)},t.limit=function(e,n){return t.LIMIT=parseInt(e),void 0!==n&&(t.OFFSET=parseInt(n)),t},t.orderBy=function(e){return Array.isArray(e)||(e=[e]),t.sortColumn=e,t},t.asc=function(){if(""==t.sortColumn)throw"Must use orderBy clause before using ASC";return t.sortDirection="ASC",t},t.desc=function(){if(""==t.sortColumn)throw"Must use orderBy clause before using DESC";return t.sortDirection="DESC",t},t.execute=function(e){if(void 0===e&&(e=[]),t.conditions.length>0&&t.finalConditions.push(t.conditions),e.length>0)for(var n=t.finalConditions.length;n--;)for(var r=t.finalConditions[n].length;r--;)if("?"===t.finalConditions[n][r].value&&"pl"===t.finalConditions[n][r].type){var i=e.pop();"%"==i.substr(0,1)&&"%"==i.substr(i.length-1,1)?(t.finalConditions[n][r].value=i.substr(1,i.length-2),t.finalConditions[n][r].type="%%"):"%"==i.substr(0,1)?(t.finalConditions[n][r].value=i.substr(1,i.length-1),t.finalConditions[n][r].type="%-"):"%"==i.substr(i.length-1,1)?(t.finalConditions[n][r].value=i.substr(0,i.length-1),t.finalConditions[n][r].type="-%"):(t.finalConditions[n][r].value=i,t.finalConditions[n][r].type="=")}else"?"===t.finalConditions[n][r].value&&e.length>0&&(t.finalConditions[n][r].value=e.pop());return t.context.execute(e)},t.fetch=function(e){return t.context.fetch(e)},t.fetchAll=function(e){return t.context.fetchAll(e)},t.getResultRowIndexes=function(){for(var e=[],n=0;n<t.context.table.data.length;n++)if(t.finalConditions.length<1)e.push(n);else{for(var r=!1,i=t.finalConditions.length;i--;){for(var a=t.finalConditions[i],s=!0,o=a.length;o--;){var u=a[o];switch(u.type){case">":(isNaN(parseFloat(t.context.table.data[n][t.context.table.colmap[u.col]]))||t.context.table.data[n][t.context.table.colmap[u.col]]<u.value)&&(s=!1);break;case"<":(isNaN(parseFloat(t.context.table.data[n][t.context.table.colmap[u.col]]))||t.context.table.data[n][t.context.table.colmap[u.col]]>u.value)&&(s=!1);break;case"=":t.context.table.data[n][t.context.table.colmap[u.col]]!=u.value&&(s=!1);break;case"!=":break;case"%%":t.context.table.data[n][t.context.table.colmap[u.col]].indexOf(u.value)<0&&(s=!1);break;case"%-":t.context.table.data[n][t.context.table.colmap[u.col]].indexOf(u.value)!=t.context.table.data[n][t.context.table.colmap[u.col]].length-u.value.length&&(s=!1);break;case"-%":0!=t.context.table.data[n][t.context.table.colmap[u.col]].indexOf(u.value)&&(s=!1)}if(!s)break}if(s){r=!0;break}}r&&e.push(n)}if(t.sortColumn.length>0&&(e.sort(function(e,n){return e=t.context.table.data[e],n=t.context.table.data[n],function r(i){if(void 0===t.sortColumn[i])return 0;var a=t.sortColumn[i],s=t.context.table.colmap[a];return e[s]<n[s]?-1:e[s]>n[s]?1:r(i+1)}(0)}),"DESC"==t.sortDirection&&e.reverse()),t.isDistinct){for(var l=[],n=0;n<e.length;n++)l.push(t.context.table.data[e[n]]);for(var c=[],h=[],n=0;n<l.length;n++){for(var f={},p=0;p<t.context.columns.length;p++)f[t.context.columns[p]]=l[n][t.context.table.colmap[t.context.columns[p]]];var d=JSON.stringify(f);c.indexOf(d)>-1||(h.push(e[n]),c.push(d))}e=h}return t.LIMIT>0&&e.length>t.LIMIT&&(t.OFFSET>e.length&&(e=[]),t.LIMIT>e.length&&(t.LIMIT=e.length),e.length&&(e=e.slice(t.OFFSET,t.OFFSET+t.LIMIT))),e}}function WebSQLAPI(){var e=this;e.db=null;var t=function(t,n,r,i){"function"!=typeof r&&(r=function(){}),"function"!=typeof i&&(i=function(){throw"Could not execute query: "+t});var a,s,o;Array.isArray(n[0])||(n=[n]),o=n.length;var u=function(e,t){var n,i,a=[];if(o-=1,!o){for(n=0,i=t.rows.length;i>n;n+=1){var s=t.rows.item(n).json;a.push(s)}r(a)}};e.db.transaction(function(e){for(a=0,s=n.length;s>a;a+=1)e.executeSql(t,n[a],u,i)})};e.init=function(n,r){"function"!=typeof r&&(r=function(){});var i=function(){try{for(var r=n.length;r--;)(function(n,r){t("DROP TABLE IF EXISTS "+n,[],function(){t("CREATE TABLE IF NOT EXISTS "+n+"(json TEXT)",[],function(){e.insert(n,r)})})})(n[r].name,n[r].rows)}catch(i){throw"Error creating table"}};try{var a=window.location.href.replace(/\W+/g,"");e.db=openDatabase("jSQL_"+a,"1.0","jSQL "+a,5242880)}catch(s){throw"Error opening database"}t("SELECT COUNT(*) FROM "+n[0].name,[],null,function(){i()}),r()},e.insert=function(e,n,r){"function"!=typeof r&&(r=function(){});var i,a,s=n.length,o=[];for(0===s&&r(),i=0,a=n.length;a>i;i+=1)o[i]=[JSON.stringify(n[i])];t("INSERT INTO "+e+" (json) VALUES (?);",o,r)},e["delete"]=function(e,n){"function"!=typeof n&&(n=function(){}),t("DELETE FROM "+e,[],n)},e.select=function(e,n){t("SELECT json FROM "+e,[],function(e){for(var t=[],r=e.length;r--;)t.push(JSON.parse(e[r]));n(t)})}}function indexedDBAPI(){var e=this;e.db=null;var t,n,r;e.init=function(i,a){"function"!=typeof a&&(a=function(){});try{t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,n=window.hasOwnProperty("IDBTransaction")?window.IDBTransaction:window.webkitIDBTransaction,r=window.hasOwnProperty("IDBKeyRange")?window.IDBKeyRange:window.webkitIndexedDB}catch(s){throw"indexedDB is not supported in this browser"}if(!t)throw"indexedDB is not supported in this browser";var o=1,u=window.location.href.replace(/\W+/g,""),l=t.open("jSQL_"+u,o),c=function(){for(var t=i.length;t--;)e.db.objectStoreNames.contains(i[t].name)&&e.db.deleteObjectStore(i[t].name),e.db.createObjectStore(i[t].name,{keyPath:"_id",autoIncrement:!0});var n=0,r=!1,a=setInterval(function(){if(!r){r=!0;try{for(var t=i.length;t--;){var s=i[t].name,o=void 0==i[t].rows?[]:i[t].rows;e.insert(s,o)}clearInterval(a)}catch(u){if(n>1e3)throw clearInterval(a),"Could not add data after 10 seconds.";r=!1}}},10)};l.onsuccess=function(t){var n;e.db=t.target.result,o=String(o),e.db.setVersion&&o!==e.db.version?(n=e.db.setVersion(o),n.onfailure=function(){throw"Error updating datastore version"},n.onsuccess=function(e){c(),n.result.oncomplete=function(){a()}}):a()},l.onupgradeneeded=function(t){e.db=t.target.result,c()},l.onerror=function(e){throw"Could not connect to the indexedDB datastore."}},e.insert=function(t,r,i){"function"!=typeof i&&(i=function(){});var a,s,o,u=e.db.transaction([t],void 0===n.READ_WRITE?"readwrite":n.READ_WRITE),l=r.length,c=function(){l-=1,0===l&&i(l)};u.onerror=function(){throw"Could not initiate a transaction"},a=u.objectStore(t);for(s in r)r.hasOwnProperty(s)&&(o=a.add(r[s]),o.onsuccess=c,o.onerror=function(){throw"Could not initiate a request"})},e["delete"]=function(t,r){"function"!=typeof r&&(r=function(){});var i,a,s=e.db.transaction([t],void 0===n.READ_WRITE?"readwrite":n.READ_WRITE);s.onerror=function(){throw"Could not initiate a transaction"},i=s.objectStore(t),a=i.clear(),a.onerror=function(){throw"Could not initiate a request"},a.onsuccess=r},e.select=function(t,r){"function"!=typeof r&&(r=function(){});var i,a,s=e.db.transaction([t],void 0===n.READ_ONLY?"readonly":n.READ_ONLY),o=[];s.onerror=function(){throw"Could not initiate a transaction"},i=s.objectStore(t),a=i.openCursor(),a.onerror=function(){throw"Could not initiate a request"};var u=!1;a.onsuccess=function(e){if(!u){var t=e.target.result;return t?(o.push(t.value),void t["continue"]()):(u=!0,void r(o))}}}}function createTable(e,t,n,r){var i=void 0===t&&void 0===n&&"object"==typeof e&&void 0===r,a=Array.isArray(t)&&void 0===n&&"object"==typeof e&&void 0===r;if(i||a){a&&(r=t),t=[],n=[];for(var s in e)if(e.hasOwnProperty(s)){var o=e[s];e=s;for(var u=0;u<o.length;u++){var l=o[u].name;t.push(l),n.push({type:o[u].type,args:void 0===o[u].args?[]:o[u].args})}break}}return Array.isArray(t)||(t=[t]),void 0===r&&(r=[]),Array.isArray(r)||(r=[r]),new jSQLQuery("CREATE").init(e,t,n,r)}function select(e){return Array.isArray(e)||(e=[e]),new jSQLQuery("SELECT").init(e)}function update(e){return new jSQLQuery("UPDATE").init(e)}function insertInto(e){return new jSQLQuery("INSERT").init(e)}function dropTable(e){return new jSQLQuery("DROP").init(e)}function deleteFrom(e){return new jSQLQuery("DELETE").init(e)}function jSQLReset(){jSQL.tables={},jSQL.commit()}function jSQLMinifier(e){for(var t="",n=e.split("\n"),r=!1,i="",a=["'","`",'"'],s=!1,o=0;o<n.length;o++){for(var u=0;u<n[o].length;u++){var l=n[o][u];if(!r&&a.indexOf(l)>-1)r=!0,i=l,t+=l;else if(r&&i===l)r=!1,i="",t+=l;else if(r)t+=l;else{var c="/"===l&&n[o].length>u&&"*"==n[o][u+1],h="*"===l&&n[o].length>u&&"/"==n[o][u+1];if(s||!c){if(h&&s)u++,s=!1;else if(!s){var f="#"===l||"-"===l&&n[o].length>u&&"-"==n[o][u+1];if(f)break;t+=l}}else s=!0}}t+="\n"}return t.replace(/\t/g," ").replace(/(\r\n|\n|\r)/gm," ").replace(/ +(?= )/g,"").trim()}var persistenceManager=new function(){var e=this;e.api=null,e.error=!1,e.loaded=!1,e.isLoading=!1,e.loadingCallbacks=[],e.commit=function(t){if("function"==typeof t&&(t=function(){}),e.error!==!1)throw e.error;var n=[];for(var r in jSQL.tables)if(jSQL.tables.hasOwnProperty(r))for(var i=jSQL.select("*").from(r).execute().fetchAll(),a=i.length;a--;){var s=i[a];for(var o in s)s.hasOwnProperty(o)&&(s[o]=jSQL.tables[r].normalizeColumnStoreValue(o,s[o]));n.push({table:r,data:JSON.stringify(s),colTypes:JSON.stringify(jSQL.tables[r].types)})}e.api["delete"]("jSQL_data_schema",function(){e.api.insert("jSQL_data_schema",n,t)})},e.load=function(t){if("function"!=typeof t&&(t=function(){}),e.loadingCallbacks.push(t),e.loaded)for(;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();e.isLoading||(e.isLoading=!0,e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()}))},e.rollback=function(t){"function"!=typeof t&&(t=function(){}),function n(r){try{e.api.select("jSQL_data_schema",function(n){if(jSQL.tables={},0===n.length)return void t();for(var r=n.length;r--;){var i=n[r].table,a=JSON.parse(n[r].data),s=JSON.parse(n[r].colTypes);if(void 0===jSQL.tables[i]){var o=[];for(var u in a)a.hasOwnProperty(u)&&o.push(u);jSQL.createTable(i,o,s).execute()}for(var u in a)a.hasOwnProperty(u)&&(a[u]=jSQL.tables[i].normalizeColumnFetchValue(u,a[u]));jSQL.tables[i].insertRow(a)}for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()})}catch(i){if(r>500){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();return}setTimeout(function(){n(r+1)},10)}}(0)},function(){try{e.api=new indexedDBAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(t){try{e.api=new WebSQLAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(n){e.error="Browser doesn't support Web SQL or IndexedDB"}}}()};return{version:2,tables:{},query:jSQLParseQuery,createTable:createTable,dropTable:dropTable,select:select,update:update,deleteFrom:deleteFrom,insertInto:insertInto,types:new jSQLDataTypeList,load:persistenceManager.load,reset:jSQLReset,minify:jSQLMinifier,commit:persistenceManager.commit,rollback:persistenceManager.rollback,persist:persistenceManager.commit}}();