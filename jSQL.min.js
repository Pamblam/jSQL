/**
 * jSQL.js v2.5
 * A Javascript Query Language Database Engine
 * @author Robert Parham
 * @website http://pamblam.github.io/jSQL/
 * @license http://www.apache.org/licenses/LICENSE-2.0
 */
!function(){var isNode=!("undefined"==typeof module||!module.exports),jSQL=function(){"use strict";function jSQL_Error(e){this.error=e,this.stack=void 0,(new Error).stack;var r=new Error;switch(r.stack&&(this.stack=r.stack),e){case"0001":this.message="Corrupted function stored in data.";break;case"0002":this.message="Attempted to aaply a non-function as an error handler.";break;case"0003":this.message="Invalid datatype definition.";break;case"0004":this.message="DataType must have a `type` property.";break;case"0005":this.message="DataType must have a `serialize` function.";break;case"0006":this.message="DataType must have an `unserialize` function.";break;case"0007":this.message="Unsupported data type.";break;case"0008":this.message="Invalid table types array.";break;case"0009":this.message="Unable to convert columns to array.";break;case"0010":this.message="Invalid constraint.";break;case"0011":this.message="This table already has a primary key.";break;case"0012":this.message="renameColumn expects and old column name and a new one, both must be strings.";break;case"0013":this.message="Column does not exist.";break;case"0014":this.message="Data must be an array.";break;case"0015":this.message="Data not structured properly.";break;case"0016":this.message="Cannot insert a null value in a primary column.";break;case"0017":this.message="Primary Key violated.";break;case"0018":this.message="Cannot insert a null value in a unique column.";break;case"0019":this.message="Unique key violated.";break;case"0020":this.message="Data type's serialize() method did not return a string.";break;case"0021":this.message="Table does not exist.";break;case"0022":this.message="Method does not apply to query type.";break;case"0023":this.message="Fetch expects paramter one to be 'ASSOC', 'ARRAY', or undefined.";break;case"0024":this.message="Expected number or quoted string.";break;case"0025":this.message="Expected 'ORDER BY'.";break;case"0026":this.message="Must call ORDER BY before using ASC.";break;case"0027":this.message="Must call ORDER BY before using DESC.";break;case"0028":this.message="Unintelligible query. Expected 'FROM'.";break;case"0029":this.message="Unintelligible query. Expected 'TABLE'.";break;case"0030":this.message="Unintelligible query. Expected 'INTO'.";break;case"0031":this.message="Unintelligible query. Expected 'VALUES'.";break;case"0032":this.message="Unintelligible query. Too many values.";break;case"0033":this.message="Unintelligible query. Columns mismatch.";break;case"0034":this.message="Invalid Column definition.";break;case"0035":this.message="Unintelligible query. Expected 'NOT'.";break;case"0036":this.message="Unintelligible query. Expected 'EXISTS'.";break;case"0037":this.message="Unintelligible query. expected ')'.";break;case"0038":this.message="Invalid Arg definition.";break;case"0039":this.message="Unintelligible query. Expected 'SET'.";break;case"0040":this.message="Unintelligible query. Expected 'FROM'.";break;case"0041":this.message="Unintelligible query. WTF?";break;case"0042":this.message="Must add a conditional before adding another 'Where' condition.";break;case"0043":this.message="Column name must be a string.";break;case"0044":this.message="Must add a 'where' clause before the 'equals' call.";break;case"0045":this.message="Must add a 'where' clause before the 'preparedLike' call.";break;case"0046":this.message="Must add a 'where' clause before the 'doesNotEqual' call.";break;case"0047":this.message="Must add a 'where' clause before the 'lessThan' call.";break;case"0048":this.message="Must add a 'where' clause before the 'greaterThan' call.";break;case"0049":this.message="Must add a 'where' clause before the 'contains' call.";break;case"0050":this.message="Must add a 'where' clause before the 'endsWith' call.";break;case"0051":this.message="Must add a 'where' clause before the 'beginsWith' call.";break;case"0052":this.message="Must use orderBy clause before using ASC.";break;case"0053":this.message="Must use orderBy clause before using DESC.";break;case"0054":this.message="Could not execute query.";break;case"0055":this.message="Error creating table.";break;case"0056":this.message="Error opening database.";break;case"0057":this.message="indexedDB is not supported in this browser.";break;case"0058":this.message="Could not add data after 10 seconds.";break;case"0059":this.message="Error updating datastore version.";break;case"0060":this.message="Could not connect to the indexedDB datastore.";break;case"0061":this.message="Could not initiate a transaction.";break;case"0062":this.message="Could not initiate a request.";break;case"0063":this.message="Browser doesn't support Web SQL or IndexedDB.";break;case"0064":this.message="Unable towrite to datastore file.";break;default:this.message="Unknown error."}this.toString=function(){return void 0===this.error?"jSQL Error - "+this.message:"jSQL Error #"+this.error+" - "+this.message}}function _throw(e,r){throw r!==!0&&error_handler_function(e),e}function onError(e){"function"==typeof e&&(error_handler_function=e)}function jSQLDataTypeList(){this.list=[{type:"NUMERIC",aliases:["NUMBER","DECIMAL","FLOAT"],serialize:function(e,r){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):0},unserialize:function(e,r){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):0}},{type:"JSON",aliases:["ARRAY","OBJECT"],serialize:function(e,r){return JSON.stringify(e)},unserialize:function(e,r){return JSON.parse(e)}},{type:"FUNCTION",serialize:function(e,r){return"function"!=typeof e&&(e=function(){}),"jSQLFunct-"+e.toString()},unserialize:function(value,args){var p=value.split("-");if("jSQLFunct"!==p.shift())return _throw(new jSQL_Error("0001"));p=value.split("-"),p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}return"function"==typeof f?f:_throw(new jSQL_Error("0001"))}},{type:"BOOLEAN",aliases:["BOOL"],serialize:function(e,r){return!!e},unserialize:function(e,r){return!!e}},{type:"INT",serialize:function(e,r){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0},unserialize:function(e,r){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0}},{type:"CHAR",aliases:["VARCHAR","LONGTEXT","MEDIUMTEXT"],serialize:function(e,r){return""+e},unserialize:function(e,r){return""+e}},{type:"DATE",serialize:function(e,r){return!e instanceof Date?new Date(0).getTime():e.getTime()},unserialize:function(e,r){return new Date(e)}},{type:"AMBI",serialize:function(e,r){return e instanceof Date?e.getTime():"function"==typeof e?"jSQLFunct-"+e.toString():!isNaN(parseFloat(e))&&isFinite(e)?e:""+e},unserialize:function(value,args){if("string"==typeof value&&"jSQLFunct"===value.split("-")[0]){var p=value.split("-");p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f}return value}}],this.add=function(e){return"object"!=typeof e?_throw(new jSQL_Error("0003")):void 0===e.type?_throw(new jSQL_Error("0004")):"function"!=typeof e.serialize?_throw(new jSQL_Error("0005")):"function"!=typeof e.unserialize?_throw(new jSQL_Error("0006")):void this.list.push({type:e.type.toUpperCase(),aliases:Array.isArray(e.aliases)?e.aliases:[],serialize:e.serialize,unserialize:e.unserialize})},this.exists=function(e){e=e.toUpperCase();for(var r=this.list.length;r--;)if(this.list[r].type===e||void 0!==this.list[r].aliases&&this.list[r].aliases.indexOf(e)>-1)return!0;return!1},this.getByType=function(e){e=e.toUpperCase();for(var r=this.list.length;r--;)if(this.list[r].type===e||void 0!==this.list[r].aliases&&this.list[r].aliases.indexOf(e)>-1)return this.list[r];return _throw(new jSQL_Error("0007"))}}function jSQLTable(e,r,t,n,s){var a=this;a.name="",a.columns=[],a.data=[],a.colmap={},a.types=[],a.keys={primary:{column:!1,map:{}},unique:[]},a.init=function(e,r,t,n,s){if(a.name=e,void 0===n&&(n=[]),!Array.isArray(n))return _throw(new jSQL_Error("0008"));if(Array.isArray(r)&&void 0===t&&(t=r,r=[]),Array.isArray(r)&&!Array.isArray(r[0])&&"object"==typeof r[0]){var i=[];for(var e in r[0])r[0].hasOwnProperty(e)&&i.push(e);t=r,r=i}if(!Array.isArray(r))return _throw(new jSQL_Error("0009"));a.columns=r;for(var o=0;o<r.length;o++)a.types[o]=void 0===n[o]||void 0===n[o].type?{type:"ambi",args:[]}:n[o];for(var o=a.types.length;o--;){var u=a.types[o].type.toUpperCase();if(!jSQL.types.exists(u))return _throw(new jSQL_Error("0007"));a.types[o].type=u}for(var o=0;o<r.length;o++)a.colmap[r[o]]=o;for(var l,c=["primary","unique"],h=0;l=s[h];h++){if(!l.hasOwnProperty("column")||!Array.isArray(l.column)&&-1===a.columns.indexOf(l.column))return _throw(new jSQL_Error("0010"));if(Array.isArray(l.column))for(var f=0;f<l.column.length;f++)if(-1===a.columns.indexOf(l.column[f]))return _throw(new jSQL_Error("0010"));var u=l.hasOwnProperty("type")&&-1!==c.indexOf(l.type.toLowerCase())?l.type.toLowerCase():"unique";if("primary"==u&&a.keys.primary.column!==!1)return _throw(new jSQL_Error("0011"));"primary"==u&&(a.keys.primary.column=l.column),"unique"==u&&a.keys.unique.push({column:l.column,map:{}})}void 0!==t&&a.loadData(t)},a.renameColumn=function(e,r){if(void 0===e||"string"!=typeof r)return _throw(new jSQL_Error("0012"));if(a.columns.indexOf(e)<0)return _throw(new jSQL_Error("0013"));if(a.columns.splice(a.columns.indexOf(e),1,r),a.keys.primary.column===e&&(a.keys.primary.column=r),Array.isArray(a.keys.primary.column))for(var t=a.keys.primary.column.length;t--;)a.keys.primary.column[t]===e&&(a.keys.primary.column[t]=r);for(var n=a.keys.unique.length;n--;)if(a.keys.unique[n].column===e&&(a.keys.unique[n].column=r),Array.isArray(a.keys.unique[n].column))for(var t=a.keys.unique[n].column.length;t--;)a.keys.unique[n].column[t]===e&&(a.keys.unique[n].column[t]=r);var s={};for(var i in a.colmap)a.colmap.hasOwnProperty(i)&&(i===e?s[r]=a.colmap[i]:s[i]=a.colmap[i]);a.colmap=s},a.addColumn=function(e,r,t){(void 0===t||void 0===t.type)&&(t={type:"AMBI",args:[]}),t.type=t.type.toUpperCase(),void 0===r&&(r=null),"string"!=typeof e&&(e=function s(e){for(var r=0;r<a.columns.length;r++)if(a.columns[r]=="u"+e)return s(e+1);return"u"+e}(0)),a.columns.push(e);for(var n=a.data.length;n--;)a.data[n].push(r);return a.colmap[e]=a.columns.length-1,jSQL.types.exists(t.type)?void a.types.push(t):_throw(new jSQL_Error("0007"))},a.loadData=function(e){if(!Array.isArray(e))return _throw(new jSQL_Error("0014"));var r=e.length;for(a.columns.length;r--;)a.insertRow(e[r])},a.insertRow=function(e,r){var t=[];if(Array.isArray(e)){for(;e.length>a.columns.length;)a.addColumn();for(;e.length<a.columns.length;)e.push(null);for(var n=0;n<e.length;n++)t.push(e[n]);for(;t.length<a.columns.length;)t.push(null)}else{if("object"!=typeof e)return _throw(new jSQL_Error("0015"));for(var n=0;n<a.columns.length;n++)void 0===e[a.columns[n]]&&(e[a.columns[n]]=null);for(var s in e)if(!e.hasOwnProperty(s))continue;if(function(e){for(;e--;)if(a.columns[e]==s)return 0;return 1}(a.columns.length))if(a.columns.indexOf("u0")>-1){a.renameColumn("u0",s);for(var i=1;a.columns.indexOf("u"+i)>-1;)a.renameColumn("u"+i,"u"+(i-1))}else a.addColumn(s);for(var n=0;n<a.columns.length;n++)t.push(e[a.columns[n]])}for(var i=t.length;i--;)t[i]=a.normalizeColumnStoreValue(a.columns[i],t[i]);if(a.keys.primary.column){for(var o,u=Array.isArray(a.keys.primary.column)?a.keys.primary.column:[a.keys.primary.column],l=[],c=0;o=u[c];c++){var h=a.colmap[o];if(null===t[h]){if(r===!0)return;return _throw(new jSQL_Error("0016"))}l.push(t[h])}if(l=JSON.stringify(l),a.keys.primary.map.hasOwnProperty(l)){if(r===!0)return;return _throw(new jSQL_Error("0017"))}a.keys.primary.map[l]=a.data.length}for(var f,p=0;f=a.keys.unique[p];p++){for(var y,w=Array.isArray(f.column)?f.column:[f.column],m=[],d=0;y=w[d];d++){var g=a.colmap[y];if(null===t[g]){if(r===!0)return;return _throw(new jSQL_Error("0018"))}m.push(t[g])}if(m=JSON.stringify(m),f.map.hasOwnProperty(m)){if(r===!0)return;return _throw(new jSQL_Error("0019"))}a.keys.unique[p].map[m]=a.data.length}a.data.push(t)},a.normalizeColumnStoreValue=function(e,r){var t=a.types[a.colmap[e]],n=jSQL.types.getByType(t.type.toUpperCase()).serialize(r,t.args);return!isNaN(parseFloat(n))&&isFinite(n)||"string"==typeof n?n:_throw(new jSQL_Error("0020"))},a.normalizeColumnFetchValue=function(e,r){var t=a.types[a.colmap[e]];return jSQL.types.getByType(t.type.toUpperCase()).unserialize(r,t.args)},a.init(e,r,t,n,s)}function jSQLQuery(e){var r=this;r.type=e.toUpperCase(),r.tablename=null,r.columns=[],r.data=[],r.INEFlag=!1,r.coltypes=[],r.table=null,r.newvals={},r.whereClause=new jSQLWhereClause(r),r.resultSet=[],r.init=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).init.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).init.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).init.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).init.apply(r,arguments);case"DROP":return(new jSQLDropQuery).init.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).init.apply(r,arguments)}},r.ifNotExists=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).ifNotExists.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).ifNotExists.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).ifNotExists.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).ifNotExists.apply(r,arguments);case"DROP":return(new jSQLDropQuery).ifNotExists.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).ifNotExists.apply(r,arguments)}},r.execute=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).execute.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).execute.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).execute.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).execute.apply(r,arguments);case"DROP":return(new jSQLDropQuery).execute.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).execute.apply(r,arguments)}},r.fetch=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).fetch.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).fetch.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).fetch.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).fetch.apply(r,arguments);case"DROP":return(new jSQLDropQuery).fetch.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).fetch.apply(r,arguments)}},r.ignore=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).ignore.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).ignore.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).ignore.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).ignore.apply(r,arguments);case"DROP":return(new jSQLDropQuery).ignore.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).ignore.apply(r,arguments)}},r.fetchAll=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).fetchAll.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).fetchAll.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).fetchAll.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).fetchAll.apply(r,arguments);case"DROP":return(new jSQLDropQuery).fetchAll.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).fetchAll.apply(r,arguments)}},r.values=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).values.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).values.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).values.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).values.apply(r,arguments);case"DROP":return(new jSQLDropQuery).values.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).values.apply(r,arguments)}},r.set=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).set.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).set.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).set.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).set.apply(r,arguments);case"DROP":return(new jSQLDropQuery).set.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).set.apply(r,arguments)}},r.where=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).where.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).where.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).where.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).where.apply(r,arguments);case"DROP":return(new jSQLDropQuery).where.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).where.apply(r,arguments)}},r.from=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).from.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).from.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).from.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).from.apply(r,arguments);case"DROP":return(new jSQLDropQuery).from.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).from.apply(r,arguments)}},r.orderBy=function(e){switch(r.type){case"CREATE":return(new jSQLCreateQuery).orderBy.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).orderBy.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).orderBy.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).orderBy.apply(r,arguments);case"DROP":return(new jSQLDropQuery).orderBy.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).orderBy.apply(r,arguments)}},r.asc=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).asc.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).asc.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).asc.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).asc.apply(r,arguments);case"DROP":return(new jSQLDropQuery).asc.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).asc.apply(r,arguments)}},r.desc=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).desc.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).desc.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).desc.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).desc.apply(r,arguments);case"DROP":return(new jSQLDropQuery).desc.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).desc.apply(r,arguments)}},r.limit=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).limit.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).limit.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).limit.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).limit.apply(r,arguments);case"DROP":return(new jSQLDropQuery).limit.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).limit.apply(r,arguments)}},r.distinct=function(){switch(r.type){case"CREATE":return(new jSQLCreateQuery).distinct.apply(r,arguments);case"UPDATE":return(new jSQLUpdateQuery).distinct.apply(r,arguments);case"SELECT":return(new jSQLSelectQuery).distinct.apply(r,arguments);case"INSERT":return(new jSQLInsertQuery).distinct.apply(r,arguments);case"DROP":return(new jSQLDropQuery).distinct.apply(r,arguments);case"DELETE":return(new jSQLDeleteQuery).distinct.apply(r,arguments)}}}function jSQLDeleteQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],this)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),r=[],t=[],n=0;n<this.table.data.length;n++)e.indexOf(n)>-1?r.push(this.table.data[n]):t.push(this.table.data[n]);return this.table.data=t,this.resultSet=r,this},this.where=function(e){return this.whereClause.where(e)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){return _throw(new jSQL_Error("0022"))},this.ignore=function(){return _throw(new jSQL_Error("0022"))},this.ifNotExists=function(){return _throw(new jSQL_Error("0022"))},this.set=function(){return _throw(new jSQL_Error("0022"))},this.from=function(){return _throw(new jSQL_Error("0022"))},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLDropQuery(){this.init=function(e){return this.tablename=e,this},this.execute=function(){return void 0===jSQL.tables[this.tablename]?_throw(new jSQL_Error("0021")):(delete jSQL.tables[this.tablename],this)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){return _throw(new jSQL_Error("0022"))},this.ifNotExists=function(){return _throw(new jSQL_Error("0022"))},this.set=function(){return _throw(new jSQL_Error("0022"))},this.where=function(){return _throw(new jSQL_Error("0022"))},this.from=function(){return _throw(new jSQL_Error("0022"))},this.orderBy=function(){return _throw(new jSQL_Error("0022"))},this.asc=function(){return _throw(new jSQL_Error("0022"))},this.desc=function(){return _throw(new jSQL_Error("0022"))},this.limit=function(){return _throw(new jSQL_Error("0022"))},this.distinct=function(){return _throw(new jSQL_Error("0022"))},this.ignore=function(){return _throw(new jSQL_Error("0022"))}}function jSQLInsertQuery(){this.init=function(e){return this.table=e,this.ignoreFlag=!1,this},this.values=function(e){return void 0===jSQL.tables[this.table]?_throw(new jSQL_Error("0021")):(this.data=e,this)},this.execute=function(e){if(void 0!==e&&Array.isArray(e)&&e.length>0)if(Array.isArray(this.data))for(var r=this.data.length;r--&&e.length;)"?"==this.data[r]&&(this.data[r]=e.shift());else for(var r in this.data)this.data.hasOwnProperty(r)&&e.length&&"?"==this.data[r]&&(this.data[r]=e.shift());return jSQL.tables[this.table].insertRow(this.data,this.ignoreFlag),this},this.ignore=function(){return this.ignoreFlag=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ifNotExists=function(){return _throw(new jSQL_Error("0022"))},this.set=function(){return _throw(new jSQL_Error("0022"))},this.where=function(){return _throw(new jSQL_Error("0022"))},this.from=function(){return _throw(new jSQL_Error("0022"))},this.orderBy=function(){return _throw(new jSQL_Error("0022"))},this.asc=function(){return _throw(new jSQL_Error("0022"))},this.desc=function(){return _throw(new jSQL_Error("0022"))},this.limit=function(){return _throw(new jSQL_Error("0022"))},this.distinct=function(){return _throw(new jSQL_Error("0022"))}}function jSQLSelectQuery(){this.init=function(e){return this.columns=Array.isArray(e)?e:[e],this},this.from=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],"*"==this.columns[0]&&(this.columns=this.table.columns),this)},this.where=function(e){return this.whereClause.where(e)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),r=[],t=0;t<e.length;t++)r.push(this.table.data[e[t]]);for(var n=[],t=0;t<r.length;t++){for(var s={},a=0;a<this.columns.length;a++)s[this.columns[a]]=r[t][this.table.colmap[this.columns[a]]];n.push(s)}return this.resultSet=n,this},this.fetch=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;var r=this.resultSet.shift();for(var t in r)if(r.hasOwnProperty(t)){var n=this.table.normalizeColumnFetchValue(t,r[t]);r[t]=n}if("ARRAY"==e){var n=[];for(var s in r)r.hasOwnProperty(s)&&n.push(r[s]);r=n}return r},this.fetchAll=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;for(var r=[];this.resultSet.length>0;)r.push(this.fetch(e));return r},this.ignore=function(){return _throw(new jSQL_Error("0022"))},this.values=function(){return _throw(new jSQL_Error("0022"))},this.ifNotExists=function(){return _throw(new jSQL_Error("0022"))},this.set=function(){return _throw(new jSQL_Error("0022"))},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLUpdateQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=this.table=jSQL.tables[e],this.ignoreFlag=!1,this)},this.set=function(e){this.newvals=e;for(var r in e)e.hasOwnProperty(r)&&this.columns.push(r);return this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(e){if(void 0!==e&&Array.isArray(e))for(var r in this.newvals)this.newvals.hasOwnProperty(r)&&"?"==this.newvals[r]&&e.length&&(this.newvals[r]=e.shift());for(var t=this.whereClause.getResultRowIndexes(),n=[],s=[],r=0;r<t.length;r++){for(var a=t[r],i=this.table.data[a].slice(0),o=0;o<this.columns.length;o++)i[this.table.colmap[this.columns[o]]]=this.table.normalizeColumnStoreValue(this.columns[r],this.newvals[this.columns[o]]);var u=this.table.keys.primary.column,l=!1;if(u!==!1){Array.isArray(u)||(u=[u]);var c;l=[];for(var h=0;c=u[h];h++){var f=this.table.colmap[c];if(null===i[f])return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0016"));l.push(i[f])}if(l=JSON.stringify(l),this.table.keys.primary.map.hasOwnProperty(l)&&this.table.keys.primary.map[l]!==a)return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0017"))}for(var p,y=[],w=0;p=this.table.keys.unique[w];w++){for(var m,d=Array.isArray(p.column)?p.column:[p.column],g=[],S=0;m=d[S];S++){var Q=this.table.colmap[m];if(null===i[Q])return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0018"));g.push(i[Q])}if(g=JSON.stringify(g),p.map.hasOwnProperty(g)&&p.map[g]!==a)return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0019"));y.push(g)}s.push({rowIndex:a,row:i,pk_vals:l,uni_vals:y})}for(var r=0;r<s.length;r++){n.push(s[r].row),this.table.data[s[r].rowIndex]=s[r].row;for(var m in this.table.keys.primary.map)if(this.table.keys.primary.map.hasOwnProperty(m)&&this.table.keys.primary.map[m]==s[r].rowIndex){delete this.table.keys.primary.map[m],this.table.keys.primary.map[s[r].pk_vals]=a;break}for(var w=0;p=this.table.keys.unique[w];w++)for(var m in this.table.keys.unique[w].map)if(this.table.keys.unique[w].map.hasOwnProperty(m)&&this.table.keys.unique[w].map[m]==s[r].rowIndex){delete this.table.keys.unique[w].map[m],this.table.keys.unique[w].map[s[r].uni_vals[w]]=a;break}}return this.resultSet=n,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){return _throw(new jSQL_Error("0022"))},this.ifNotExists=function(){return _throw(new jSQL_Error("0022"))},this.from=function(){return _throw(new jSQL_Error("0022"))},this.ignore=function(){return this.ignoreFlag=!0,this},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLCreateQuery(){this.init=function(e,r,t,n){return this.tablename=e,this.columns=r,this.coltypes=t,this.keys=n,this},this.ifNotExists=function(){return this.INEFlag=!0,this},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(jSQL.tables[this.tablename]=new jSQLTable(this.tablename,this.columns,this.data,this.coltypes,this.keys)),this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.values=function(){return _throw(new jSQL_Error("0022"))},this.set=function(){return _throw(new jSQL_Error("0022"))},this.where=function(){return _throw(new jSQL_Error("0022"))},this.from=function(){return _throw(new jSQL_Error("0022"))},this.orderBy=function(){return _throw(new jSQL_Error("0022"))},this.asc=function(){return _throw(new jSQL_Error("0022"))},this.desc=function(){return _throw(new jSQL_Error("0022"))},this.limit=function(){return _throw(new jSQL_Error("0022"))},this.distinct=function(){return _throw(new jSQL_Error("0022"))},this.ignore=function(){return _throw(new jSQL_Error("0022"))}}function jSQLParseQuery(e){var r=function(e){for(var r=['"',"'","`"],t=r.length;t--;)if(e.substr(0,1)==r[t]&&e.substr(e.length-1,1)==r[t])return e.substr(1,e.length-2);return e},t=function(e,t){for(var n=0;n<jSQL.tables[u].columns.length;n++)if(r(e.toUpperCase())==jSQL.tables[u].columns[n].toUpperCase())return jSQL.tables[u].columns[n];return _throw(new jSQL_Error("0013"),t)},n=function(e){for(var r,t="+,-,0,1,2,3,4,5,6,7,8,9,0,.".split(","),n=[],s=!1,a=[],i=0;i<e.length;i++)if("'"===e[i]||'"'===e[i])if(s)if(e[i]!==r)a.push(e[i]);else if(i>0&&"\\"===e[i-1])if(i>1&&"\\"===e[i-2]){s=!1,n.push(a.join(""));var a=[]}else a[a.length-1]=e[i];else{s=!1,n.push(a.join(""));var a=[]}else r=e[i],s=!0;else if(s){if("\\"===e[i]&&i>0&&"\\"===e[i-1])continue;a.push(e[i])}else if("?"===e[i])n.push("?");else if(t.indexOf(e[i])>-1){for(var o="";t.indexOf(e[i])>-1&&i<e.length;)o+=e[i],i++;n.push(parseFloat(o))}else if(" "!==e[i]&&","!==e[i])return n;return n},s=function(e){for(var t=[],n="",s=["'",'"',"`"],a=!1,i="",o=0;o<e.length;o++)!a&&s.indexOf(e[o])>-1?(a=!0,i=e[o],n+=e[o]):a&&e[o]===i?(a=!1,i="",n+=e[o]):a||","!==e[o]?n+=e[o]:(t.push(n),n="");t.push(n),n="";for(var u={},l="",c=0,o=0;o<t.length;o++){var h=t[o].trim(),f="",p="",i=null,y=!1,w=h.split("");4!==c&&(c=0);for(var m=0;m<w.length;m++){var d=w[m];switch(c){case 0:if("="!==d&&" "!==d)f+=d;else if("="===d)if(" "==w[m+1]&&(m++,d=w[m]),isNaN(w[m+1]))if('"'==w[m+1]||"'"==w[m+1])i=w[m+1],c=1,m++;else{if("?"!=w[m+1])return _throw(new jSQL_Error("0024"));m++,d=w[m],u[r(f)]="?",c=3}else c=2,y=!0;break;case 1:d===i?"\\"==w[m-1]?p+=d:(u[r(f)]=p,c=3):p+=d;break;case 2:" "==d&&(m++,d=w[m]),isNaN(d)&&"."!=d?(u[r(f)]=parseFloat(p),l+=d,c=3):p+=""+d;break;case 3:if(" "==d&&(m++,d=w[m]),void 0===d)break;c=4,l+=d;break;case 4:l+=d}}l+=",",""!==p&&(u[r(f)]=y?parseFloat(p):p)}return","===l.substring(l.length-1)&&(l=l.substring(0,l.length-1)),{newVals:u,whereClause:l}},a=function(e,n){for(;n.length;){var s=n.shift();switch(s.toUpperCase()){case"WHERE":case"AND":var a;try{a=t(n.shift(),!0)}catch(i){return new function(e){this.execute=function(){return _throw(e)},this.fetch=function(){return _throw(e)},this.fetchAll=function(){return _throw(e)}}(i.message)}e=e.where(a);break;case"=":e=e.equals(r(n.shift()));break;case">":e=e.greaterThan(r(n.shift()));break;case"<":e=e.lessThan(r(n.shift()));break;case"!=":case"<>":e=e.doesNotEqual(r(n.shift()));break;case"LIKE":var u=r(n.shift());e="%"==u.substr(0,1)&&"%"==u.substr(u.length-1,1)?e.contains(u.substr(1,u.length-2)):"%"==u.substr(0,1)?e.endsWith(u.substr(1,u.length-1)):"%"==u.substr(u.length-1,1)?e.beginsWith(u.substr(0,u.length-1)):"?"===u?e.preparedLike():e.equals(u);break;case"OR":var a=t(n.shift());e=e.or(a);break;case"LIMIT":var l,c=n.shift(),h=!1;if(","===c[c.length-1]&&(c=c.substring(0,c.length-1),h=!0),!h&&c.indexOf(",")>0){var f=c.split(",");c=f[0],n.unshift(f[1]),h=!0}if(!h&&n.length){var p=n.shift();","===p[0]?(h=!0,p.length>1&&(p=p.substring(1,c.length),n.unshift(p))):n.unshift(p)}if(h&&(l=c,c=n.shift()),n.length&&!h){var p=n.shift();"OFFSET"===p.toUpperCase()?l=n.shift():n.unshift(p)}e=e.limit(c,l);break;case"ORDER":if("BY"!=n.shift().toUpperCase())return _throw(new jSQL_Error("0025"));for(;n.length>0;){var p=n.shift();try{for(;p.indexOf(",")==p.length-1;)p=p.substr(0,p.length-1);p=t(p),o.push(p)}catch(y){n.unshift(p);break}}e=e.orderBy(o);break;case"ASC":if(!o.length)return _throw(new jSQL_Error("0026"));e=e.asc();break;case"DESC":if(!o.length)return _throw(new jSQL_Error("0027"));e=e.desc()}}return e};e=jSQL.minify(e);var i=e.split(" ");switch(i.shift().toUpperCase()){case"DELETE":var o=[];if("FROM"!==i.shift().toUpperCase())return _throw(new jSQL_Error("0028"));var u=r(i.shift());if(void 0===jSQL.tables[u])return _throw(new jSQL_Error("0021"));var e=jSQL.deleteFrom(u);return e=a(e,i);case"DROP":if("TABLE"!==i.shift().toUpperCase())return _throw(new jSQL_Error("0029"));var u=r(i.shift());
if(0===u.indexOf("`")){u=u.substring(1);for(var l=" "+i.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&i.shift(),u+=h}u=r("`"+u)}return void 0===jSQL.tables[u]?_throw(new jSQL_Error("0021")):jSQL.dropTable(u);case"INSERT":var u,f=[],p=[],y=!1,w=i.shift().toUpperCase();if("IGNORE"===w&&(y=!0,w=i.shift().toUpperCase()),"INTO"!==w)return _throw(new jSQL_Error("0030"));if(u=r(i.shift()),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+i.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&i.shift(),u+=h}u=r("`"+u)}if(void 0===jSQL.tables[u])return _throw(new jSQL_Error("0021"));i=i.join(" ").split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" ");for(var m=i.shift();i.length&&"VALUES"!==m.toUpperCase();)f.push(r(m)),m=i.shift();if("VALUES"!==m.toUpperCase())return _throw(new jSQL_Error("0031"));var d=i.join(" ");if(p=n(d),!f.length)for(var c=0;c<p.length;c++){if(void 0===jSQL.tables[u].columns[c])return _throw(new jSQL_Error("0032"));f.push(jSQL.tables[u].columns[c])}if(p.length!==f.length)return _throw(new jSQL_Error("0033"));for(var g={},c=0;c<f.length;c++)g[f[c]]=p[c];var S=jSQL.insertInto(u).values(g);return y?S.ignore():S;case"CREATE":var u,Q,L={},f=[],E=!1;if("TABLE"!==i.shift().toUpperCase())return _throw(new jSQL_Error("0029"));var j=i.join(" "),b="",v=(j.match(/\(/g)||[]).length,_=(j.match(/\)/g)||[]).length;if(v!==_)return _throw(new jSQL_Error("0034"));if(v>0&&(b=j.substring(j.indexOf("(")+1,j.lastIndexOf(")"))),i=j.split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" "),u=r(i.shift()),"IF"===u.toUpperCase()){if("NOT"!==i.shift().toUpperCase())return _throw(new jSQL_Error("0035"));if("EXISTS"!==i.shift().toUpperCase())return _throw(new jSQL_Error("0036"));u=r(i.shift()),E=!0}if(0===u.indexOf("`")){u=u.substring(1);for(var l=" "+i.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&i.shift(),u+=h}u=r("`"+u)}L[u]=[];for(var C=b.split(","),c=0;c<C.length;c++){for(var j=C[c];(j.match(/\(/g)||[]).length!==(j.match(/\)/g)||[]).length;)j+=","+C[c+1],C[c+1]="",C[c]=j;""!==j.trim()&&f.push(j.trim())}for(var T=[],c=0;c<f.length;c++){var k=f[c].split(" "),A=r(k.shift());if("PRIMARY"!=A.toUpperCase()&&"UNIQUE"!=A.toUpperCase()){if(L[u][c]={name:A,type:"AMBI",args:[]},k.length){for(var O=[],x=!1,D=!1,I=0;I<k.length;I++)"PRIMARY"===k[I].toUpperCase()?x=I:"UNIQUE"===k[I].toUpperCase()?D=I:"KEY"===k[I].toUpperCase()&&x!==!1&&I===1+x||"KEY"===k[I].toUpperCase()&&D!==!1&&I===1+D||O.push(k[I]);if(k=O,!1!==x&&T.push({column:A,type:"primary"}),!1!==D&&T.push({column:A,type:"unique"}),!k.length)continue;var R=k.shift().toUpperCase();if((R.match(/\(/g)||[]).length){for(;!(R.match(/\)/g)||[]).length;){if(!k.length)return _throw(new jSQL_Error("0037"));R+=" "+k.shift()}""!==R.substring(R.lastIndexOf(")")+1)&&(k.unshift(R.substring(R.lastIndexOf(")")+1)),R.substring(0,R.lastIndexOf(")")))}!(R.match(/\(/g)||[]).length&&k.length&&"("===k[0].charAt(0)&&(R+=k[0].substring(0,k[0].indexOf(")")+1),k[0]=k[0].substring(k[0].indexOf(")")+1));var N="";if(R.indexOf("(")>-1){var v=(R.match(/\(/g)||[]).length,_=(R.match(/\)/g)||[]).length;if(v!==_)return _throw(new jSQL_Error("0038"));v>0&&(N=R.substring(R.indexOf("(")+1,R.lastIndexOf(")")))}if(""!==N.trim())for(var U=N.split(","),P=0;P<U.length;P++)""!==U[P].trim()&&L[u][c].args.push(U[P].trim());L[u][c].type=R.split("(")[0].trim().toUpperCase()}}else{for(var h,F=!1,q=!1,B=[],M="",Q=0;h=f[c][Q];Q++)if("("!==h){if(F)if(-1===['"',"`","'"].indexOf(h))if(" "!==h||q){if(F===!0&&")"===h){""!==M&&B.push(M),M="";break}(","!=h||q)&&(M+=h)}else""!==M&&B.push(M),M="";else q===!1?q=h:q===h?(q=!1,B.push(M),M=""):M+=h}else F=!0;T.push({column:B,type:A.toLowerCase()})}}var e=jSQL.createTable(L,T);return E&&e.ifNotExists(),e;case"UPDATE":var u,e,o=[];if(u=r(i.shift()),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+i.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&i.shift(),u+=h}u=r("`"+u)}for(var z in jSQL.tables)if(jSQL.tables.hasOwnProperty(z)&&z.toUpperCase()==r(u.toUpperCase())){u=z;break}var J=i.shift().toUpperCase();if("SET"!==J)return _throw(new jSQL_Error("0039"));var C=s(i.join(" "));return e=jSQL.update(u).set(C.newVals),e=a(e,C.whereClause.split(" "));case"SELECT":var u,W,e,o=[],V=!1,Y=e.toUpperCase().split(" ");Y.shift();var X=Y.indexOf("FROM");if(0>X)return _throw(new jSQL_Error("0040"));W=i.splice(0,X),"ALL"===W[0].toUpperCase()&&W.shift(),("DISTINCT"===W[0].toUpperCase()||"DISTINCTROW"===W[0].toUpperCase())&&(W.shift(),V=!0);for(var c=W.length;c--;)for(;W[c].indexOf(",")==W[c].length-1;)W[c]=W[c].substr(0,W[c].length-1);if(i.shift(),u=i.shift(),0===u.indexOf("`")){u=u.substring(1);for(var l=" "+i.join(" "),c=0;u.indexOf("`")<0&&c<l.length;c++){var h=l[c];" "===h&&i.shift(),u+=h}u=r("`"+u)}for(var z in jSQL.tables)if(jSQL.tables.hasOwnProperty(z)&&z.toUpperCase()==r(u.toUpperCase())){u=z;break}if(void 0===jSQL.tables[u])return new function(e){this.execute=function(){return _throw(e)},this.fetch=function(){return _throw(e)},this.fetchAll=function(){return _throw(e)}}(new jSQL_Error("0021"));if(1==W.length&&"*"==W[0])W="*";else for(var c=0;c<W.length;c++)W[c]=t(W[c]);return e=jSQL.select(W).from(u),V&&(e=e.distinct()),e=a(e,i);default:return _throw(new jSQL_Error("0041"))}}function jSQLWhereClause(e){var r=this;r.context=e,r.pendingColumn="",r.conditions=[],r.LIMIT=0,r.OFFSET=0,r.finalConditions=[],r.sortColumn=[],r.sortDirection="ASC",r.isDistinct=!1,r.where=function(e){return""!==r.pendingColumn?_throw(new jSQL_Error("0042")):"string"!=typeof e?_throw(new jSQL_Error("0043")):(r.pendingColumn=e,r)},r.equals=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0044")):(r.conditions.push({col:r.pendingColumn,type:"=",value:e}),r.pendingColumn="",r)},r.preparedLike=function(){return""==r.pendingColumn?_throw(new jSQL_Error("0045")):(r.conditions.push({col:r.pendingColumn,type:"pl",value:"?"}),r.pendingColumn="",r)},r.doesNotEqual=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0046")):(r.conditions.push({col:r.pendingColumn,type:"!=",value:e}),r.pendingColumn="",r)},r.lessThan=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0047")):(r.conditions.push({col:r.pendingColumn,type:"<",value:e}),r.pendingColumn="",r)},r.greaterThan=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0048")):(r.conditions.push({col:r.pendingColumn,type:">",value:e}),r.pendingColumn="",r)},r.contains=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0049")):(r.conditions.push({col:r.pendingColumn,type:"%%",value:e}),r.pendingColumn="",r)},r.endsWith=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0050")):(r.conditions.push({col:r.pendingColumn,type:"%-",value:e}),r.pendingColumn="",r)},r.beginsWith=function(e){return""==r.pendingColumn?_throw(new jSQL_Error("0051")):(r.conditions.push({col:r.pendingColumn,type:"-%",value:e}),r.pendingColumn="",r)},r.and=function(e){return r.where(e)},r.or=function(e){return r.finalConditions.push(r.conditions),r.conditions=[],r.where(e)},r.limit=function(e,t){return r.LIMIT=parseInt(e),void 0!==t&&(r.OFFSET=parseInt(t)),r},r.orderBy=function(e){return Array.isArray(e)||(e=[e]),r.sortColumn=e,r},r.asc=function(){return""==r.sortColumn?_throw(new jSQL_Error("0052")):(r.sortDirection="ASC",r)},r.desc=function(){return""==r.sortColumn?_throw(new jSQL_Error("0053")):(r.sortDirection="DESC",r)},r.execute=function(e){if(void 0===e&&(e=[]),r.conditions.length>0&&r.finalConditions.push(r.conditions),e.length>0)for(var t=r.finalConditions.length;t--;)for(var n=r.finalConditions[t].length;n--;)if("?"===r.finalConditions[t][n].value&&"pl"===r.finalConditions[t][n].type){var s=e.pop();"%"==s.substr(0,1)&&"%"==s.substr(s.length-1,1)?(r.finalConditions[t][n].value=s.substr(1,s.length-2),r.finalConditions[t][n].type="%%"):"%"==s.substr(0,1)?(r.finalConditions[t][n].value=s.substr(1,s.length-1),r.finalConditions[t][n].type="%-"):"%"==s.substr(s.length-1,1)?(r.finalConditions[t][n].value=s.substr(0,s.length-1),r.finalConditions[t][n].type="-%"):(r.finalConditions[t][n].value=s,r.finalConditions[t][n].type="=")}else"?"===r.finalConditions[t][n].value&&e.length>0&&(r.finalConditions[t][n].value=e.pop());return r.context.execute(e)},r.fetch=function(e){return r.context.fetch(e)},r.fetchAll=function(e){return r.context.fetchAll(e)},r.getResultRowIndexes=function(){for(var e=[],t=0;t<r.context.table.data.length;t++)if(r.finalConditions.length<1)e.push(t);else{for(var n=!1,s=r.finalConditions.length;s--;){for(var a=r.finalConditions[s],i=!0,o=a.length;o--;){var u=a[o];switch(u.type){case">":(isNaN(parseFloat(r.context.table.data[t][r.context.table.colmap[u.col]]))||r.context.table.data[t][r.context.table.colmap[u.col]]<u.value)&&(i=!1);break;case"<":(isNaN(parseFloat(r.context.table.data[t][r.context.table.colmap[u.col]]))||r.context.table.data[t][r.context.table.colmap[u.col]]>u.value)&&(i=!1);break;case"=":r.context.table.data[t][r.context.table.colmap[u.col]]!=u.value&&(i=!1);break;case"!=":break;case"%%":r.context.table.data[t][r.context.table.colmap[u.col]].indexOf(u.value)<0&&(i=!1);break;case"%-":r.context.table.data[t][r.context.table.colmap[u.col]].indexOf(u.value)!=r.context.table.data[t][r.context.table.colmap[u.col]].length-u.value.length&&(i=!1);break;case"-%":0!=r.context.table.data[t][r.context.table.colmap[u.col]].indexOf(u.value)&&(i=!1)}if(!i)break}if(i){n=!0;break}}n&&e.push(t)}if(r.sortColumn.length>0&&(e.sort(function(e,t){return e=r.context.table.data[e],t=r.context.table.data[t],function n(s){if(void 0===r.sortColumn[s])return 0;var a=r.sortColumn[s],i=r.context.table.colmap[a];return e[i]<t[i]?-1:e[i]>t[i]?1:n(s+1)}(0)}),"DESC"==r.sortDirection&&e.reverse()),r.isDistinct){for(var l=[],t=0;t<e.length;t++)l.push(r.context.table.data[e[t]]);for(var c=[],h=[],t=0;t<l.length;t++){for(var f={},p=0;p<r.context.columns.length;p++)f[r.context.columns[p]]=l[t][r.context.table.colmap[r.context.columns[p]]];var y=JSON.stringify(f);c.indexOf(y)>-1||(h.push(e[t]),c.push(y))}e=h}return r.LIMIT>0&&e.length>r.LIMIT&&(r.OFFSET>e.length&&(e=[]),r.LIMIT>e.length&&(r.LIMIT=e.length),e.length&&(e=e.slice(r.OFFSET,r.OFFSET+r.LIMIT))),e}}function WebSQLAPI(){var e=this;e.db=null;var r=function(r,t,n,s){"function"!=typeof n&&(n=function(){}),"function"!=typeof s&&(s=function(){return _throw(new jSQL_Error("0054"))});var a,i,o;Array.isArray(t[0])||(t=[t]),o=t.length;var u=function(e,r){var t,s,a=[];if(o-=1,!o){for(t=0,s=r.rows.length;s>t;t+=1){var i=r.rows.item(t).json;a.push(i)}n(a)}};e.db.transaction(function(e){for(a=0,i=t.length;i>a;a+=1)e.executeSql(r,t[a],u,s)})};e.init=function(t,n){"function"!=typeof n&&(n=function(){});var s=function(){try{for(var n=t.length;n--;)(function(t,n){r("DROP TABLE IF EXISTS "+t,[],function(){r("CREATE TABLE IF NOT EXISTS "+t+"(json TEXT)",[],function(){e.insert(t,n)})})})(t[n].name,t[n].rows)}catch(s){return _throw(new jSQL_Error("0055"))}};try{var a=window.location.href.replace(/\W+/g,"");e.db=openDatabase("jSQL_"+a,"1.0","jSQL "+a,5242880)}catch(i){return _throw(new jSQL_Error("0056"))}r("SELECT COUNT(*) FROM "+t[0].name,[],null,function(){s()}),n()},e.insert=function(e,t,n){"function"!=typeof n&&(n=function(){});var s,a,i=t.length,o=[];for(0===i&&n(),s=0,a=t.length;a>s;s+=1)o[s]=[JSON.stringify(t[s])];r("INSERT INTO "+e+" (json) VALUES (?);",o,n)},e["delete"]=function(e,t){"function"!=typeof t&&(t=function(){}),r("DELETE FROM "+e,[],t)},e.select=function(e,t){r("SELECT json FROM "+e,[],function(e){for(var r=[],n=e.length;n--;)r.push(JSON.parse(e[n]));t(r)})}}function indexedDBAPI(){var e=this;e.db=null;var r,t,n;e.init=function(s,a){"function"!=typeof a&&(a=function(){});try{r=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,t=window.hasOwnProperty("IDBTransaction")?window.IDBTransaction:window.webkitIDBTransaction,n=window.hasOwnProperty("IDBKeyRange")?window.IDBKeyRange:window.webkitIndexedDB}catch(i){return _throw(new jSQL_Error("0057"))}if(!r)return _throw(new jSQL_Error("0057"));var o=1,u=window.location.href.replace(/\W+/g,""),l=r.open("jSQL_"+u,o),c=function(){for(var r=s.length;r--;)e.db.objectStoreNames.contains(s[r].name)&&e.db.deleteObjectStore(s[r].name),e.db.createObjectStore(s[r].name,{keyPath:"_id",autoIncrement:!0});var t=0,n=!1,a=setInterval(function(){if(!n){n=!0;try{for(var r=s.length;r--;){var i=s[r].name,o=void 0==s[r].rows?[]:s[r].rows;e.insert(i,o)}clearInterval(a)}catch(u){if(t>1e3)return clearInterval(a),_throw(new jSQL_Error("0058"));n=!1}}},10)};l.onsuccess=function(r){var t;e.db=r.target.result,o=String(o),e.db.setVersion&&o!==e.db.version?(t=e.db.setVersion(o),t.onfailure=function(){return _throw(new jSQL_Error("0059"))},t.onsuccess=function(e){c(),t.result.oncomplete=function(){a()}}):a()},l.onupgradeneeded=function(r){e.db=r.target.result,c()},l.onerror=function(e){return _throw(new jSQL_Error("0060"))}},e.insert=function(r,n,s){"function"!=typeof s&&(s=function(){});var a,i,o,u=e.db.transaction([r],void 0===t.READ_WRITE?"readwrite":t.READ_WRITE),l=n.length,c=function(){l-=1,0===l&&s(l)};u.onerror=function(){return _throw(new jSQL_Error("0061"))},a=u.objectStore(r);for(i in n)n.hasOwnProperty(i)&&(o=a.add(n[i]),o.onsuccess=c,o.onerror=function(){return _throw(new jSQL_Error("0062"))})},e["delete"]=function(r,n){"function"!=typeof n&&(n=function(){});var s,a,i=e.db.transaction([r],void 0===t.READ_WRITE?"readwrite":t.READ_WRITE);i.onerror=function(){return _throw(new jSQL_Error("0061"))},s=i.objectStore(r),a=s.clear(),a.onerror=function(){return _throw(new jSQL_Error("0062"))},a.onsuccess=n},e.select=function(r,n){"function"!=typeof n&&(n=function(){});var s,a,i=e.db.transaction([r],void 0===t.READ_ONLY?"readonly":t.READ_ONLY),o=[];i.onerror=function(){return _throw(new jSQL_Error("0061"))},s=i.objectStore(r),a=s.openCursor(),a.onerror=function(){return _throw(new jSQL_Error("0062"))};var u=!1;a.onsuccess=function(e){if(!u){var r=e.target.result;return r?(o.push(r.value),void r["continue"]()):(u=!0,void n(o))}}}}function nodeAPI(){var e=this;e.db=null;var r=require("fs");e.init=function(e,t){if("function"!=typeof t&&(t=function(){}),!r.existsSync(".jsqldatastore"))try{r.writeFileSync(".jsqldatastore",JSON.stringify(e))}catch(n){return _throw(new jSQL_Error("0064"))}t()},e.insert=function(e,t,n){"function"!=typeof n&&(n=function(){});var s,a=JSON.parse(r.readFileSync(".jsqldatastore",{encoding:"utf8"}));for(s=a.length;s--&&!a[s].name===e;);for(var i=0;i<t.length;i++)a[s].rows.push(t[i]);r.writeFileSync(".jsqldatastore",JSON.stringify(a)),n()},e["delete"]=function(e,t){"function"!=typeof t&&(t=function(){});for(var n=JSON.parse(r.readFileSync(".jsqldatastore",{encoding:"utf8"})),s=n.length;s--;)if(!n[s].name!==e){n[s].rows=[];break}r.writeFileSync(".jsqldatastore",JSON.stringify(n)),t()},e.select=function(e,t){"function"!=typeof t&&(t=function(){}),"function"!=typeof t&&(t=function(){});for(var n=JSON.parse(r.readFileSync(".jsqldatastore",{encoding:"utf8"})),s=n.length;s--;)if(!n[s].name!==e)return void t(n[s].rows)}}function createTable(e,r,t,n){var s=void 0===r&&void 0===t&&"object"==typeof e&&void 0===n,a=Array.isArray(r)&&void 0===t&&"object"==typeof e&&void 0===n;if(s||a){a&&(n=r),r=[],t=[];for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];e=i;for(var u=0;u<o.length;u++){var l=o[u].name;r.push(l),t.push({type:o[u].type,args:void 0===o[u].args?[]:o[u].args})}break}}return Array.isArray(r)||(r=[r]),void 0===n&&(n=[]),Array.isArray(n)||(n=[n]),new jSQLQuery("CREATE").init(e,r,t,n)}function select(e){return Array.isArray(e)||(e=[e]),new jSQLQuery("SELECT").init(e)}function update(e){return new jSQLQuery("UPDATE").init(e)}function insertInto(e){return new jSQLQuery("INSERT").init(e)}function dropTable(e){return new jSQLQuery("DROP").init(e)}function deleteFrom(e){return new jSQLQuery("DELETE").init(e)}function jSQLReset(){jSQL.tables={},jSQL.commit()}function jSQLMinifier(e){for(var r="",t=e.split("\n"),n=!1,s="",a=["'","`",'"'],i=!1,o=0;o<t.length;o++){for(var u=0;u<t[o].length;u++){var l=t[o][u];if(!n&&a.indexOf(l)>-1)n=!0,s=l,r+=l;else if(n&&s===l)n=!1,s="",r+=l;else if(n)r+=l;else{var c="/"===l&&t[o].length>u&&"*"==t[o][u+1],h="*"===l&&t[o].length>u&&"/"==t[o][u+1];if(i||!c){if(h&&i)u++,i=!1;else if(!i){var f="#"===l||"-"===l&&t[o].length>u&&"-"==t[o][u+1];if(f)break;r+=l}}else i=!0}}r+="\n"}return r.replace(/\t/g," ").replace(/(\r\n|\n|\r)/gm," ").replace(/ +(?= )/g,"").trim()}var error_handler_function=function(){},persistenceManager=new function(){var e=this;e.api=null,e.error=!1,e.loaded=!1,e.isLoading=!1,e.loadingCallbacks=[],e.commit=function(r){if("function"==typeof r&&(r=function(){}),e.error!==!1)return _throw(e.error);var t=[];for(var n in jSQL.tables)if(jSQL.tables.hasOwnProperty(n)){for(var s=[],a=0;a<jSQL.tables[n].keys.unique.length;a++)s.push({column:jSQL.tables[n].keys.unique.column,type:"unique"});jSQL.tables[n].keys.primary.column&&s.push({column:jSQL.tables[n].keys.primary.column,type:"primary"});for(var i=jSQL.select("*").from(n).execute().fetchAll(),a=i.length;a--;){var o=i[a];for(var u in o)o.hasOwnProperty(u)&&(o[u]=jSQL.tables[n].normalizeColumnStoreValue(u,o[u]));t.push({table:n,data:JSON.stringify(o),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(s)})}}e.api["delete"]("jSQL_data_schema",function(){e.api.insert("jSQL_data_schema",t,r)})},e.load=function(r){if("function"!=typeof r&&(r=function(){}),e.loadingCallbacks.push(r),e.loaded)for(;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();e.isLoading||(e.isLoading=!0,e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()}))},e.rollback=function(r){"function"!=typeof r&&(r=function(){}),function t(n){try{e.api.select("jSQL_data_schema",function(t){if(jSQL.tables={},0===t.length)return void r();for(var n=t.length;n--;){var s=t[n].table,a=JSON.parse(t[n].data),i=JSON.parse(t[n].colTypes),o=JSON.parse(t[n].keys);if(void 0===jSQL.tables[s]){var u=[];for(var l in a)a.hasOwnProperty(l)&&u.push(l);jSQL.createTable(s,u,i,o).execute()}for(var l in a)a.hasOwnProperty(l)&&(a[l]=jSQL.tables[s].normalizeColumnFetchValue(l,a[l]));jSQL.tables[s].insertRow(a)}for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()})}catch(s){if(n>500){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();return}setTimeout(function(){t(n+1)},10)}}(0)},function(){if(isNode)e.api=new nodeAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}]);else try{e.api=new indexedDBAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(r){try{e.api=new WebSQLAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}])}catch(t){return _throw(new jSQL_Error("0063"))}}}()};return{version:2.5,tables:{},query:jSQLParseQuery,createTable:createTable,dropTable:dropTable,select:select,update:update,deleteFrom:deleteFrom,insertInto:insertInto,types:new jSQLDataTypeList,load:persistenceManager.load,onError:onError,reset:jSQLReset,minify:jSQLMinifier,commit:persistenceManager.commit,rollback:persistenceManager.rollback,persist:persistenceManager.commit}}();isNode?module.exports=jSQL:window.jSQL=jSQL}();