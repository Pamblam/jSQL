/**
 * jSQL.js v2.9.1
 * A Javascript Query Language Database Engine
 * @author Robert Parham
 * @website http://pamblam.github.io/jSQL/
 * @license http://www.apache.org/licenses/LICENSE-2.0
 */
!function(){var isNode=!("undefined"==typeof module||!module.exports),jSQL=function(){"use strict";function jSQL_Error(e){this.error=e,this.stack=void 0;var t=new Error;switch(t.stack&&(this.stack=t.stack),e){case"0001":this.message="Corrupted function stored in data.";break;case"0002":this.message="Attempted to apply a non-function as an error handler.";break;case"0003":this.message="Invalid datatype definition.";break;case"0004":this.message="DataType must have a `type` property.";break;case"0005":this.message="DataType must have a `serialize` function.";break;case"0006":this.message="DataType must have an `unserialize` function.";break;case"0007":this.message="Unsupported data type.";break;case"0008":this.message="Invalid table types array.";break;case"0009":this.message="Unable to convert columns to array.";break;case"0010":this.message="Invalid constraint.";break;case"0011":this.message="This table already has a primary key.";break;case"0012":this.message="renameColumn expects and old column name and a new one, both must be strings.";break;case"0013":this.message="Column does not exist.";break;case"0014":this.message="Data must be an array.";break;case"0015":this.message="Data not structured properly.";break;case"0016":this.message="Cannot insert a null value in a primary column.";break;case"0017":this.message="Primary Key violated.";break;case"0018":this.message="Cannot insert a null value in a unique column.";break;case"0019":this.message="Unique key violated.";break;case"0020":this.message="Data type's serialize() method did not return a string.";break;case"0021":this.message="Table does not exist.";break;case"0022":this.message="Method does not apply to query type.";break;case"0023":this.message="Fetch expects paramter one to be 'ASSOC', 'ARRAY', or undefined.";break;case"0024":this.message="Expected number or quoted string.";break;case"0025":this.message="Expected 'ORDER BY'.";break;case"0026":this.message="Must call ORDER BY before using ASC.";break;case"0027":this.message="Must call ORDER BY before using DESC.";break;case"0028":this.message="Unintelligible query. Expected 'FROM'.";break;case"0029":this.message="Unintelligible query. Expected 'TABLE'.";break;case"0030":this.message="Unintelligible query. Expected 'INTO'.";break;case"0031":this.message="Unintelligible query. Expected 'VALUES'.";break;case"0032":this.message="Unintelligible query. Too many values.";break;case"0033":this.message="Unintelligible query. Columns mismatch.";break;case"0034":this.message="Invalid Column definition.";break;case"0035":this.message="Unintelligible query. Expected 'NOT'.";break;case"0036":this.message="Unintelligible query. Expected 'EXISTS'.";break;case"0037":this.message="Unintelligible query. expected ')'.";break;case"0038":this.message="Invalid Arg definition.";break;case"0039":this.message="Unintelligible query. Expected 'SET'.";break;case"0040":this.message="Unintelligible query. Expected 'FROM'.";break;case"0041":this.message="Unintelligible query. WTF?";break;case"0042":this.message="Must add a conditional before adding another 'Where' condition.";break;case"0043":this.message="Column name must be a string.";break;case"0044":this.message="Must add a 'where' clause before the 'equals' call.";break;case"0045":this.message="Must add a 'where' clause before the 'preparedLike' call.";break;case"0046":this.message="Must add a 'where' clause before the 'doesNotEqual' call.";break;case"0047":this.message="Must add a 'where' clause before the 'lessThan' call.";break;case"0048":this.message="Must add a 'where' clause before the 'greaterThan' call.";break;case"0049":this.message="Must add a 'where' clause before the 'contains' call.";break;case"0050":this.message="Must add a 'where' clause before the 'endsWith' call.";break;case"0051":this.message="Must add a 'where' clause before the 'beginsWith' call.";break;case"0052":this.message="Must use orderBy clause before using ASC.";break;case"0053":this.message="Must use orderBy clause before using DESC.";break;case"0054":this.message="Could not execute query.";break;case"0055":this.message="Error creating table.";break;case"0056":this.message="Error opening database.";break;case"0057":this.message="indexedDB is not supported in this browser.";break;case"0058":this.message="Could not add data after 10 seconds.";break;case"0059":this.message="Error updating datastore version.";break;case"0060":this.message="Could not connect to the indexedDB datastore.";break;case"0061":this.message="Could not initiate a transaction.";break;case"0062":this.message="Could not initiate a request.";break;case"0063":this.message="Browser doesn't support Web SQL or IndexedDB.";break;case"0064":this.message="Unable towrite to datastore file.";break;case"0065":this.message="AUTO_INCREMENT column must be a key.";break;case"0066":this.message="AUTO_INCREMENT column must be an INT type.";break;case"0067":this.message="API is out of memory, cannot store more data.";break;case"0068":this.message="Invalid ENUM value.";break;case"0069":this.message="NUMERIC or INT type invalid or out of range.";break;default:this.message="Unknown error."}this.toString=function(){return void 0===this.error?"jSQL Error - "+this.message:"jSQL Error #"+this.error+" - "+this.message}}function _throw(e,t){throw t!==!0&&mute_jsql_errors!==!0&&error_handler_function(e),e}function onError(e){"function"==typeof e&&(error_handler_function=e)}function jSQLDataTypeList(){this.list=[{type:"NUMERIC",aliases:["NUMBER","DECIMAL","FLOAT"],serialize:function(e,t){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))}},{type:"ENUM",serialize:function(e,t){for(var r=t.length;r--;)if(e.toUpperCase()==removeQuotes(t[r]).toUpperCase())return removeQuotes(t[r]);return _throw(new jSQL_Error("0068"))},unserialize:function(e,t){for(var r=t.length;r--;)if(e.toUpperCase()==removeQuotes(t[r]).toUpperCase())return removeQuotes(t[r]);return _throw(new jSQL_Error("0068"))}},{type:"TINYINT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)&&e>=-128&&127>=e?parseInt(e):0},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0}},{type:"SMALLINT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)&&e>=-32768&&32767>=e?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"MEDIUMINT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)&&e>=-8388608&&8388607>=e?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"INT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)&&e>=-2147483648&&2147483647>=e?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"BIGINT",serialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)&&e>=-9007199254740991&&9007199254740991>=e?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"JSON",aliases:["ARRAY","OBJECT"],serialize:function(e){return JSON.stringify(e)},unserialize:function(e){return JSON.parse(e)}},{type:"FUNCTION",serialize:function(e){return"function"!=typeof e&&(e=function(){}),"jSQLFunct-"+e.toString()},unserialize:function(value){var p=value.split("-");if("jSQLFunct"!==p.shift())return _throw(new jSQL_Error("0001"));p=value.split("-"),p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}return"function"==typeof f?f:_throw(new jSQL_Error("0001"))}},{type:"BOOLEAN",aliases:["BOOL"],serialize:function(e){return e===!0||"TRUE"==e.toUpperCase()||1==e?"1":"0"},unserialize:function(e){return e===!0||"TRUE"==e.toUpperCase()||1==e}},{type:"CHAR",serialize:function(e,t){return""+e},unserialize:function(e,t){var r=t[0]>>0,n=" ";return e.length>r?e.substr(0,t[0]):(r-=e.length,r>n.length&&(n+=n.repeat(r/n.length)),String(e)+n.slice(0,r))}},{type:"VARCHAR",aliases:["LONGTEXT","MEDIUMTEXT"],serialize:function(e,t){return""+e},unserialize:function(e,t){return""+e}},{type:"DATE",serialize:function(e){return!e instanceof Date?new Date(e).getTime():e.getTime()},unserialize:function(e){return new Date(e)}},{type:"AMBI",serialize:function(e){return e instanceof Date?e.getTime():"function"==typeof e?"jSQLFunct-"+e.toString():!isNaN(parseFloat(e))&&isFinite(e)?e:""+e},unserialize:function(value){if("string"==typeof value&&"jSQLFunct"===value.split("-")[0]){var p=value.split("-");p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f}return value}}],this.add=function(e){return"object"!=typeof e?_throw(new jSQL_Error("0003")):void 0===e.type?_throw(new jSQL_Error("0004")):"function"!=typeof e.serialize?_throw(new jSQL_Error("0005")):"function"!=typeof e.unserialize?_throw(new jSQL_Error("0006")):void this.list.push({type:e.type.toUpperCase(),aliases:Array.isArray(e.aliases)?e.aliases:[],serialize:e.serialize,unserialize:e.unserialize})},this.exists=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return!0;return!1},this.getByType=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&this.list[t].aliases.indexOf(e)>-1)return this.list[t];return _throw(new jSQL_Error("0007"))}}function jSQLTable(e,t,r,n,i,s){var a=this;a.name="",a.columns=[],a.data=[],a.colmap={},a.types=[],a.auto_inc_col=!1,a.auto_inc_seq=0,a.keys={primary:{column:!1,map:{}},unique:[]},a.init=function(e,t,r,n,i,s){if(a.name=e,void 0===n&&(n=[]),!Array.isArray(n))return _throw(new jSQL_Error("0008"));if(Array.isArray(t)&&void 0===r&&(r=t,t=[]),Array.isArray(t)&&!Array.isArray(t[0])&&"object"==typeof t[0]){var o=[];for(var e in t[0])t[0].hasOwnProperty(e)&&o.push(e);r=t,t=o}if(!Array.isArray(t))return _throw(new jSQL_Error("0009"));a.columns=t;for(var u=0;u<t.length;u++)a.types[u]=void 0===n[u]||void 0===n[u].type?{type:"ambi",args:[]}:n[u];for(var u=a.types.length;u--;){var l=a.types[u].type.toUpperCase();if(!jSQL.types.exists(l))return _throw(new jSQL_Error("0007"));a.types[u].type=l}for(var u=0;u<t.length;u++)a.colmap[t[u]]=u;for(var c,h=["primary","unique"],f=0;c=i[f];f++){if(!c.hasOwnProperty("column")||!Array.isArray(c.column)&&-1===a.columns.indexOf(c.column))return _throw(new jSQL_Error("0010"));if(Array.isArray(c.column))for(var p=0;p<c.column.length;p++)if(-1===a.columns.indexOf(c.column[p]))return _throw(new jSQL_Error("0010"));var l=c.hasOwnProperty("type")&&-1!==h.indexOf(c.type.toLowerCase())?c.type.toLowerCase():"unique";if("primary"==l&&a.keys.primary.column!==!1)return _throw(new jSQL_Error("0011"));"primary"==l&&(a.keys.primary.column=c.column),"unique"==l&&a.keys.unique.push({column:c.column,map:{}})}if(s){for(var m=Array.isArray(a.keys.primary.column)&&a.keys.primary.column.indexOf(s)>-1,d=a.keys.primary.column===s,y=!1,u=a.keys.unique.length;u--;){var g=Array.isArray(a.keys.unique[u].column)&&a.keys.unique[u].column.indexOf(s)>-1,w=a.keys.unique[u].column===s;(g||w)&&(y=!0)}if(!(m||d||y))return _throw(new jSQL_Error("0065"));if("INT"!==a.types[a.colmap[s]].type)return _throw(new jSQL_Error("0066"));a.auto_inc_col=s}void 0!==r&&a.loadData(r)},a.renameColumn=function(e,t){if(void 0===e||"string"!=typeof t)return _throw(new jSQL_Error("0012"));if(a.columns.indexOf(e)<0)return _throw(new jSQL_Error("0013"));if(a.columns.splice(a.columns.indexOf(e),1,t),a.keys.primary.column===e&&(a.keys.primary.column=t),Array.isArray(a.keys.primary.column))for(var r=a.keys.primary.column.length;r--;)a.keys.primary.column[r]===e&&(a.keys.primary.column[r]=t);for(var n=a.keys.unique.length;n--;)if(a.keys.unique[n].column===e&&(a.keys.unique[n].column=t),Array.isArray(a.keys.unique[n].column))for(var r=a.keys.unique[n].column.length;r--;)a.keys.unique[n].column[r]===e&&(a.keys.unique[n].column[r]=t);var i={};for(var s in a.colmap)a.colmap.hasOwnProperty(s)&&(s===e?i[t]=a.colmap[s]:i[s]=a.colmap[s]);a.colmap=i,a.auto_inc_col===e&&(a.auto_inc_col=t)},a.addColumn=function(e,t,r){(void 0===r||void 0===r.type)&&(r={type:"AMBI",args:[]}),r.type=r.type.toUpperCase(),void 0===t&&(t=null),"string"!=typeof e&&(e=function i(e){for(var t=0;t<a.columns.length;t++)if(a.columns[t]=="u"+e)return i(e+1);return"u"+e}(0)),a.columns.push(e);for(var n=a.data.length;n--;)a.data[n].push(t);return a.colmap[e]=a.columns.length-1,jSQL.types.exists(r.type)?void a.types.push(r):_throw(new jSQL_Error("0007"))},a.loadData=function(e){if(!Array.isArray(e))return _throw(new jSQL_Error("0014"));for(var t=e.length;t--;)a.insertRow(e[t])},a.insertRow=function(e,t){var r=[];if(Array.isArray(e)){for(;e.length>a.columns.length;)a.addColumn();for(;e.length<a.columns.length;)e.push(null);for(var n=0;n<e.length;n++)r.push(e[n]);for(;r.length<a.columns.length;)r.push(null)}else{if("object"!=typeof e)return _throw(new jSQL_Error("0015"));for(var n=0;n<a.columns.length;n++)void 0===e[a.columns[n]]&&(e[a.columns[n]]=null);for(var i in e)if(!e.hasOwnProperty(i))continue;if(function(e){for(;e--;)if(a.columns[e]==i)return 0;return 1}(a.columns.length))if(a.columns.indexOf("u0")>-1){a.renameColumn("u0",i);for(var s=1;a.columns.indexOf("u"+s)>-1;)a.renameColumn("u"+s,"u"+(s-1))}else a.addColumn(i);for(var n=0;n<a.columns.length;n++)r.push(e[a.columns[n]])}for(var s=r.length;s--;)a.columns[s]===a.auto_inc_col&&(r[s]||(r[s]=a.auto_inc_seq,a.auto_inc_seq++),r[s]>=a.auto_inc_seq&&(a.auto_inc_seq=r[s]+1)),r[s]=a.normalizeColumnStoreValue(a.columns[s],r[s]);if(a.keys.primary.column){for(var o,u=Array.isArray(a.keys.primary.column)?a.keys.primary.column:[a.keys.primary.column],l=[],c=0;o=u[c];c++){var h=a.colmap[o];if(null===r[h]){if(t===!0)return;return _throw(new jSQL_Error("0016"))}l.push(r[h])}if(l=JSON.stringify(l),a.keys.primary.map.hasOwnProperty(l)){if(t===!0)return;return _throw(new jSQL_Error("0017"))}a.keys.primary.map[l]=a.data.length}for(var f,p=0;f=a.keys.unique[p];p++){for(var m,d=Array.isArray(f.column)?f.column:[f.column],y=[],g=0;m=d[g];g++){var w=a.colmap[m];if(null===r[w]){if(t===!0)return;return _throw(new jSQL_Error("0018"))}y.push(r[w])}if(y=JSON.stringify(y),f.map.hasOwnProperty(y)){if(t===!0)return;return _throw(new jSQL_Error("0019"))}a.keys.unique[p].map[y]=a.data.length}a.data.push(r)},a.normalizeColumnStoreValue=function(e,t){var r=a.types[a.colmap[e]],n=jSQL.types.getByType(r.type.toUpperCase()).serialize(t,r.args);return!isNaN(parseFloat(n))&&isFinite(n)||"string"==typeof n?n:_throw(new jSQL_Error("0020"))},a.normalizeColumnFetchValue=function(e,t){var r=a.types[a.colmap[e]];return jSQL.types.getByType(r.type.toUpperCase()).unserialize(t,r.args)},a.init(e,t,r,n,i,s)}function jSQLQuery(e){var t=this;t.type=e.toUpperCase(),t.tablename=null,t.columns=[],t.data=[],t.INEFlag=!1,t.coltypes=[],t.table=null,t.newvals={},t.whereClause=new jSQLWhereClause(t),t.resultSet=[];for(var r=["init","ifNotExists","execute","fetch","ignore","fetchAll","values","set","where","from","orderBy","asc","desc","limit","distinct"],n={CREATE:jSQLCreateQuery,UPDATE:jSQLUpdateQuery,SELECT:jSQLSelectQuery,INSERT:jSQLInsertQuery,DROP:jSQLDropQuery,DELETE:jSQLDeleteQuery},i=0;i<r.length;i++)(function(e){t[r[e]]=function(){var i=new n[t.type];return"function"==typeof i[r[e]]?i[r[e]].apply(t,arguments):_throw(new jSQL_Error("0022"))}})(i)}function jSQLDeleteQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],this)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],r=[],n=0;n<this.table.data.length;n++){var i=this.table.data[n],s=this.table.keys.primary.column,a=!1;if(s!==!1){Array.isArray(s)||(s=[s]);var o;a=[];for(var u=0;o=s[u];u++){var l=this.table.colmap[o];if(null===i[l])return _throw(new jSQL_Error("0016"));a.push(i[l])}a=JSON.stringify(a),this.table.keys.primary.map.hasOwnProperty(a)&&this.table.keys.primary.map[a]==n&&(e.indexOf(n)>-1?delete this.table.keys.primary.map[a]:this.table.keys.primary.map[a]=r.length)}for(var c,h=0;c=this.table.keys.unique[h];h++){for(var f,p=Array.isArray(c.column)?c.column:[c.column],m=[],d=0;f=p[d];d++){var y=this.table.colmap[f];if(null===i[y])return _throw(new jSQL_Error("0018"));m.push(i[y])}if(m=JSON.stringify(m),c.map.hasOwnProperty(m)&&c.map[m]==n){if(this.ignoreFlag===!0)return this;e.indexOf(n)>-1?delete this.table.keys.unique[h].map[m]:this.table.keys.unique[h].map[m]=r.length}}e.indexOf(n)>-1?t.push(i):r.push(this.table.data[n])}return this.table.data=r,this.resultSet=t,this},this.where=function(e){return this.whereClause.where(e)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLDropQuery(){this.init=function(e){return this.tablename=e,this},this.execute=function(){return void 0===jSQL.tables[this.tablename]?_throw(new jSQL_Error("0021")):(delete jSQL.tables[this.tablename],this)},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLInsertQuery(){this.init=function(e){return this.table=e,this.ignoreFlag=!1,this},this.values=function(e){return void 0===jSQL.tables[this.table]?_throw(new jSQL_Error("0021")):(this.data=e,this)},this.execute=function(e){if(void 0!==e&&Array.isArray(e)&&e.length>0)if(Array.isArray(this.data))for(var t=this.data.length;t--&&e.length;)"?"==this.data[t]&&(this.data[t]=e.shift());else for(var t in this.data)this.data.hasOwnProperty(t)&&e.length&&"?"==this.data[t]&&(this.data[t]=e.shift());return jSQL.tables[this.table].insertRow(this.data,this.ignoreFlag),this},this.ignore=function(){return this.ignoreFlag=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLSelectQuery(){this.init=function(e){return this.columns=Array.isArray(e)?e:[e],this},this.from=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],"*"==this.columns[0]&&(this.columns=this.table.columns),this)},this.where=function(e){return this.whereClause.where(e)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],r=0;r<e.length;r++)t.push(this.table.data[e[r]]);for(var n=[],r=0;r<t.length;r++){for(var i={},s=0;s<this.columns.length;s++)i[this.columns[s]]=t[r][this.table.colmap[this.columns[s]]];n.push(i)}return this.resultSet=n,this},this.fetch=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;var t=this.resultSet.shift();for(var r in t)if(t.hasOwnProperty(r)){var n=this.table.normalizeColumnFetchValue(r,t[r]);t[r]=n}if("ARRAY"==e){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);t=n}return t},this.fetchAll=function(e){if(void 0===e&&(e="ASSOC"),e=e.toUpperCase(),"ASSOC"!==e&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;for(var t=[];this.resultSet.length>0;)t.push(this.fetch(e));return t},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLUpdateQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=this.table=jSQL.tables[e],this.ignoreFlag=!1,this)},this.set=function(e){this.newvals=e;for(var t in e)e.hasOwnProperty(t)&&this.columns.push(t);return this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(e){if(void 0!==e&&Array.isArray(e))for(var t in this.newvals)this.newvals.hasOwnProperty(t)&&"?"==this.newvals[t]&&e.length&&(this.newvals[t]=e.shift());for(var r=this.whereClause.getResultRowIndexes(),n=[],i=[],t=0;t<r.length;t++){for(var s=r[t],a=this.table.data[s].slice(0),o=0;o<this.columns.length;o++)this.columns[o]===this.table.auto_inc_col&&(this.newvals[this.columns[o]]||(this.newvals[this.columns[o]]=this.table.auto_inc_seq,this.table.auto_inc_seq++),this.newvals[this.columns[o]]>=this.table.auto_inc_seq&&(this.table.auto_inc_seq=this.newvals[this.columns[o]]+1)),a[this.table.colmap[this.columns[o]]]=this.table.normalizeColumnStoreValue(this.columns[o],this.newvals[this.columns[o]]);var u=this.table.keys.primary.column,l=!1;if(u!==!1){Array.isArray(u)||(u=[u]);var c;l=[];for(var h=0;c=u[h];h++){var f=this.table.colmap[c];if(null===a[f])return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0016"));l.push(a[f])}if(l=JSON.stringify(l),this.table.keys.primary.map.hasOwnProperty(l)&&this.table.keys.primary.map[l]!==s)return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0017"))}for(var p,m=[],d=0;p=this.table.keys.unique[d];d++){for(var y,g=Array.isArray(p.column)?p.column:[p.column],w=[],v=0;y=g[v];v++){var b=this.table.colmap[y];if(null===a[b])return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0018"));w.push(a[b])}if(w=JSON.stringify(w),p.map.hasOwnProperty(w)&&p.map[w]!==s)return this.ignoreFlag===!0?this:_throw(new jSQL_Error("0019"));m.push(w)}i.push({rowIndex:s,row:a,pk_vals:l,uni_vals:m})}for(var t=0;t<i.length;t++){n.push(i[t].row),this.table.data[i[t].rowIndex]=i[t].row;for(var y in this.table.keys.primary.map)if(this.table.keys.primary.map.hasOwnProperty(y)&&this.table.keys.primary.map[y]==i[t].rowIndex){delete this.table.keys.primary.map[y],this.table.keys.primary.map[i[t].pk_vals]=s;break}for(var d=0;p=this.table.keys.unique[d];d++)for(var y in this.table.keys.unique[d].map)if(this.table.keys.unique[d].map.hasOwnProperty(y)&&this.table.keys.unique[d].map[y]==i[t].rowIndex){delete this.table.keys.unique[d].map[y],this.table.keys.unique[d].map[i[t].uni_vals[d]]=s;break}}return this.resultSet=n,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ignore=function(){return this.ignoreFlag=!0,this},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLCreateQuery(){this.init=function(e,t,r,n,i){return this.tablename=e,this.columns=t,this.coltypes=r,this.keys=n,this.ai_col=i,this},this.ifNotExists=function(){return this.INEFlag=!0,this},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(jSQL.tables[this.tablename]=new jSQLTable(this.tablename,this.columns,this.data,this.coltypes,this.keys,this.ai_col)),this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLParseQuery(e){var t=function(e,t){for(var r=0;r<jSQL.tables[o].columns.length;r++)if(removeQuotes(e.toUpperCase())==jSQL.tables[o].columns[r].toUpperCase())return jSQL.tables[o].columns[r];return _throw(new jSQL_Error("0013"),t)},r=function(e){for(var t,r="+,-,0,1,2,3,4,5,6,7,8,9,0,.".split(","),n=[],i=!1,s=[],a=0;a<e.length;a++)if("'"===e[a]||'"'===e[a])if(i)if(e[a]!==t)s.push(e[a]);else if(a>0&&"\\"===e[a-1])if(a>1&&"\\"===e[a-2]){i=!1,n.push(s.join(""));var s=[]}else s[s.length-1]=e[a];else{i=!1,n.push(s.join(""));var s=[]}else t=e[a],i=!0;else if(i){if("\\"===e[a]&&a>0&&"\\"===e[a-1])continue;s.push(e[a])}else if("?"===e[a])n.push("?");else if(r.indexOf(e[a])>-1){for(var o="";r.indexOf(e[a])>-1&&a<e.length;)o+=e[a],a++;n.push(parseFloat(o))}else if(" "!==e[a]&&","!==e[a])return n;return n},n=function(e){for(var t=[],r="",n=["'",'"',"`"],i=!1,s="",a=0;a<e.length;a++)!i&&n.indexOf(e[a])>-1?(i=!0,s=e[a],r+=e[a]):i&&e[a]===s?(i=!1,s="",r+=e[a]):i||","!==e[a]?r+=e[a]:(t.push(r),r="");t.push(r),r="";for(var o={},u="",l=0,a=0;a<t.length;a++){var c=t[a].trim(),h="",f="",s=null,p=!1,m=c.split("");4!==l&&(l=0);for(var d=0;d<m.length;d++){var y=m[d];switch(l){case 0:if("="!==y&&" "!==y)h+=y;else if("="===y)if(" "==m[d+1]&&(d++,y=m[d]),isNaN(m[d+1]))if('"'==m[d+1]||"'"==m[d+1])s=m[d+1],l=1,d++;else{if("?"!=m[d+1])return _throw(new jSQL_Error("0024"));d++,y=m[d],o[removeQuotes(h)]="?",l=3}else l=2,p=!0;break;case 1:y===s?"\\"==m[d-1]?f+=y:(o[removeQuotes(h)]=f,l=3):f+=y;break;case 2:" "==y&&(d++,y=m[d]),isNaN(y)&&"."!=y?(o[removeQuotes(h)]=parseFloat(f),u+=y,l=3):f+=""+y;break;case 3:if(" "==y&&(d++,y=m[d]),void 0===y)break;l=4,u+=y;break;case 4:u+=y}}u+=",",""!==f&&(o[removeQuotes(h)]=p?parseFloat(f):f)}return","===u.substring(u.length-1)&&(u=u.substring(0,u.length-1)),{newVals:o,whereClause:u}},i=function(e,r){for(;r.length;){var n=r.shift();switch(n.toUpperCase()){case"WHERE":case"AND":var i;try{i=t(r.shift(),!0)}catch(s){return new function(e){this.execute=function(){return _throw(e)},this.fetch=function(){return _throw(e)},this.fetchAll=function(){return _throw(e)}}(s.message)}e=e.where(i);break;case"=":e=e.equals(removeQuotes(r.shift()));break;case">":e=e.greaterThan(removeQuotes(r.shift()));break;case"<":e=e.lessThan(removeQuotes(r.shift()));break;case"!=":case"<>":e=e.doesNotEqual(removeQuotes(r.shift()));break;case"LIKE":var o=removeQuotes(r.shift());e="%"==o.substr(0,1)&&"%"==o.substr(o.length-1,1)?e.contains(o.substr(1,o.length-2)):"%"==o.substr(0,1)?e.endsWith(o.substr(1,o.length-1)):"%"==o.substr(o.length-1,1)?e.beginsWith(o.substr(0,o.length-1)):"?"===o?e.preparedLike():e.equals(o);break;case"OR":var i=t(r.shift());e=e.or(i);break;case"LIMIT":var u,l=r.shift(),c=!1;if(","===l[l.length-1]&&(l=l.substring(0,l.length-1),c=!0),!c&&l.indexOf(",")>0){var h=l.split(",");l=h[0],r.unshift(h[1]),c=!0}if(!c&&r.length){var f=r.shift();","===f[0]?(c=!0,f.length>1&&(f=f.substring(1,l.length),r.unshift(f))):r.unshift(f)}if(c&&(u=l,l=r.shift()),r.length&&!c){var f=r.shift();"OFFSET"===f.toUpperCase()?u=r.shift():r.unshift(f)}e=e.limit(l,u);break;case"ORDER":if("BY"!=r.shift().toUpperCase())return _throw(new jSQL_Error("0025"));for(;r.length>0;){var f=r.shift();try{for(;f.indexOf(",")==f.length-1;)f=f.substr(0,f.length-1);f=t(f),a.push(f)}catch(p){r.unshift(f);break}}e=e.orderBy(a);break;case"ASC":if(!a.length)return _throw(new jSQL_Error("0026"));e=e.asc();break;case"DESC":if(!a.length)return _throw(new jSQL_Error("0027"));e=e.desc()}}return e};e=jSQL.minify(e);var s=e.split(" ");switch(s.shift().toUpperCase()){case"DELETE":var a=[];if("FROM"!==s.shift().toUpperCase())return _throw(new jSQL_Error("0028"));var o=removeQuotes(s.shift());if(void 0===jSQL.tables[o])return _throw(new jSQL_Error("0021"));var e=jSQL.deleteFrom(o);return e=i(e,s);case"DROP":if("TABLE"!==s.shift().toUpperCase())return _throw(new jSQL_Error("0029"));var o=removeQuotes(s.shift());if(0===o.indexOf("`")){o=o.substring(1);for(var u=" "+s.join(" "),l=0;o.indexOf("`")<0&&l<u.length;l++){var c=u[l];" "===c&&s.shift(),o+=c}o=removeQuotes("`"+o)}return void 0===jSQL.tables[o]?_throw(new jSQL_Error("0021")):jSQL.dropTable(o);case"INSERT":var o,h=[],f=[],p=!1,m=s.shift().toUpperCase();if("IGNORE"===m&&(p=!0,m=s.shift().toUpperCase()),"INTO"!==m)return _throw(new jSQL_Error("0030"));if(o=removeQuotes(s.shift()),0===o.indexOf("`")){o=o.substring(1);for(var u=" "+s.join(" "),l=0;o.indexOf("`")<0&&l<u.length;l++){var c=u[l];" "===c&&s.shift(),o+=c}o=removeQuotes("`"+o)}if(void 0===jSQL.tables[o])return _throw(new jSQL_Error("0021"));s=s.join(" ").split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" ");for(var d=s.shift();s.length&&"VALUES"!==d.toUpperCase();)h.push(removeQuotes(d)),d=s.shift();if("VALUES"!==d.toUpperCase())return _throw(new jSQL_Error("0031"));var y=s.join(" ");if(f=r(y),!h.length)for(var l=0;l<f.length;l++){if(void 0===jSQL.tables[o].columns[l])return _throw(new jSQL_Error("0032"));h.push(jSQL.tables[o].columns[l])}if(f.length!==h.length)return _throw(new jSQL_Error("0033"));for(var g={},l=0;l<h.length;l++)g[h[l]]=f[l];var w=jSQL.insertInto(o).values(g);return p?w.ignore():w;case"CREATE":var o,v,b={},h=[],S=!1;if("TABLE"!==s.shift().toUpperCase())return _throw(new jSQL_Error("0029"));var _=s.join(" "),Q="",L=(_.match(/\(/g)||[]).length,j=(_.match(/\)/g)||[]).length;if(L!==j)return _throw(new jSQL_Error("0034"));if(L>0&&(Q=_.substring(_.indexOf("(")+1,_.lastIndexOf(")"))),s=_.split("(").join(" ").split(")").join(" ").split(",").join(" ").split("  ").join(" ").trim().split(" "),o=removeQuotes(s.shift()),"IF"===o.toUpperCase()){if("NOT"!==s.shift().toUpperCase())return _throw(new jSQL_Error("0035"));if("EXISTS"!==s.shift().toUpperCase())return _throw(new jSQL_Error("0036"));o=removeQuotes(s.shift()),S=!0}if(0===o.indexOf("`")){o=o.substring(1);for(var u=" "+s.join(" "),l=0;o.indexOf("`")<0&&l<u.length;l++){var c=u[l];" "===c&&s.shift(),o+=c}o=removeQuotes("`"+o)}b[o]=[];for(var E=Q.split(","),l=0;l<E.length;l++){for(var _=E[l];(_.match(/\(/g)||[]).length!==(_.match(/\)/g)||[]).length&&l<E.length;)_+=","+E[l+1],E[l+1]="",E[l]=_,l++;""!==_.trim()&&h.push(_.trim())}for(var C=[],l=0;l<h.length;l++){var k=h[l].split(" "),O=removeQuotes(k.shift()),A=!1;if("PRIMARY"!=O.toUpperCase()&&"UNIQUE"!=O.toUpperCase()){if(b[o][l]={name:O,type:"AMBI",args:[]},k.length){for(var I=[],x=!1,T=!1,N=0;N<k.length;N++)"PRIMARY"===k[N].toUpperCase()?x=N:"UNIQUE"===k[N].toUpperCase()?T=N:"KEY"===k[N].toUpperCase()&&x!==!1&&N===1+x||"KEY"===k[N].toUpperCase()&&T!==!1&&N===1+T||("AUTO_INCREMENT"===k[N].toUpperCase()?A=!0:I.push(k[N]));if(k=I,!1!==x&&C.push({column:O,type:"primary"}),!1!==T&&C.push({column:O,type:"unique"}),!k.length)continue;var U=k.shift().toUpperCase();if((U.match(/\(/g)||[]).length){for(;!(U.match(/\)/g)||[]).length;){if(!k.length)return _throw(new jSQL_Error("0037"));U+=" "+k.shift()}""!==U.substring(U.lastIndexOf(")")+1)&&(k.unshift(U.substring(U.lastIndexOf(")")+1)),U.substring(0,U.lastIndexOf(")")))}!(U.match(/\(/g)||[]).length&&k.length&&"("===k[0].charAt(0)&&(U+=k[0].substring(0,k[0].indexOf(")")+1),k[0]=k[0].substring(k[0].indexOf(")")+1));var q="";if(U.indexOf("(")>-1){var L=(U.match(/\(/g)||[]).length,j=(U.match(/\)/g)||[]).length;if(L!==j)return _throw(new jSQL_Error("0038"));L>0&&(q=U.substring(U.indexOf("(")+1,U.lastIndexOf(")")))}if(""!==q.trim())for(var R=q.split(","),F=0;F<R.length;F++)""!==R[F].trim()&&b[o][l].args.push(R[F].trim());b[o][l].type=U.split("(")[0].trim().toUpperCase(),A&&(b[o][l].auto_increment=!0)}}else{for(var c,D=!1,P=!1,M=[],z="",v=0;c=h[l][v];v++)if("("!==c){if(D)if(-1===['"',"`","'"].indexOf(c))if(" "!==c||P){if(D===!0&&")"===c){""!==z&&M.push(z),z="";break}(","!=c||P)&&(z+=c)}else""!==z&&M.push(z),z="";else P===!1?P=c:P===c?(P=!1,M.push(z),z=""):z+=c}else D=!0;C.push({column:M,type:O.toLowerCase()})}}var e=jSQL.createTable(b,C);return S&&e.ifNotExists(),e;case"UPDATE":var o,e,a=[];if(o=removeQuotes(s.shift()),0===o.indexOf("`")){o=o.substring(1);for(var u=" "+s.join(" "),l=0;o.indexOf("`")<0&&l<u.length;l++){var c=u[l];" "===c&&s.shift(),o+=c}o=removeQuotes("`"+o)}for(var B in jSQL.tables)if(jSQL.tables.hasOwnProperty(B)&&B.toUpperCase()==removeQuotes(o.toUpperCase())){o=B;break}var J=s.shift().toUpperCase();if("SET"!==J)return _throw(new jSQL_Error("0039"));var E=n(s.join(" "));return e=jSQL.update(o).set(E.newVals),e=i(e,E.whereClause.split(" "));case"SELECT":var o,W,e,a=[],V=!1,Y=e.toUpperCase().split(" ");Y.shift();var X=Y.indexOf("FROM");if(0>X)return _throw(new jSQL_Error("0040"));W=s.splice(0,X),"ALL"===W[0].toUpperCase()&&W.shift(),("DISTINCT"===W[0].toUpperCase()||"DISTINCTROW"===W[0].toUpperCase())&&(W.shift(),V=!0);for(var l=W.length;l--;)for(;W[l].indexOf(",")==W[l].length-1;)W[l]=W[l].substr(0,W[l].length-1);
if(s.shift(),o=s.shift(),0===o.indexOf("`")){o=o.substring(1);for(var u=" "+s.join(" "),l=0;o.indexOf("`")<0&&l<u.length;l++){var c=u[l];" "===c&&s.shift(),o+=c}o=removeQuotes("`"+o)}for(var B in jSQL.tables)if(jSQL.tables.hasOwnProperty(B)&&B.toUpperCase()==removeQuotes(o.toUpperCase())){o=B;break}if(void 0===jSQL.tables[o])return new function(e){this.execute=function(){return _throw(e)},this.fetch=function(){return _throw(e)},this.fetchAll=function(){return _throw(e)}}(new jSQL_Error("0021"));if(1==W.length&&"*"==W[0])W="*";else for(var l=0;l<W.length;l++)W[l]=t(W[l]);return e=jSQL.select(W).from(o),V&&(e=e.distinct()),e=i(e,s);default:return _throw(new jSQL_Error("0041"))}}function jSQLWhereClause(e){var t=this;t.context=e,t.pendingColumn="",t.conditions=[],t.LIMIT=0,t.OFFSET=0,t.finalConditions=[],t.sortColumn=[],t.sortDirection="ASC",t.isDistinct=!1,t.where=function(e){return""!==t.pendingColumn?_throw(new jSQL_Error("0042")):"string"!=typeof e?_throw(new jSQL_Error("0043")):(t.pendingColumn=e,t)},t.equals=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0044")):(t.conditions.push({col:t.pendingColumn,type:"=",value:e}),t.pendingColumn="",t)},t.preparedLike=function(){return""==t.pendingColumn?_throw(new jSQL_Error("0045")):(t.conditions.push({col:t.pendingColumn,type:"pl",value:"?"}),t.pendingColumn="",t)},t.doesNotEqual=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0046")):(t.conditions.push({col:t.pendingColumn,type:"!=",value:e}),t.pendingColumn="",t)},t.lessThan=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0047")):(t.conditions.push({col:t.pendingColumn,type:"<",value:e}),t.pendingColumn="",t)},t.greaterThan=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0048")):(t.conditions.push({col:t.pendingColumn,type:">",value:e}),t.pendingColumn="",t)},t.contains=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0049")):(t.conditions.push({col:t.pendingColumn,type:"%%",value:e}),t.pendingColumn="",t)},t.endsWith=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0050")):(t.conditions.push({col:t.pendingColumn,type:"%-",value:e}),t.pendingColumn="",t)},t.beginsWith=function(e){return""==t.pendingColumn?_throw(new jSQL_Error("0051")):(t.conditions.push({col:t.pendingColumn,type:"-%",value:e}),t.pendingColumn="",t)},t.and=function(e){return t.where(e)},t.or=function(e){return t.finalConditions.push(t.conditions),t.conditions=[],t.where(e)},t.limit=function(e,r){return t.LIMIT=parseInt(e),void 0!==r&&(t.OFFSET=parseInt(r)),t},t.orderBy=function(e){return Array.isArray(e)||(e=[e]),t.sortColumn=e,t},t.asc=function(){return""==t.sortColumn?_throw(new jSQL_Error("0052")):(t.sortDirection="ASC",t)},t.desc=function(){return""==t.sortColumn?_throw(new jSQL_Error("0053")):(t.sortDirection="DESC",t)},t.execute=function(e){if(void 0===e&&(e=[]),t.conditions.length>0&&t.finalConditions.push(t.conditions),e.length>0)for(var r=t.finalConditions.length;r--;)for(var n=t.finalConditions[r].length;n--;)if("?"===t.finalConditions[r][n].value&&"pl"===t.finalConditions[r][n].type){var i=e.pop();"%"==i.substr(0,1)&&"%"==i.substr(i.length-1,1)?(t.finalConditions[r][n].value=i.substr(1,i.length-2),t.finalConditions[r][n].type="%%"):"%"==i.substr(0,1)?(t.finalConditions[r][n].value=i.substr(1,i.length-1),t.finalConditions[r][n].type="%-"):"%"==i.substr(i.length-1,1)?(t.finalConditions[r][n].value=i.substr(0,i.length-1),t.finalConditions[r][n].type="-%"):(t.finalConditions[r][n].value=i,t.finalConditions[r][n].type="=")}else"?"===t.finalConditions[r][n].value&&e.length>0&&(t.finalConditions[r][n].value=e.pop());return t.context.execute(e)},t.fetch=function(e){return t.context.fetch(e)},t.fetchAll=function(e){return t.context.fetchAll(e)},t.getResultRowIndexes=function(){for(var e=[],r=0;r<t.context.table.data.length;r++)if(t.finalConditions.length<1)e.push(r);else{for(var n=!1,i=t.finalConditions.length;i--;){for(var s=t.finalConditions[i],a=!0,o=s.length;o--;){var u=s[o];switch(u.type){case">":(isNaN(parseFloat(t.context.table.data[r][t.context.table.colmap[u.col]]))||t.context.table.data[r][t.context.table.colmap[u.col]]<u.value)&&(a=!1);break;case"<":(isNaN(parseFloat(t.context.table.data[r][t.context.table.colmap[u.col]]))||t.context.table.data[r][t.context.table.colmap[u.col]]>u.value)&&(a=!1);break;case"=":t.context.table.data[r][t.context.table.colmap[u.col]]!=u.value&&(a=!1);break;case"!=":break;case"%%":t.context.table.data[r][t.context.table.colmap[u.col]].indexOf(u.value)<0&&(a=!1);break;case"%-":t.context.table.data[r][t.context.table.colmap[u.col]].indexOf(u.value)!=t.context.table.data[r][t.context.table.colmap[u.col]].length-u.value.length&&(a=!1);break;case"-%":0!=t.context.table.data[r][t.context.table.colmap[u.col]].indexOf(u.value)&&(a=!1)}if(!a)break}if(a){n=!0;break}}n&&e.push(r)}if(t.sortColumn.length>0&&(e.sort(function(e,r){return e=t.context.table.data[e],r=t.context.table.data[r],function n(i){if(void 0===t.sortColumn[i])return 0;var s=t.sortColumn[i],a=t.context.table.colmap[s];return e[a]<r[a]?-1:e[a]>r[a]?1:n(i+1)}(0)}),"DESC"==t.sortDirection&&e.reverse()),t.isDistinct){for(var l=[],r=0;r<e.length;r++)l.push(t.context.table.data[e[r]]);for(var c=[],h=[],r=0;r<l.length;r++){for(var f={},p=0;p<t.context.columns.length;p++)f[t.context.columns[p]]=l[r][t.context.table.colmap[t.context.columns[p]]];var m=JSON.stringify(f);c.indexOf(m)>-1||(h.push(e[r]),c.push(m))}e=h}return t.LIMIT>0&&e.length>t.LIMIT&&(t.OFFSET>e.length&&(e=[]),t.LIMIT>e.length&&(t.LIMIT=e.length),e.length&&(e=e.slice(t.OFFSET,t.OFFSET+t.LIMIT))),e}}function createTable(e,t,r,n,i){var s=void 0===t&&void 0===r&&"object"==typeof e&&void 0===n,a=Array.isArray(t)&&void 0===r&&"object"==typeof e&&void 0===n;if(s||a){a&&(n=void 0===t?[]:t),void 0===n&&(n=[]),t=[],r=[];for(var o in e)if(e.hasOwnProperty(o)){var u=e[o];e=o;for(var l=0;l<u.length;l++){var c=u[l].name;t.push(c),r.push({type:u[l].type,args:void 0===u[l].args?[]:u[l].args}),u[l].hasOwnProperty("key")&&Array.isArray(n)&&n.push({column:u[l].name,type:u[l].key}),u[l].hasOwnProperty("auto_increment")&&u[l].auto_increment===!0&&(i=u[l].name)}break}}return Array.isArray(t)||(t=[t]),void 0===n&&(n=[]),Array.isArray(n)||(n=[n]),new jSQLQuery("CREATE").init(e,t,r,n,i)}function select(e){return Array.isArray(e)||(e=[e]),new jSQLQuery("SELECT").init(e)}function update(e){return new jSQLQuery("UPDATE").init(e)}function insertInto(e){return new jSQLQuery("INSERT").init(e)}function dropTable(e){return new jSQLQuery("DROP").init(e)}function deleteFrom(e){return new jSQLQuery("DELETE").init(e)}function jSQLReset(){jSQL.tables={},jSQL.commit()}function jSQLMinifier(e){for(var t="",r=e.split("\n"),n=!1,i="",s=["'","`",'"'],a=!1,o=0;o<r.length;o++){for(var u=0;u<r[o].length;u++){var l=r[o][u];if(!n&&s.indexOf(l)>-1)n=!0,i=l,t+=l;else if(n&&i===l)n=!1,i="",t+=l;else if(n)t+=l;else{var c="/"===l&&r[o].length>u&&"*"==r[o][u+1],h="*"===l&&r[o].length>u&&"/"==r[o][u+1];if(a||!c){if(h&&a)u++,a=!1;else if(!a){var f="#"===l||"-"===l&&r[o].length>u&&"-"==r[o][u+1];if(f)break;t+=l}}else a=!0}}t+="\n"}return t.replace(/\t/g," ").replace(/(\r\n|\n|\r)/gm," ").replace(/ +(?= )/g,"").trim()}function removeQuotes(e){for(var t=['"',"'","`"],r=t.length;r--;)if(e.substr(0,1)==t[r]&&e.substr(e.length-1,1)==t[r])return e.substr(1,e.length-2);return e}var error_handler_function=function(){},mute_jsql_errors=!1,API={cookieAPI:function(){var e=this,t=function(e,t){var r=new Date;r.setTime(r.getTime()+864e9);var n="expires="+r.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"},r=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""};e.init=function(t,r){"function"!=typeof r&&(r=function(){});for(var n,i=0;n=t[i];i++)e.insert(n.name,n.rows);r()},e.insert=function(e,n,i){"function"!=typeof i&&(i=function(){});var s;try{s=JSON.parse(r(e))}catch(a){s=[]}Array.isArray(s)||(s=[]);for(var o=0;o<n.length;o++)s.push(n[o]);var u=JSON.stringify(s);if(t(e,u),r(e)!==u){for(var l=100;l--&&r(e)!==u;)s.pop(),u=JSON.stringify(s),t(e,u);return _throw(new jSQL_Error("0067"))}i()},e["delete"]=function(e,r){"function"!=typeof r&&(r=function(){}),t(e,JSON.stringify([])),r()},e.select=function(e,t){"function"!=typeof t&&(t=function(){});var n=JSON.parse(r(e));t(n)}},localStorageAPI:function(){var e=this;e.init=function(t,r){"function"!=typeof r&&(r=function(){});for(var n,i=0;n=t[i];i++)e.insert(n.name,n.rows);r()},e.insert=function(e,t,r){"function"!=typeof r&&(r=function(){});var n;try{n=JSON.parse(localStorage.getItem(e))}catch(i){n=[]}Array.isArray(n)||(n=[]);for(var s=0;s<t.length;s++)n.push(t[s]);var a=JSON.stringify(n);if(localStorage.setItem(e,a),localStorage.getItem(e)!==a){for(var o=100;o--&&localStorage.getItem(e)!==a;)n.pop(),a=JSON.stringify(n),localStorage.setItem(e,a);return _throw(new jSQL_Error("0067"))}r()},e["delete"]=function(e,t){"function"!=typeof t&&(t=function(){}),localStorage.setItem(e,JSON.stringify([])),t()},e.select=function(e,t){"function"!=typeof t&&(t=function(){});var r=JSON.parse(localStorage.getItem(e));t(r)}},nodeAPI:function(){var e=this;e.db=null;var t=require("fs");e.init=function(e,r){if("function"!=typeof r&&(r=function(){}),!t.existsSync(".jsqldatastore"))try{t.writeFileSync(".jsqldatastore",JSON.stringify(e))}catch(n){return _throw(new jSQL_Error("0064"))}r()},e.insert=function(e,r,n){"function"!=typeof n&&(n=function(){});var i,s=JSON.parse(t.readFileSync(".jsqldatastore",{encoding:"utf8"}));for(i=s.length;i--&&!s[i].name===e;);for(var a=0;a<r.length;a++)s[i].rows.push(r[a]);t.writeFileSync(".jsqldatastore",JSON.stringify(s)),n()},e["delete"]=function(e,r){"function"!=typeof r&&(r=function(){});for(var n=JSON.parse(t.readFileSync(".jsqldatastore",{encoding:"utf8"})),i=n.length;i--;)if(!n[i].name!==e){n[i].rows=[];break}t.writeFileSync(".jsqldatastore",JSON.stringify(n)),r()},e.select=function(e,r){"function"!=typeof r&&(r=function(){});for(var n=JSON.parse(t.readFileSync(".jsqldatastore",{encoding:"utf8"})),i=n.length;i--;)if(!n[i].name!==e)return void r(n[i].rows)}},indexedDBAPI:function(){var e=this;e.db=null;var t,r,n;e.init=function(i,s){"function"!=typeof s&&(s=function(){});try{t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,r=window.hasOwnProperty("IDBTransaction")?window.IDBTransaction:window.webkitIDBTransaction,n=window.hasOwnProperty("IDBKeyRange")?window.IDBKeyRange:window.webkitIndexedDB}catch(a){return _throw(new jSQL_Error("0057"))}if(!t)return _throw(new jSQL_Error("0057"));var o=1,u=window.location.href.replace(/\W+/g,""),l=t.open("jSQL_"+u,o),c=function(){for(var t=i.length;t--;)e.db.objectStoreNames.contains(i[t].name)&&e.db.deleteObjectStore(i[t].name),e.db.createObjectStore(i[t].name,{keyPath:"_id",autoIncrement:!0});var r=0,n=!1,s=setInterval(function(){if(!n){n=!0;try{for(var t=i.length;t--;){var a=i[t].name,o=void 0==i[t].rows?[]:i[t].rows;e.insert(a,o)}clearInterval(s)}catch(u){if(r>1e3)return clearInterval(s),_throw(new jSQL_Error("0058"));n=!1}}},10)};l.onsuccess=function(t){var r;e.db=t.target.result,o=String(o),e.db.setVersion&&o!==e.db.version?(r=e.db.setVersion(o),r.onfailure=function(){return _throw(new jSQL_Error("0059"))},r.onsuccess=function(e){c(),r.result.oncomplete=function(){s()}}):s()},l.onupgradeneeded=function(t){e.db=t.target.result,c()},l.onerror=function(e){return _throw(new jSQL_Error("0060"))}},e.insert=function(t,n,i){"function"!=typeof i&&(i=function(){});var s,a,o,u=e.db.transaction([t],void 0===r.READ_WRITE?"readwrite":r.READ_WRITE),l=n.length,c=function(){l-=1,0===l&&i(l)};u.onerror=function(){return _throw(new jSQL_Error("0061"))},s=u.objectStore(t);for(a in n)n.hasOwnProperty(a)&&(o=s.add(n[a]),o.onsuccess=c,o.onerror=function(){return _throw(new jSQL_Error("0062"))})},e["delete"]=function(t,n){"function"!=typeof n&&(n=function(){});var i,s,a=e.db.transaction([t],void 0===r.READ_WRITE?"readwrite":r.READ_WRITE);a.onerror=function(){return _throw(new jSQL_Error("0061"))},i=a.objectStore(t),s=i.clear(),s.onerror=function(){return _throw(new jSQL_Error("0062"))},s.onsuccess=n},e.select=function(t,n){"function"!=typeof n&&(n=function(){});var i,s,a=e.db.transaction([t],void 0===r.READ_ONLY?"readonly":r.READ_ONLY),o=[];a.onerror=function(){return _throw(new jSQL_Error("0061"))},i=a.objectStore(t),s=i.openCursor(),s.onerror=function(){return _throw(new jSQL_Error("0062"))};var u=!1;s.onsuccess=function(e){if(!u){var t=e.target.result;return t?(o.push(t.value),void t["continue"]()):(u=!0,void n(o))}}}},WebSQLAPI:function(){var e=this;e.db=null;var t=function(t,r,n,i){"function"!=typeof n&&(n=function(){}),"function"!=typeof i&&(i=function(){return _throw(new jSQL_Error("0054"))});var s,a,o;Array.isArray(r[0])||(r=[r]),o=r.length;var u=function(e,t){var r,i,s=[];if(o-=1,!o){for(r=0,i=t.rows.length;i>r;r+=1){var a=t.rows.item(r).json;s.push(a)}n(s)}};e.db.transaction(function(e){for(s=0,a=r.length;a>s;s+=1)e.executeSql(t,r[s],u,i)})};e.init=function(r,n){"function"!=typeof n&&(n=function(){});var i=function(){try{for(var n=r.length;n--;)(function(r,n){t("DROP TABLE IF EXISTS "+r,[],function(){t("CREATE TABLE IF NOT EXISTS "+r+"(json TEXT)",[],function(){e.insert(r,n)})})})(r[n].name,r[n].rows)}catch(i){return _throw(new jSQL_Error("0055"))}};try{var s=window.location.href.replace(/\W+/g,"");e.db=openDatabase("jSQL_"+s,"1.0","jSQL "+s,5242880)}catch(a){return _throw(new jSQL_Error("0056"))}t("SELECT COUNT(*) FROM "+r[0].name,[],null,function(){i()}),n()},e.insert=function(e,r,n){"function"!=typeof n&&(n=function(){});var i,s,a=r.length,o=[];for(0===a&&n(),i=0,s=r.length;s>i;i+=1)o[i]=[JSON.stringify(r[i])];t("INSERT INTO "+e+" (json) VALUES (?);",o,n)},e["delete"]=function(e,r){"function"!=typeof r&&(r=function(){}),t("DELETE FROM "+e,[],r)},e.select=function(e,r){t("SELECT json FROM "+e,[],function(e){for(var t=[],n=e.length;n--;)t.push(JSON.parse(e[n]));r(t)})}}},persistenceManager=new function(){var e=this;e.api=null,e.error=!1,e.loaded=!1,e.isLoading=!1,e.initiated=!1,e.loadingCallbacks=[],e.api_default_priority=["indexedDBAPI","WebSQLAPI","localStorageAPI","cookieAPI"],e.api_user_priority=[],e.setApiPriority=function(){e.api_user_priority=1===arguments.length?[arguments[0]]:Array.apply(null,arguments)},e.getApi=function(){var t=!1;try{t=e.api.constructor.name}catch(r){t=!1}return t},e.commit=function(t){if("function"==typeof t&&(t=function(){}),e.error!==!1)return _throw(e.error);var r=[];for(var n in jSQL.tables)if(jSQL.tables.hasOwnProperty(n)){for(var i=[],s=0;s<jSQL.tables[n].keys.unique.length;s++)i.push({column:jSQL.tables[n].keys.unique[s].column,type:"unique"});jSQL.tables[n].keys.primary.column&&i.push({column:jSQL.tables[n].keys.primary.column,type:"primary"});var a=jSQL.select("*").from(n).execute().fetchAll();a.length||r.push({table:n,data:JSON.stringify(jSQL.tables[n].columns),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(i),ai_col:jSQL.tables[n].auto_inc_col});for(var s=a.length;s--;){var o=a[s];for(var u in o)o.hasOwnProperty(u)&&(o[u]=jSQL.tables[n].normalizeColumnStoreValue(u,o[u]));r.push({table:n,data:JSON.stringify(o),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(i),ai_col:jSQL.tables[n].auto_inc_col})}}e.api["delete"]("jSQL_data_schema",function(){e.api.insert("jSQL_data_schema",r,t)})},e.load=function(t){if("function"!=typeof t&&(t=function(){}),e.loadingCallbacks.push(t),e.loaded)for(;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();e.isLoading||(e.isLoading=!0,e.initiated?e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()}):e.init(function(){e.rollback(function(){for(e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()()})}))},e.rollback=function(t){"function"!=typeof t&&(t=function(){}),mute_jsql_errors=!0,function r(n){try{e.api.select("jSQL_data_schema",function(e){if(jSQL.tables={},0===e.length)return mute_jsql_errors=!1,void t();for(var r=e.length;r--;){var n=e[r].table,i=JSON.parse(e[r].data),s=JSON.parse(e[r].colTypes),a=JSON.parse(e[r].keys),o=e[r].ai_col;if(void 0===jSQL.tables[n])if(Array.isArray(i))u=i,jSQL.createTable(n,u,s,a,o).execute();else{var u=[];for(var l in i)i.hasOwnProperty(l)&&u.push(l);jSQL.createTable(n,u,s,a,o).execute()}if(!Array.isArray(i)){for(var l in i)i.hasOwnProperty(l)&&(i[l]=jSQL.tables[n].normalizeColumnFetchValue(l,i[l]));jSQL.tables[n].insertRow(i)}}mute_jsql_errors=!1,t()})}catch(i){if(n>500){for(mute_jsql_errors=!1,e.isLoading=!1,e.loaded=!0;e.loadingCallbacks.length;)e.loadingCallbacks.shift()();return}setTimeout(function(){r(n+1)},10)}}(0)},e.init=function(t){if("function"!=typeof t&&(t=function(){}),e.initiated=!0,isNode)e.api=new API.nodeAPI,e.api.init([{name:"jSQL_data_schema",rows:[]}],t);else{var r=e.api_user_priority.concat(e.api_default_priority),n=[],i=!1;!function s(a){if(a>=r.length&&!i)return _throw(new jSQL_Error("0063"));if(-1===e.api_default_priority.indexOf(r[a]))return s(1+a);if(n.indexOf(r[a])>-1)return s(1+a);try{e.api=new API[r[a]],e.api.init([{name:"jSQL_data_schema",rows:[]}],t),i=!0}catch(o){i=!1}i||s(1+a)}(0)}}};return{version:2.91,tables:{},query:jSQLParseQuery,createTable:createTable,dropTable:dropTable,select:select,update:update,deleteFrom:deleteFrom,insertInto:insertInto,types:new jSQLDataTypeList,load:persistenceManager.load,onError:onError,reset:jSQLReset,minify:jSQLMinifier,commit:persistenceManager.commit,rollback:persistenceManager.rollback,setApiPriority:persistenceManager.setApiPriority,getApi:persistenceManager.getApi}}();isNode?module.exports=jSQL:window.jSQL=jSQL}();