/*! jsql-official - v4.0.34 */
!function(){var isNode=!("undefined"==typeof module||!module.exports),jSQL=function(){"use strict";function jSQL_Error(e){this.error=e,this.stack=void 0;var t=new Error;t.stack&&(this.stack=t.stack),this.message=jSQL_Error.message_codes[e],this.toString=function(){return"jSQL Error #"+this.error+" - "+this.message}}function jSQL_Lexer_Error(e,t){var n=t.length>e+25?25:t.length-e,r=t.substr(e,n);this.error="0070",this.message="Unknown token near char "+e+" of "+t.length+' "'+r+'".',this.stack=void 0;var i=new Error;i.stack&&(this.stack=i.stack),this.toString=function(){return"jSQL Lexer Error #"+this.error+" - "+this.message}}function jSQL_Parse_Error(e,t){this.error="0071",this.message="Unexpected "+e.type+" ("+e.name+") at character "+e.input_pos+".",t&&(this.message+=" Expected "+t+"."),this.stack=void 0;var n=new Error;n.stack&&(this.stack=n.stack),this.toString=function(){return"jSQL Parse Error #"+this.error+" - "+this.message}}jSQL_Error.message_codes={"0001":"Corrupted function stored in data.","0003":"Invalid datatype definition.","0004":"DataType must have a `type` property.","0005":"DataType must have a `serialize` function.","0006":"DataType must have an `unserialize` function.","0007":"Unsupported data type.","0010":"Invalid constraint.","0011":"This table already has a primary key.","0012":"renameColumn expects and old column name and a new one, both must be strings.","0013":"Column does not exist.","0014":"Data must be an array.","0015":"Data not structured properly.","0016":"Cannot insert a null value in a primary column.","0017":"Primary Key violated.","0018":"Cannot insert a null value in a unique column.","0019":"Unique key violated.","0020":"Data type's serialize() method did not return a string.","0021":"Table does not exist.","0022":"Method does not apply to query type.","0023":"Fetch expects paramter one to be 'ASSOC', 'ARRAY', or undefined.","0024":"Expected number or quoted string.","0025":"Expected 'ORDER BY'.","0026":"Must call ORDER BY before using ASC.","0027":"Must call ORDER BY before using DESC.","0028":"Unintelligible query. Expected 'FROM'.","0029":"Unintelligible query. Expected 'TABLE'.","0030":"Unintelligible query. Expected 'INTO'.","0031":"Unintelligible query. Expected 'VALUES'.","0032":"Unintelligible query. Too many values.","0033":"Unintelligible query. Columns mismatch.","0034":"Invalid Column definition.","0035":"Unintelligible query. Expected 'NOT'.","0036":"Unintelligible query. Expected 'EXISTS'.","0037":"Unintelligible query. expected ')'.","0038":"Invalid Arg definition.","0039":"Unintelligible query. Expected 'SET'.","0040":"Unintelligible query. Expected 'FROM'.","0041":"Unintelligible query. WTF?","0042":"Must add a conditional before adding another 'Where' condition.","0043":"Column name must be a string.","0044":"Must add a 'where' clause before the 'equals' call.","0045":"Must add a 'where' clause before the 'preparedLike' call.","0046":"Must add a 'where' clause before the 'doesNotEqual' call.","0047":"Must add a 'where' clause before the 'lessThan' call.","0048":"Must add a 'where' clause before the 'greaterThan' call.","0049":"Must add a 'where' clause before the 'contains' call.","0050":"Must add a 'where' clause before the 'endsWith' call.","0051":"Must add a 'where' clause before the 'beginsWith' call.","0052":"Must use orderBy clause before using ASC.","0053":"Must use orderBy clause before using DESC.","0054":"Could not execute query.","0055":"Error creating table.","0056":"Error opening database.","0057":"indexedDB is not supported in this browser.","0058":"Could not add data after 10 seconds.","0059":"Error updating datastore version.","0060":"Could not connect to the indexedDB datastore.","0061":"Could not initiate a transaction.","0062":"Could not initiate a request.","0063":"Browser doesn't support Web SQL or IndexedDB.","0064":"Unable towrite to datastore file.","0065":"AUTO_INCREMENT column must be a key.","0066":"AUTO_INCREMENT column must be an INT type.","0067":"API is out of memory, cannot store more data.","0068":"Invalid ENUM value.","0069":"NUMERIC or INT type invalid or out of range.","0070":"Unknown Lexer Error.","0071":"Unknown Parser Error.","0072":"Inserting null into a non-null column.","0073":"No column name given.","0074":"On method called without join.","0075":"Unknown join table.","0076":"Calling Equals without join or where clause.","0077":"No matching table to join to."};var error_handler_function=function(){},mute_jsql_errors=!1;function _throw(e,t){throw!0!==t&&!0!==mute_jsql_errors&&error_handler_function(e),e}function onError(e){"function"==typeof e&&(error_handler_function=e)}function jSQLDataTypeList(){this.list=[{type:"NUMERIC",aliases:["NUMBER","DECIMAL","FLOAT"],serialize:function(e,t){return null===e&&(e=0),!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):_throw(new jSQL_Error("0069"))}},{type:"ENUM",serialize:function(e,t){if(null===e)return"jsqlNull";for(var n=t.length;n--;)if(e===removeQuotes(t[n]))return e;return _throw(new jSQL_Error("0068"))},unserialize:function(e,t){if("jsqlNull"===e)return null;for(var n=t.length;n--;)if(e===removeQuotes(t[n]))return e;return _throw(new jSQL_Error("0068"))}},{type:"TINYINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&-128<=e&&e<=127?parseInt(e):0},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):0}},{type:"SMALLINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&-32768<=e&&e<=32767?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"MEDIUMINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&-8388608<=e&&e<=8388607?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"INT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&-2147483648<=e&&e<=2147483647?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"BIGINT",serialize:function(e,t){return null===e&&(e=0),!isNaN(parseInt(e))&&isFinite(e)&&-9007199254740991<=e&&e<=9007199254740991?parseInt(e):_throw(new jSQL_Error("0069"))},unserialize:function(e,t){return e||(e=0),!isNaN(parseInt(e))&&isFinite(e)?parseInt(e):_throw(new jSQL_Error("0069"))}},{type:"JSON",aliases:["ARRAY","OBJECT"],serialize:function(e){return null===e?"jsqlNull":"string"==typeof e?e:JSON.stringify(e)},unserialize:function(e){return"jsqlNull"===e?null:JSON.parse(e)}},{type:"FUNCTION",serialize:function(value){if(null===value)return"jsqlNull";if("function"!=typeof value){var f=null;try{eval("f = "+value)}catch(e){}"function"==typeof f?value=f:_throw(new jSQL_Error("0001"))}return"jSQLFunct-"+value.toString()},unserialize:function(value){if("jsqlNull"===value)return null;var p=value.split("-");if("jSQLFunct"!==p.shift())return _throw(new jSQL_Error("0001"));p=value.split("-"),p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}return"function"==typeof f?f:_throw(new jSQL_Error("0001"))}},{type:"BOOLEAN",aliases:["BOOL"],serialize:function(e){return null===e?"jsqlNull":!0===e||"TRUE"==e.toUpperCase()||1==e?"1":"0"},unserialize:function(e){return"jsqlNull"===e?null:!0===e||"TRUE"==e.toUpperCase()||1==e}},{type:"CHAR",serialize:function(e,t){return null===e?"jsqlNull":""+e},unserialize:function(e,t){if("jsqlNull"===e)return null;var n=t[0]>>0,r=" ";return e.length>n?e.substr(0,t[0]):((n-=e.length)>r.length&&(r+=r.repeat(n/r.length)),String(e)+r.slice(0,n))}},{type:"VARCHAR",aliases:["LONGTEXT","MEDIUMTEXT"],serialize:function(e,t){return null===e?"jsqlNull":""+e},unserialize:function(e,t){return"jsqlNull"===e?null:""+e}},{type:"DATE",serialize:function(e){return null===e?"jsqlNull":e instanceof Date?e.getTime():new Date(e).getTime()},unserialize:function(e){return"jsqlNull"===e?null:new Date(e)}},{type:"AMBI",serialize:function(e){return null===e?"jsqlNull":e instanceof Date?e.getTime():"function"==typeof e?"jSQLFunct-"+e.toString():!isNaN(parseFloat(e))&&isFinite(e)?e:""+e},unserialize:function(value){if("jsqlNull"===value)return null;if("string"==typeof value&&"jSQLFunct"===value.split("-")[0]){var p=value.split("-");p.shift();var f=null;try{eval("f = "+p.join("-"))}catch(e){}if("function"==typeof f)return f}return value}}],this.add=function(e){return"object"!=typeof e?_throw(new jSQL_Error("0003")):void 0===e.type?_throw(new jSQL_Error("0004")):"function"!=typeof e.serialize?_throw(new jSQL_Error("0005")):"function"!=typeof e.unserialize?_throw(new jSQL_Error("0006")):void this.list.push({type:e.type.toUpperCase(),aliases:Array.isArray(e.aliases)?e.aliases:[],serialize:e.serialize,unserialize:e.unserialize})},this.exists=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&-1<this.list[t].aliases.indexOf(e))return!0;return!1},this.getByType=function(e){e=e.toUpperCase();for(var t=this.list.length;t--;)if(this.list[t].type===e||void 0!==this.list[t].aliases&&-1<this.list[t].aliases.indexOf(e))return this.list[t];return _throw(new jSQL_Error("0007"))}}function jSQLTable(e,t,n,r,i,a){var s=this;if(s.isTemp=!1,s.name="",s.alias="",s.columns=[],s.data=[],s.colmap={},s.types=[],s.auto_inc_col=!1,s.auto_inc_seq=0,s.keys={primary:{column:!1,map:{}},unique:[]},s.name=e,s.alias=e,void 0===r&&(r=[]),Array.isArray(t)&&void 0===n&&(n=t,t=[]),Array.isArray(t)&&!Array.isArray(t[0])&&"object"==typeof t[0]){var o,l=[];for(o in t[0])t[0].hasOwnProperty(o)&&l.push(o);n=t,t=l}s.initColumns(t,r),s.initKeys(i,a),s.initAI(a),void 0!==n&&s.loadData(n)}function jSQLQuery(e){var n=this;n.type=e.toUpperCase(),n.tablename=null,n.columns=[],n.data=[],n.INEFlag=!1,n.coltypes=[],n.table=null,n.newvals={},n.whereClause=new jSQLWhereClause(n),n.resultSet=[],n.isTemp=!1,n.selectTable=null,n.pendingJoin=null;for(var r=["init","ifNotExists","execute","fetch","ignore","fetchAll","values","set","where","from","orderBy","asc","desc","limit","distinct","temporary","join","innerJoin","on","equals"],i={CREATE:jSQLCreateQuery,UPDATE:jSQLUpdateQuery,SELECT:jSQLSelectQuery,INSERT:jSQLInsertQuery,DROP:jSQLDropQuery,DELETE:jSQLDeleteQuery},t=0;t<r.length;t++)!function(t){n[r[t]]=function(){var e=new i[n.type];return"function"==typeof e[r[t]]?e[r[t]].apply(n,arguments):_throw(new jSQL_Error("0022"))}}(t)}function jSQLDeleteQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=jSQL.tables[e],this)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],n=[],r=0;r<this.table.data.length;r++){var i,a=this.table.data[r],s=this.table.keys.primary.column,o=!1;if(!1!==s){var l;Array.isArray(s)||(s=[s]),o=[];for(var u=0;l=s[u];u++){var h=this.table.colmap[l];if(null===a[h])return _throw(new jSQL_Error("0016"));o.push(a[h])}o=JSON.stringify(o),this.table.keys.primary.map.hasOwnProperty(o)&&this.table.keys.primary.map[o]==r&&(-1<e.indexOf(r)?delete this.table.keys.primary.map[o]:this.table.keys.primary.map[o]=n.length)}for(var c=0;i=this.table.keys.unique[c];c++){for(var f,p=Array.isArray(i.column)?i.column:[i.column],y=[],m=0;f=p[m];m++){var S=this.table.colmap[f];if(null===a[S])return _throw(new jSQL_Error("0018"));y.push(a[S])}if(y=JSON.stringify(y),i.map.hasOwnProperty(y)&&i.map[y]==r){if(!0===this.ignoreFlag)return this;-1<e.indexOf(r)?delete this.table.keys.unique[c].map[y]:this.table.keys.unique[c].map[y]=n.length}}-1<e.indexOf(r)?t.push(a):n.push(this.table.data[r])}return this.table.data=n,this.resultSet=t,this},this.where=function(e){return this.whereClause.where(e)},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLDropQuery(){this.init=function(e){return this.tablename=e,this},this.execute=function(){return void 0===jSQL.tables[this.tablename]?_throw(new jSQL_Error("0021")):(delete jSQL.tables[this.tablename],this)},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLInsertQuery(){this.init=function(e){return this.table=e,this.ignoreFlag=!1,this},this.values=function(e){return void 0===jSQL.tables[this.table]?_throw(new jSQL_Error("0021")):(this.data=e,this)},this.execute=function(e){if(void 0!==e&&Array.isArray(e)&&0<e.length)if(Array.isArray(this.data))for(var t=this.data.length;t--&&e.length;)"?"==this.data[t]&&(this.data[t]=e.shift());else for(var t in this.data)this.data.hasOwnProperty(t)&&e.length&&"?"==this.data[t]&&(this.data[t]=e.shift());return jSQL.tables[this.table].insertRow(this.data,this.ignoreFlag),this},this.ignore=function(){return this.ignoreFlag=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLSelectQuery(){this.init=function(e){for(var t=(e=Array.isArray(e)?e:[e]).length;t--;){if("string"==typeof e[t]&&(e[t]={table:null,name:e[t],alias:e[t]}),"string"!=typeof e[t].name)return _throw(new jSQL_Error("0073"));e[t].alias||(e[t].alias=e[t].name),e[t].table||(e[t].table=null)}return this.columns=e,this},this.from=function(e,t){if(void 0===jSQL.tables[e])return _throw(new jSQL_Error("0021"));this.table=jSQL.tables[e],t&&(this.table.alias=t);for(var n=0;n<this.columns.length;n++)if("*"==this.columns[n].name){var r=this.columns.splice(n,1)[0].table||this.table.alias;if(this.table.alias==r)for(var i=0;i<this.table.columns.length;i++)this.columns.push({table:r,name:this.table.columns[i],alias:this.table.columns[i]})}return this},this.join=function(e,t){return this.innerJoin(e,t)},this.innerJoin=function(e,t){return t||(t=e),void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.pendingJoin={table:e,alias:t,type:"inner",onTable:null,onColumn:null,matchType:!1,matchTable:null,matchColumn:null},this)},this.on=function(e,t){var n;if(!this.pendingJoin)return _throw(new jSQL_Error("0074"));var r=!1;return this.table.alias==e&&(n=this.table.name,r=!0),r||this.pendingJoin.alias!=e||(n=this.pendingJoin.table,r=!0),r?~jSQL.tables[n].columns.indexOf(t)?(this.pendingJoin.onTable=e,this.pendingJoin.onColumn=t,this):_throw(new jSQL_Error("0013")):_throw(new jSQL_Error("0075"))},this.equals=function(e,t){if(!this.pendingJoin)return _throw(new jSQL_Error("0076"));if(!this.pendingJoin.onTable)return _throw(new jSQL_Error("0077"));var n=!1,r=!1;return this.table.alias==e&&(r=this.table.name,n=!0),n||this.pendingJoin.alias!=e||(r=this.pendingJoin.table,n=!0),n?~jSQL.tables[r].columns.indexOf(t)?(this.pendingJoin.matchTable="table",this.pendingJoin.matchcolumn="column",void(this.pendingJoin.matchType="equals")):_throw(new jSQL_Error("0013")):_throw(new jSQL_Error("0075"))},this.where=function(e){return this.whereClause.where(e)},this.execute=function(){for(var e=this.whereClause.getResultRowIndexes(),t=[],n=0;n<e.length;n++)t.push(this.table.data[e[n]]);var r=[];for(n=0;n<t.length;n++){for(var i={},a=0;a<this.columns.length;a++)i[this.columns[a].name]=t[n][this.table.colmap[this.columns[a].name]];r.push(i)}return this.resultSet=r,this},this.fetch=function(e){if(void 0===e&&(e="ASSOC"),"ASSOC"!==(e=e.toUpperCase())&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;for(var t=this.resultSet.shift(),n={},r=0;r<this.columns.length;r++)n[this.columns[r].name]=this.columns[r].alias;for(var i in t)if(t.hasOwnProperty(i)){var a=this.table.normalizeColumnFetchValue(i,t[i]);delete t[i],t[n[i]]=a}if("ARRAY"==e){a=[];for(var s in t)t.hasOwnProperty(s)&&a.push(t[s]);t=a}return t},this.fetchAll=function(e){if(void 0===e&&(e="ASSOC"),"ASSOC"!==(e=e.toUpperCase())&&"ARRAY"!==e)return _throw(new jSQL_Error("0023"));if(!this.resultSet.length)return!1;for(var t=[];0<this.resultSet.length;)t.push(this.fetch(e));return t},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLUpdateQuery(){this.init=function(e){return void 0===jSQL.tables[e]?_throw(new jSQL_Error("0021")):(this.table=this.table=jSQL.tables[e],this.ignoreFlag=!1,this)},this.set=function(e){for(var t in this.newvals=e)e.hasOwnProperty(t)&&this.columns.push(t);return this},this.where=function(e){return this.whereClause.where(e)},this.execute=function(e){if(void 0!==e&&Array.isArray(e))for(var t in this.newvals)this.newvals.hasOwnProperty(t)&&"?"==this.newvals[t]&&e.length&&(this.newvals[t]=e.shift());var n=this.whereClause.getResultRowIndexes(),r=[],i=[];for(t=0;t<n.length;t++){for(var a=n[t],s=this.table.data[a].slice(0),o=0;o<this.columns.length;o++)this.columns[o]===this.table.auto_inc_col&&(this.newvals[this.columns[o]]||(this.newvals[this.columns[o]]=this.table.auto_inc_seq,this.table.auto_inc_seq++),this.newvals[this.columns[o]]>=this.table.auto_inc_seq&&(this.table.auto_inc_seq=this.newvals[this.columns[o]]+1)),s[this.table.colmap[this.columns[o]]]=this.table.normalizeColumnStoreValue(this.columns[o],this.newvals[this.columns[o]]);var l=this.table.keys.primary.column,u=!1;if(!1!==l){var h;Array.isArray(l)||(l=[l]),u=[];for(var c=0;h=l[c];c++){var f=this.table.colmap[h];if(null===s[f])return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0016"));u.push(s[f])}if(u=JSON.stringify(u),this.table.keys.primary.map.hasOwnProperty(u)&&this.table.keys.primary.map[u]!==a)return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0017"))}for(var p,y=[],m=0;p=this.table.keys.unique[m];m++){for(var S=Array.isArray(p.column)?p.column:[p.column],d=[],E=0;g=S[E];E++){var L=this.table.colmap[g];if(null===s[L])return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0018"));d.push(s[L])}if(d=JSON.stringify(d),p.map.hasOwnProperty(d)&&p.map[d]!==a)return!0===this.ignoreFlag?this:_throw(new jSQL_Error("0019"));y.push(d)}i.push({rowIndex:a,row:s,pk_vals:u,uni_vals:y})}for(t=0;t<i.length;t++){for(var g in r.push(i[t].row),this.table.data[i[t].rowIndex]=i[t].row,this.table.keys.primary.map)if(this.table.keys.primary.map.hasOwnProperty(g)&&this.table.keys.primary.map[g]==i[t].rowIndex){delete this.table.keys.primary.map[g],this.table.keys.primary.map[i[t].pk_vals]=i[t].rowIndex;break}for(m=0;p=this.table.keys.unique[m];m++)for(var g in this.table.keys.unique[m].map)if(this.table.keys.unique[m].map.hasOwnProperty(g)&&this.table.keys.unique[m].map[g]==i[t].rowIndex){delete this.table.keys.unique[m].map[g],this.table.keys.unique[m].map[i[t].uni_vals[m]]=i[t].rowIndex;break}}return this.resultSet=r,this},this.fetch=function(){return null},this.fetchAll=function(){return[]},this.ignore=function(){return this.ignoreFlag=!0,this},this.orderBy=function(e){return this.whereClause.orderBy(e)},this.asc=function(){return this.whereClause.asc()},this.desc=function(){return this.whereClause.desc()},this.limit=function(){return this.whereClause.limit()},this.distinct=function(){return this.whereClause.isDistinct=!0,this}}function jSQLCreateQuery(){this.init=function(e,t,n,r,i){return this.tablename=e,this.columns=t,this.coltypes=n,this.keys=r,this.ai_col=i,this},this.ifNotExists=function(){return this.INEFlag=!0,this},this.execute=function(e){return void 0!==e&&(this.data=e),this.INEFlag&&jSQL.tables.hasOwnProperty(this.tablename)||(jSQL.tables[this.tablename]=new jSQLTable(this.tablename,this.columns,this.data,this.coltypes,this.keys,this.ai_col),this.isTemp&&(jSQL.tables[this.tablename].isTemp=!0)),this},this.temporary=function(){return this.isTemp=!0,this},this.fetch=function(){return null},this.fetchAll=function(){return[]}}function jSQLLexer(e){this.input=e,this.pos=0,this.real_pos=0,this.tokens=[],this.token_matches=[]}function jSQLToken(e,t,n){this.type_id=n,this.input_pos=e,this.literal=t,this.value=t,this.length=t.length,this.type=jSQLLexer.token_types[n].type,this.name=jSQLLexer.token_types[n].name,"IDENTIFIER"===this.type&&"UNQTD IDENTIFIER"===this.name&&jSQL.types.exists(this.literal)&&(this.name="DATA TYPE"),"IDENTIFIER"===this.type&&"QTD IDENTIFIER"===this.name&&(this.value=t.replace(/`/g,"")),"STRING"===this.type&&"DQ STRING"===this.name&&(this.value=t.substr(1,t.length-2).replace(/\"/g,'"')),"STRING"===this.type&&"SQ STRING"===this.name&&(this.value=t.substr(1,t.length-2).replace(/\'/g,"'")),"NUMBER"===this.type&&(this.value=parseFloat(this.literal)),"KEYWORD"===this.type&&"NULL"===this.name&&(this.value=null)}function jSQLParseQuery(e){var t=jSQL.tokenize(e);if(!t||!Array.isArray(t)||!t.length)return _throw(new jSQL_Error("0041"));if("DIRECTIVE"!==t[0].type)return _throw(new jSQL_Parse_Error(t[0],"DIRECTIVE"));switch(t.shift().name){case"CREATE":return jSQLParseCreateTokens(t);case"INSERT":return jSQLParseInsertTokens(t);case"SELECT":return jSQLParseSelectTokens(t);case"UPDATE":return jSQLParseUpdateTokens(t);case"DELETE FROM":return jSQLParseDeleteTokens(t);case"DROP TABLE":return jSQLParseDropTokens(t)}return _throw(new jSQL_Error("0041"))}function jSQLParseCreateTokens(e){var t,n=!1,r=!1,i=[],a={},s=!1;if("KEYWORD"===(t=e.shift()).type&&"TEMPORARY"===t.name&&(s=!0,t=e.shift()),"TABLE"!==t.name)return _throw(new jSQL_Parse_Error(t,"TABLE"));if("QUALIFIER"===(t=e.shift()).type&&"IF NOT EXISTS"===t.name&&(r=!0,t=e.shift()),"IDENTIFIER"===t.type&&(n=t.value),!n)return _throw(new jSQL_Parse_Error(t,"TABLE NAME"));if(a[n]=[],"SYMBOL"!==(t=e.shift()).type||"LEFT PEREN"!==t.name)return _throw(new jSQL_Parse_Error(t,"LEFT PEREN"));for(;e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("KEYWORD"!==t.type||"UNIQUE KEY"!==t.name&&"PRIMARY KEY"!==t.name){if("IDENTIFIER"!==t.type)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));var o=t.value,l={name:o,type:"AMBI",args:[],null:!0,default:void 0};if("DATA TYPE"===(t=e.shift()).name&&(l.type=t.literal.toUpperCase(),"SYMBOL"===(t=e.shift()).type&&"LEFT PEREN"===t.name)){for(;e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("STRING"!==t.type&&"NUMBER"!==t.type)return _throw(new jSQL_Parse_Error(t,"DATA TYPE PARAM OR CLOSING PEREN"));l.args.push(t.value)}t=e.shift()}"KEYWORD"!==t.type||"NULL"!==t.name&&"NOT NULL"!==t.name||(l.null="NULL"===t.name,t=e.shift()),"KEYWORD"===t.type&&"DEFAULT"===t.name&&(l.default=e.shift().value,t=e.shift()),"KEYWORD"===t.type&&"AUTO_INCREMENT"===t.name&&(l.auto_increment=!0,t=e.shift()),"KEYWORD"!==t.type||"UNIQUE KEY"!==t.name&&"PRIMARY KEY"!==t.name||(i.push({column:o,type:t.name.split(" ")[0].toLowerCase()}),t=e.shift()),a[n].push(l)}else{var u=t.name.split(" ")[0].toLowerCase();if("SYMBOL"!==(t=e.shift()).type||"LEFT PEREN"!==t.name)return _throw(new jSQL_Parse_Error(t,"LEFT PEREN"));for(var h=[];e.length;)if("SYMBOL"!==(t=e.shift()).type||"COMMA"!==t.name){if("SYMBOL"===t.type&&"RIGHT PEREN"===t.name)break;if("IDENTIFIER"!==t.type)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));var c=t.value;h.push(c)}if(!h.length)return _throw(new jSQL_Parse_Error(t,"COLUMN NAME"));i.push({column:h,type:u})}}if(e.length&&("SYMBOL"!==(t=e.shift()).type||"SEMICOLON"!==t.name))return _throw(new jSQL_Parse_Error(t,"END OF STATEMENT"));var f=jSQL.createTable(a,i);return s&&f.temporary(),r&&f.ifNotExists(),f}function jSQLParseInsertTokens(e){var t,n=[],r=[],i=!1,a=e.shift();if("KEYWORD"===a.type&&"IGNORE"===a.name&&(i=!0,a=e.shift()),"KEYWORD"!==a.type&&"INTO"===a.name)return _throw(new jSQL_Parse_Error(a,"INTO"));if(a=e.shift(),t=jSQLParseQuery.validateTableNameToken(a),"KEYWORD"!==(a=e.shift()).type&&"VALUES"!==a.name){if("SYMBOL"!==a.type||"LEFT PEREN"!==a.name)return _throw(new jSQL_Parse_Error(a,"COLUMN LIST OR VALUES"));for(;e.length;)if("SYMBOL"!==(a=e.shift()).type||"COMMA"!==a.name){if("SYMBOL"===a.type&&"RIGHT PEREN"===a.name){a=e.shift();break}if("IDENTIFIER"!==a.type)return _throw(new jSQL_Parse_Error(a,"COLUMN NAME"));var s=jSQLParseQuery.validateColumnName(a.value,t);n.push(s)}}if("KEYWORD"!==a.type&&"VALUES"!==a.name)return _throw(new jSQL_Parse_Error(a,"VALUES"));if("SYMBOL"!==(a=e.shift()).type||"LEFT PEREN"!==a.name)return _throw(new jSQL_Parse_Error(a,"VALUES LIST"));for(;e.length;)if("SYMBOL"!==(a=e.shift()).type||"COMMA"!==a.name){if("SYMBOL"===a.type&&"RIGHT PEREN"===a.name)break;r.push(a.value)}if(e.length&&("SYMBOL"!==(a=e.shift()).type||"SEMICOLON"!==a.name))return _throw(new jSQL_Parse_Error(a,"END OF STATEMENT"));if(!n.length)for(var o=0;o<r.length;o++){if(void 0===jSQL.tables[t].columns[o])return _throw(new jSQL_Error("0032"));n.push(jSQL.tables[t].columns[o])}if(r.length!==n.length)return _throw(new jSQL_Error("0033"));var l={};for(o=0;o<n.length;o++)l[n[o]]=r[o];var u=jSQL.insertInto(t).values(l);return i?u.ignore():u}function jSQLParseSelectTokens(e){var t,n,r=[],i=!1,a=e.shift();for("KEYWORD"===a.type&&"ALL"===a.name&&(a=e.shift()),"KEYWORD"!==a.type||"DISTINCT"!==a.name&&"DISTINCTROW"!==a.name||(i=!0,a=e.shift());e.length;)if(r.push(a.value),"SYMBOL"!==(a=e.shift()).type||"COMMA"!==a.name){if("KEYWORD"===a.type&&"FROM"===a.name)break}else a=e.shift();if("KEYWORD"!==a.type&&"FROM"!==a.name)return _throw(new jSQL_Parse_Error(a,"FROM"));if(a=e.shift(),t=jSQLParseQuery.validateTableNameToken(a),1==r.length&&"*"==r[0])r="*";else for(var s=0;s<r.length;s++)r[s]=jSQLParseQuery.validateColumnName(r[s],t);return n=jSQL.select(r).from(t),i&&(n=n.distinct()),n=jSQLParseWhereClause(n,e,t)}function jSQLParseUpdateTokens(e){var t,n={},r=e.shift();if(t=jSQLParseQuery.validateTableNameToken(r),"KEYWORD"!==(r=e.shift()).type&&"SET"!==r.name)return _throw(new jSQL_Parse_Error(r,"SET"));for(;e.length;){var i=jSQLParseQuery.validateColumnName(e.shift().value,t);if("SYMBOL"!==(r=e.shift()).type&&"EQUALS"!==r.name)return _throw(new jSQL_Parse_Error(r,"EQUALS"));var a=e.shift().value;if(n[i]=a,!e.length)break;if(("SYMBOL"!==(r=e.shift()).type||"COMMA"!==r.name)&&"KEYWORD"===r.type&&"WHERE"===r.name){e.unshift(r);break}}return jSQLParseWhereClause(jSQL.update(t).set(n),e,t)}function jSQLParseDeleteTokens(e){var t=e.shift(),n=jSQLParseQuery.validateTableNameToken(t),r=jSQL.deleteFrom(n);return r=jSQLParseWhereClause(r,e,n)}function jSQLParseDropTokens(e){var t=e.shift(),n=jSQLParseQuery.validateTableNameToken(t);return jSQL.dropTable(n)}function jSQLParseWhereClause(e,t,n){for(var r=[];t.length;){switch((l=t.shift()).type){case"KEYWORD":switch(l.name){case"WHERE":case"AND":e=e.where(jSQLParseQuery.validateColumnName(t.shift().value,n));break;case"LIKE":var i=t.shift().value;e="%"==i.substr(0,1)&&"%"==i.substr(i.length-1,1)?e.contains(i.substr(1,i.length-2)):"%"==i.substr(0,1)?e.endsWith(i.substr(1,i.length-1)):"%"==i.substr(i.length-1,1)?e.beginsWith(i.substr(0,i.length-1)):"?"===i?e.preparedLike():e.equals(i);break;case"OR":e=e.or(jSQLParseQuery.validateColumnName(t.shift().value,n));break;case"LIMIT":var a,s=t.shift().value,o=!1;if("SYMBOL"===(l=t.shift()).type&&"COMMA"===l.name?o=!0:t.unshift(l),o&&(a=s,s=t.shift().value),t.length&&!o)"KEYWORD"===(l=t.shift()).type&&"OFFSET"===l.name?a=t.shift().value:t.unshift(l);e=e.limit(s,a);break;case"ORDER BY":for(;t.length;){var l;if("SYMBOL"!==(l=t.shift()).type||"COMMA"!==l.name)try{var u=jSQLParseQuery.validateColumnName(l.value,n);r.push(u)}catch(e){t.unshift(l);break}}e=e.orderBy(r);break;case"ASC":if(!r.length)return _throw(new jSQL_Error("0026"));e=e.asc();break;case"DESC":if(!r.length)return _throw(new jSQL_Error("0027"));e=e.desc();break;default:return _throw(new jSQL_Parse_Error(l))}break;case"SYMBOL":switch(l.name){case"EQUALS":e=e.equals(t.shift().value);break;case"GREATER THAN":e=e.greaterThan(t.shift().value);break;case"LESS THAN":e=e.lessThan(t.shift().value);break;case"NOT EQUAL":e=e.doesNotEqual(t.shift().value);break;default:return _throw(new jSQL_Parse_Error(l))}break;default:return _throw(new jSQL_Parse_Error(l,"SYMBOL OR KEYWORD"))}}return e}function jSQLWhereClause(e){var d=this;d.context=e,d.pendingColumn="",d.conditions=[],d.LIMIT=0,d.OFFSET=0,d.finalConditions=[],d.sortColumn=[],d.sortDirection="ASC",d.isDistinct=!1,d.where=function(e){return""!==d.pendingColumn?_throw(new jSQL_Error("0042")):"string"!=typeof e?_throw(new jSQL_Error("0043")):(d.pendingColumn=e,d)},d.equals=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0044")):(d.conditions.push({col:d.pendingColumn,type:"=",value:e}),d.pendingColumn="",d)},d.preparedLike=function(){return""==d.pendingColumn?_throw(new jSQL_Error("0045")):(d.conditions.push({col:d.pendingColumn,type:"pl",value:"?"}),d.pendingColumn="",d)},d.doesNotEqual=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0046")):(d.conditions.push({col:d.pendingColumn,type:"!=",value:e}),d.pendingColumn="",d)},d.lessThan=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0047")):(d.conditions.push({col:d.pendingColumn,type:"<",value:e}),d.pendingColumn="",d)},d.greaterThan=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0048")):(d.conditions.push({col:d.pendingColumn,type:">",value:e}),d.pendingColumn="",d)},d.contains=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0049")):(d.conditions.push({col:d.pendingColumn,type:"%%",value:e}),d.pendingColumn="",d)},d.endsWith=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0050")):(d.conditions.push({col:d.pendingColumn,type:"%-",value:e}),d.pendingColumn="",d)},d.beginsWith=function(e){return""==d.pendingColumn?_throw(new jSQL_Error("0051")):(d.conditions.push({col:d.pendingColumn,type:"-%",value:e}),d.pendingColumn="",d)},d.and=function(e){return d.where(e)},d.or=function(e){return d.finalConditions.push(d.conditions),d.conditions=[],d.where(e)},d.limit=function(e,t){return d.LIMIT=parseInt(e),void 0!==t&&(d.OFFSET=parseInt(t)),d},d.orderBy=function(e){return Array.isArray(e)||(e=[e]),d.sortColumn=e,d},d.asc=function(){return""==d.sortColumn?_throw(new jSQL_Error("0052")):(d.sortDirection="ASC",d)},d.desc=function(){return""==d.sortColumn?_throw(new jSQL_Error("0053")):(d.sortDirection="DESC",d)},d.execute=function(e){if(void 0===e&&(e=[]),0<d.conditions.length&&d.finalConditions.push(d.conditions),0<e.length)for(var t=d.finalConditions.length;t--;)for(var n=d.finalConditions[t].length;n--;)if("?"===d.finalConditions[t][n].value&&"pl"===d.finalConditions[t][n].type){var r=e.pop();"%"==r.substr(0,1)&&"%"==r.substr(r.length-1,1)?(d.finalConditions[t][n].value=r.substr(1,r.length-2),d.finalConditions[t][n].type="%%"):"%"==r.substr(0,1)?(d.finalConditions[t][n].value=r.substr(1,r.length-1),d.finalConditions[t][n].type="%-"):"%"==r.substr(r.length-1,1)?(d.finalConditions[t][n].value=r.substr(0,r.length-1),d.finalConditions[t][n].type="-%"):(d.finalConditions[t][n].value=r,d.finalConditions[t][n].type="=")}else"?"===d.finalConditions[t][n].value&&0<e.length&&(d.finalConditions[t][n].value=e.pop());return d.context.execute(e)},d.fetch=function(e){return d.context.fetch(e)},d.fetchAll=function(e){return d.context.fetchAll(e)},d.getResultRowIndexes=function(){for(var e=[],t=0;t<d.context.table.data.length;t++)if(d.finalConditions.length<1)e.push(t);else{for(var n=!1,r=d.finalConditions.length;r--;){for(var i=d.finalConditions[r],a=!0,s=i.length;s--;){var o=i[s],l=d.context.table.colmap[o.col],u=d.context.table.data[t][l];switch(o.type){case">":(isNaN(parseFloat(u))||u<=o.value)&&(a=!1);break;case"<":(isNaN(parseFloat(u))||u>=o.value)&&(a=!1);break;case"=":u!=o.value&&(a=!1);break;case"!=":break;case"%%":u.indexOf(o.value)<0&&(a=!1);break;case"%-":u.indexOf(o.value)!=u.length-o.value.length&&(a=!1);break;case"-%":0!=u.indexOf(o.value)&&(a=!1)}if(!a)break}if(a){n=!0;break}}n&&e.push(t)}if(0<d.sortColumn.length&&(e.sort(function(i,a){return i=d.context.table.data[i],a=d.context.table.data[a],function e(t){if(void 0===d.sortColumn[t])return 0;var n=d.sortColumn[t],r=d.context.table.colmap[n];return i[r]<a[r]?-1:i[r]>a[r]?1:e(t+1)}(0)}),"DESC"==d.sortDirection&&e.reverse()),d.isDistinct){var h=[];for(t=0;t<e.length;t++)h.push(d.context.table.data[e[t]]);var c=[],f=[];for(t=0;t<h.length;t++){for(var p={},y=0;y<d.context.columns.length;y++){var m=d.context.columns[y].name||d.context.columns[y];p[m]=h[t][d.context.table.colmap[m]]}var S=JSON.stringify(p);-1<c.indexOf(S)||(f.push(e[t]),c.push(S))}e=f}return 0<d.LIMIT&&e.length>d.LIMIT&&(d.OFFSET>e.length&&(e=[]),d.LIMIT>e.length&&(d.LIMIT=e.length),e.length&&(e=e.slice(d.OFFSET,d.OFFSET+d.LIMIT))),e}}jSQLTable.prototype.initColumns=function(e,t){var n;for(this.columns=e,n=0;n<e.length;n++)this.types[n]=void 0===t[n]||void 0===t[n].type?{type:"ambi",args:[],default:void 0,null:!0}:t[n];for(n=this.types.length;n--;){var r=this.types[n].type.toUpperCase();if(!jSQL.types.exists(r))return _throw(new jSQL_Error("0007"));this.types[n].type=r}for(n=0;n<e.length;n++)this.colmap[e[n]]=n},jSQLTable.prototype.initKeys=function(e){for(var t,n=["primary","unique"],r=0;r<e.length;r++){if(!(t=e[r]).hasOwnProperty("column")||!Array.isArray(t.column)&&-1===this.columns.indexOf(t.column))return _throw(new jSQL_Error("0010"));if(Array.isArray(t.column))for(var i=0;i<t.column.length;i++)if(-1===this.columns.indexOf(t.column[i]))return _throw(new jSQL_Error("0010"));var a=t.hasOwnProperty("type")&&-1!==n.indexOf(t.type.toLowerCase())?t.type.toLowerCase():"unique";if("primary"===a&&!1!==this.keys.primary.column)return _throw(new jSQL_Error("0011"));"primary"===a&&(this.keys.primary.column=t.column),"unique"===a&&this.keys.unique.push({column:t.column,map:{}})}},jSQLTable.prototype.initAI=function(e){if(e){for(var t=Array.isArray(this.keys.primary.column)&&-1<this.keys.primary.column.indexOf(e),n=this.keys.primary.column===e,r=!1,i=this.keys.unique.length;i--;){var a=Array.isArray(this.keys.unique[i].column)&&-1<this.keys.unique[i].column.indexOf(e),s=this.keys.unique[i].column===e;(a||s)&&(r=!0)}if(!(t||n||r))return _throw(new jSQL_Error("0065"));if("INT"!==this.types[this.colmap[e]].type)return _throw(new jSQL_Error("0066"));this.auto_inc_col=e}},jSQLTable.prototype.renameColumn=function(e,t){if(void 0===e||"string"!=typeof t)return _throw(new jSQL_Error("0012"));if(this.columns.indexOf(e)<0)return _throw(new jSQL_Error("0013"));if(this.columns.splice(this.columns.indexOf(e),1,t),this.keys.primary.column===e&&(this.keys.primary.column=t),Array.isArray(this.keys.primary.column))for(var n=this.keys.primary.column.length;n--;)this.keys.primary.column[n]===e&&(this.keys.primary.column[n]=t);for(var r=this.keys.unique.length;r--;)if(this.keys.unique[r].column===e&&(this.keys.unique[r].column=t),Array.isArray(this.keys.unique[r].column))for(n=this.keys.unique[r].column.length;n--;)this.keys.unique[r].column[n]===e&&(this.keys.unique[r].column[n]=t);var i={};for(var a in this.colmap)this.colmap.hasOwnProperty(a)&&(a===e?i[t]=this.colmap[a]:i[a]=this.colmap[a]);this.colmap=i,this.auto_inc_col===e&&(this.auto_inc_col=t)},jSQLTable.prototype.addColumn=function(e,t,n){if(void 0!==n&&void 0!==n.type||(n={type:"AMBI",args:[],null:!0,default:void 0}),n.type=n.type.toUpperCase(),void 0===t&&(t=null),"string"!=typeof e){var r=this;e=function e(t){for(var n=0;n<r.columns.length;n++)if(r.columns[n]==="u"+t)return e(t+1);return"u"+t}(0)}this.columns.push(e);for(var i=this.data.length;i--;)this.data[i].push(t);if(this.colmap[e]=this.columns.length-1,!jSQL.types.exists(n.type))return _throw(new jSQL_Error("0007"));this.types.push(n)},jSQLTable.prototype.loadData=function(e){if(!Array.isArray(e))return _throw(new jSQL_Error("0014"));for(var t=e.length;t--;)this.insertRow(e[t])},jSQLTable.prototype.normalizeInsertRowData=function(e){var t,n=[];if(Array.isArray(e)){for(;e.length>this.columns.length;)this.addColumn();for(;e.length<this.columns.length;)e.push(null);for(t=0;t<e.length;t++)n.push(e[t]);for(;n.length<this.columns.length;)n.push(null)}else{if("object"!=typeof e)return _throw(new jSQL_Error("0015"));for(t=0;t<this.columns.length;t++)void 0===e[this.columns[t]]&&(e[this.columns[t]]=null);var r=this;for(var i in e)if(!e.hasOwnProperty(i))continue;if(function(e){for(;e--;)if(r.columns[e]===i)return 0;return 1}(this.columns.length))if(-1<this.columns.indexOf("u0")){this.renameColumn("u0",i);for(;-1<this.columns.indexOf("u1");)this.renameColumn("u1","u0")}else this.addColumn(i);for(t=0;t<this.columns.length;t++)n.push(e[this.columns[t]])}return n},jSQLTable.prototype.insertRow=function(e,t){for(var n=this.normalizeInsertRowData(e),r=n.length;r--;)this.columns[r]===this.auto_inc_col&&(n[r]||(n[r]=this.auto_inc_seq,this.auto_inc_seq++),n[r]>=this.auto_inc_seq&&(this.auto_inc_seq=parseInt(n[r],10)+1)),n[r]=this.normalizeColumnStoreValue(this.columns[r],n[r]);if(!1===this.updateKeysOnInsert(n,t))return!1;this.data.push(n)},jSQLTable.prototype.updateKeysOnInsert=function(e,t){if(this.keys.primary.column){for(var n,r=Array.isArray(this.keys.primary.column)?this.keys.primary.column:[this.keys.primary.column],i=[],a=0;a<r.length;a++){n=r[a];var s=this.colmap[n];if(null===e[s])return!0!==t&&_throw(new jSQL_Error("0016"));i.push(e[s])}if(i=JSON.stringify(i),this.keys.primary.map.hasOwnProperty(i))return!0!==t&&_throw(new jSQL_Error("0017"));this.keys.primary.map[i]=this.data.length}for(var o,l=0;l<this.keys.unique.length;l++){o=this.keys.unique[l];for(var u,h=Array.isArray(o.column)?o.column:[o.column],c=[],f=0;f<h.length;f++){u=h[f];var p=this.colmap[u];if(null===e[p])return!0!==t&&_throw(new jSQL_Error("0018"));c.push(e[p])}if(c=JSON.stringify(c),o.map.hasOwnProperty(c))return!0!==t&&_throw(new jSQL_Error("0019"));this.keys.unique[l].map[c]=this.data.length}},jSQLTable.prototype.normalizeColumnStoreValue=function(e,t){var n=this.types[this.colmap[e]];if(-1<[!1,void 0].indexOf(n.null)&&null===t)return _throw(new jSQL_Error("0072"));null===t&&void 0!==n.default&&(t=n.default);var r=jSQL.types.getByType(n.type.toUpperCase()).serialize(t,n.args);return!isNaN(parseFloat(r))&&isFinite(r)||"string"==typeof r?r:_throw(new jSQL_Error("0020"))},jSQLTable.prototype.normalizeColumnFetchValue=function(e,t){var n=this.types[this.colmap[e]];return jSQL.types.getByType(n.type.toUpperCase()).unserialize(t,n.args)},jSQLLexer.prototype.getNextToken=function(){for(var e,t=0;t<jSQLLexer.token_types.length;t++)for(;null!=(e=jSQLLexer.token_types[t].pattern.exec(this.input));)if(e.index===this.pos){var n=new jSQLToken(this.pos,e[0],t);return this.pos+=n.length,n}return!1},jSQLLexer.prototype.getTokens=function(){if(this.tokens.length)return this.tokens;this.pos=0,this.tokens=[];for(var e,t=["COMMENT","WHITESPACE"];0!=(e=this.getNextToken());)-1===t.indexOf(e.type)&&this.tokens.push(e);if(this.pos!==this.input.length){var n;if(this.tokens.length){var r=this.tokens[this.tokens.length-1];n=r.input_pos+r.length}else n=0;return console.log(this.tokens.map(function(e){return e.literal}).join(" ")),_throw(new jSQL_Lexer_Error(n,this.input))}return this.tokens},jSQLLexer.token_types=[{pattern:/"(?:[^"\\]|\\.)*"/g,type:"STRING",name:"DQ STRING"},{pattern:/'(?:[^'\\]|\\.)*'/g,type:"STRING",name:"SQ STRING"},{pattern:/--.*[\n\r$]/g,type:"COMMENT",name:"SINGLE LINE COMMENT"},{pattern:/\/\*([\s\S]*?)\*\//g,type:"COMMENT",name:"MULTI LINE COMMENT"},{pattern:/\r?\n|\r/g,type:"WHITESPACE",name:"LINEBREAK"},{pattern:/[ \t]/g,type:"WHITESPACE",name:"WHITESPACE"},{pattern:/[?-]?\d+.\.\d+/g,type:"NUMBER",name:"FLOAT"},{pattern:/[?-]?\d+/g,type:"NUMBER",name:"INTEGER"},{pattern:/if not exists/gi,type:"QUALIFIER",name:"IF NOT EXISTS"},{pattern:/!=/gi,type:"SYMBOL",name:"NOT EQUAL"},{pattern:/<>/gi,type:"SYMBOL",name:"NOT EQUAL"},{pattern:/\(/gi,type:"SYMBOL",name:"LEFT PEREN"},{pattern:/\)/gi,type:"SYMBOL",name:"RIGHT PEREN"},{pattern:/,/gi,type:"SYMBOL",name:"COMMA"},{pattern:/\?/gi,type:"SYMBOL",name:"QUESTION MARK"},{pattern:/,/gi,type:"SYMBOL",name:"COMMA"},{pattern:/\*/gi,type:"SYMBOL",name:"ASTERISK"},{pattern:/;/gi,type:"SYMBOL",name:"SEMICOLON"},{pattern:/=/gi,type:"SYMBOL",name:"EQUALS"},{pattern:/>/gi,type:"SYMBOL",name:"GREATER THAN"},{pattern:/</gi,type:"SYMBOL",name:"LESS THAN"},{pattern:/primary key/gi,type:"KEYWORD",name:"PRIMARY KEY"},{pattern:/unique key/gi,type:"KEYWORD",name:"UNIQUE KEY"},{pattern:/values(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"VALUES"},{pattern:/temporary(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"TEMPORARY"},{pattern:/from(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"FROM"},{pattern:/auto_increment(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"AUTO_INCREMENT"},{pattern:/ignore(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"IGNORE"},{pattern:/into(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"INTO"},{pattern:/all(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"ALL"},{pattern:/distinct(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"DISTINCT"},{pattern:/distinctrow(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"DISTINCTROW"},{pattern:/where(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"WHERE"},{pattern:/and(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"AND"},{pattern:/like(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"LIKE"},{pattern:/order by/gi,type:"KEYWORD",name:"ORDER BY"},{pattern:/or(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"OR"},{pattern:/limit(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"LIMIT"},{pattern:/offset(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"OFFSET"},{pattern:/asc(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"ASC"},{pattern:/desc(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"DESC"},{pattern:/set(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"SET"},{pattern:/not null/gi,type:"KEYWORD",name:"NOT NULL"},{pattern:/null(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"NULL"},{pattern:/default(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"DEFAULT"},{pattern:/table(?=[\s(`,]|$)/gi,type:"KEYWORD",name:"TABLE"},{pattern:/create(?=[\s(`,]|$)/gi,type:"DIRECTIVE",name:"CREATE"},{pattern:/insert(?=[\s(`,]|$)/gi,type:"DIRECTIVE",name:"INSERT"},{pattern:/delete from/gi,type:"DIRECTIVE",name:"DELETE FROM"},{pattern:/drop table/gi,type:"DIRECTIVE",name:"DROP TABLE"},{pattern:/update(?=[\s(`,]|$)/gi,type:"DIRECTIVE",name:"UPDATE"},{pattern:/select(?=[\s(`,]|$)/gi,type:"DIRECTIVE",name:"SELECT"},{pattern:/`[0-9a-zA-Z$_]*[0-9a-zA-Z$_]`/gi,type:"IDENTIFIER",name:"QTD IDENTIFIER"},{pattern:/[0-9a-zA-Z$_]*[0-9a-zA-Z$_]/gi,type:"IDENTIFIER",name:"UNQTD IDENTIFIER"}],jSQLParseQuery.validateTableNameToken=function(e){for(var t in jSQL.tables)if(jSQL.tables.hasOwnProperty(t)&&e.value.toUpperCase()==t.toUpperCase())return t;return _throw(new jSQL_Error("0021"))},jSQLParseQuery.validateColumnName=function(e,t){for(var n=jSQL.tables[t].columns.length;n--;)if(e.toUpperCase()===jSQL.tables[t].columns[n].toUpperCase())return jSQL.tables[t].columns[n];return _throw(new jSQL_Error("0013"))};var API={cookieAPI:function(){var i=this,o=function(e,t){var n=new Date;n.setTime(n.getTime()+864e9);var r="expires="+n.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"},l=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""};i.init=function(e,t){"function"!=typeof t&&(t=function(){});for(var n,r=0;n=e[r];r++)i.insert(n.name,n.rows);t()},i.insert=function(e,t,n){var r;"function"!=typeof n&&(n=function(){});try{r=JSON.parse(l(e))}catch(e){r=[]}Array.isArray(r)||(r=[]);for(var i=0;i<t.length;i++)r.push(t[i]);var a=JSON.stringify(r);if(o(e,a),l(e)!==a){for(var s=100;s--&&l(e)!==a;)r.pop(),a=JSON.stringify(r),o(e,a);return _throw(new jSQL_Error("0067"))}n()},i.delete=function(e,t){"function"!=typeof t&&(t=function(){}),o(e,JSON.stringify([])),t()},i.select=function(e,t){"function"!=typeof t&&(t=function(){}),t(JSON.parse(l(e)))}},localStorageAPI:function(){var i=this;i.init=function(e,t){"function"!=typeof t&&(t=function(){});for(var n,r=0;n=e[r];r++)i.insert(n.name,n.rows);t()},i.insert=function(e,t,n){var r;"function"!=typeof n&&(n=function(){});try{r=JSON.parse(localStorage.getItem(e))}catch(e){r=[]}Array.isArray(r)||(r=[]);for(var i=0;i<t.length;i++)r.push(t[i]);var a=JSON.stringify(r);if(localStorage.setItem(e,a),localStorage.getItem(e)!==a){for(var s=100;s--&&localStorage.getItem(e)!==a;)r.pop(),a=JSON.stringify(r),localStorage.setItem(e,a);return _throw(new jSQL_Error("0067"))}n()},i.delete=function(e,t){"function"!=typeof t&&(t=function(){}),localStorage.setItem(e,JSON.stringify([])),t()},i.select=function(e,t){"function"!=typeof t&&(t=function(){}),t(JSON.parse(localStorage.getItem(e)))}},nodeAPI:function(){var e=this;e.db=null;var s=require("fs");e.init=function(e,t){if("function"!=typeof t&&(t=function(){}),!s.existsSync(".jsqldatastore"))try{s.writeFileSync(".jsqldatastore",JSON.stringify(e))}catch(e){return _throw(new jSQL_Error("0064"))}t()},e.insert=function(e,t,n){"function"!=typeof n&&(n=function(){});var r,i=JSON.parse(s.readFileSync(".jsqldatastore",{encoding:"utf8"}));for(r=i.length;r--&&!i[r].name===e;);for(var a=0;a<t.length;a++)i[r].rows.push(t[a]);s.writeFileSync(".jsqldatastore",JSON.stringify(i)),n()},e.delete=function(e,t){"function"!=typeof t&&(t=function(){});for(var n=JSON.parse(s.readFileSync(".jsqldatastore",{encoding:"utf8"})),r=n.length;r--;)if(!n[r].name!==e){n[r].rows=[];break}s.writeFileSync(".jsqldatastore",JSON.stringify(n)),t()},e.select=function(e,t){"function"!=typeof t&&(t=function(){});for(var n=JSON.parse(s.readFileSync(".jsqldatastore",{encoding:"utf8"})),r=n.length;r--;)if(!n[r].name!==e)return void t(n[r].rows)}},indexedDBAPI:function(){var s,u,h=this;h.db=null,h.init=function(a,n){"function"!=typeof n&&(n=function(){});try{s=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,u=window.hasOwnProperty("IDBTransaction")?window.IDBTransaction:window.webkitIDBTransaction,window.hasOwnProperty("IDBKeyRange")?window.IDBKeyRange:window.webkitIndexedDB}catch(e){return _throw(new jSQL_Error("0057"))}if(!s)return _throw(new jSQL_Error("0057"));var r=1,e=window.location.href.replace(/\W+/g,""),t=s.open("jSQL_"+e,r),i=function(){for(var e=a.length;e--;)h.db.objectStoreNames.contains(a[e].name)&&h.db.deleteObjectStore(a[e].name),h.db.createObjectStore(a[e].name,{keyPath:"_id",autoIncrement:!0});var r=!1,i=setInterval(function(){if(!r){r=!0;try{for(var e=a.length;e--;){var t=a[e].name,n=null==a[e].rows?[]:a[e].rows;h.insert(t,n)}clearInterval(i)}catch(e){0,r=!1}}},10)};t.onsuccess=function(e){var t;h.db=e.target.result,r=String(r),h.db.setVersion&&r!==h.db.version?((t=h.db.setVersion(r)).onfailure=function(){return _throw(new jSQL_Error("0059"))},t.onsuccess=function(e){i(),t.result.oncomplete=function(){n()}}):n()},t.onupgradeneeded=function(e){h.db=e.target.result,i()},t.onerror=function(e){return _throw(new jSQL_Error("0060"))}},h.insert=function(e,t,n){"function"!=typeof n&&(n=function(){});var r,i,a,s=h.db.transaction([e],void 0===u.READ_WRITE?"readwrite":u.READ_WRITE),o=t.length,l=function(){0===(o-=1)&&n(o)};for(i in s.onerror=function(){return _throw(new jSQL_Error("0061"))},r=s.objectStore(e),t)t.hasOwnProperty(i)&&((a=r.add(t[i])).onsuccess=l,a.onerror=function(){return _throw(new jSQL_Error("0062"))})},h.delete=function(e,t){"function"!=typeof t&&(t=function(){});var n,r=h.db.transaction([e],void 0===u.READ_WRITE?"readwrite":u.READ_WRITE);r.onerror=function(){return _throw(new jSQL_Error("0061"))},(n=r.objectStore(e).clear()).onerror=function(){return _throw(new jSQL_Error("0062"))},n.onsuccess=t},h.select=function(e,n){"function"!=typeof n&&(n=function(){});var t,r=h.db.transaction([e],void 0===u.READ_ONLY?"readonly":u.READ_ONLY),i=[];r.onerror=function(){return _throw(new jSQL_Error("0061"))};var a=!((t=r.objectStore(e).openCursor()).onerror=function(){return _throw(new jSQL_Error("0062"))});t.onsuccess=function(e){if(!a){var t=e.target.result;if(!t)return a=!0,void n(i);i.push(t.value),t.continue()}}}},WebSQLAPI:function(){var u=this;u.db=null;var s=function(t,n,s,r){var i,a,o;"function"!=typeof s&&(s=function(){}),"function"!=typeof r&&(r=function(){return _throw(new jSQL_Error("0054"))}),Array.isArray(n[0])||(n=[n]),o=n.length;var l=function(e,t){var n,r,i=[];if(!(o-=1)){for(n=0,r=t.rows.length;n<r;n+=1){var a=t.rows.item(n).json;i.push(a)}s(i)}};u.db.transaction(function(e){for(i=0,a=n.length;i<a;i+=1)e.executeSql(t,n[i],l,r)})};u.init=function(t,e){"function"!=typeof e&&(e=function(){});try{var n=window.location.href.replace(/\W+/g,"");u.db=openDatabase("jSQL_"+n,"1.0","jSQL "+n,5242880)}catch(e){return _throw(new jSQL_Error("0056"))}s("SELECT COUNT(*) FROM "+t[0].name,[],null,function(){!function(){try{for(var e=t.length;e--;)!function(e,t){s("DROP TABLE IF EXISTS "+e,[],function(){s("CREATE TABLE IF NOT EXISTS "+e+"(json TEXT)",[],function(){u.insert(e,t)})})}(t[e].name,t[e].rows)}catch(e){return _throw(new jSQL_Error("0055"))}}()}),e()},u.insert=function(e,t,n){"function"!=typeof n&&(n=function(){});var r,i,a=[];for(0===t.length&&n(),r=0,i=t.length;r<i;r+=1)a[r]=[JSON.stringify(t[r])];s("INSERT INTO "+e+" (json) VALUES (?);",a,n)},u.delete=function(e,t){"function"!=typeof t&&(t=function(){}),s("DELETE FROM "+e,[],t)},u.select=function(e,r){s("SELECT json FROM "+e,[],function(e){for(var t=[],n=e.length;n--;)t.push(JSON.parse(e[n]));r(t)})}}},persistenceManager=new function(){var l=this;l.api=null,l.error=!1,l.loaded=!1,l.isLoading=!1,l.initiated=!1,l.loadingCallbacks=[],l.api_default_priority=["indexedDBAPI","WebSQLAPI","localStorageAPI","cookieAPI"],l.api_user_priority=[],l.setApiPriority=function(){l.api_user_priority=1===arguments.length?[arguments[0]]:Array.apply(null,arguments)},l.getApi=function(){var t=!1;try{t=l.api.constructor.name}catch(e){t=!1}return t},l.commit=function(e){if("function"==typeof e&&(e=function(){}),!1!==l.error)return _throw(l.error);var t=[];for(var n in jSQL.tables)if(jSQL.tables.hasOwnProperty(n)&&!jSQL.tables[n].isTemp){for(var r=[],i=0;i<jSQL.tables[n].keys.unique.length;i++)r.push({column:jSQL.tables[n].keys.unique[i].column,type:"unique"});jSQL.tables[n].keys.primary.column&&r.push({column:jSQL.tables[n].keys.primary.column,type:"primary"});var a=jSQL.select("*").from(n).execute().fetchAll();a.length||t.push({table:n,data:JSON.stringify(jSQL.tables[n].columns),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(r),ai_col:jSQL.tables[n].auto_inc_col});for(i=a.length;i--;){var s=a[i];for(var o in s)s.hasOwnProperty(o)&&(s[o]=jSQL.tables[n].normalizeColumnStoreValue(o,s[o]));t.push({table:n,data:JSON.stringify(s),colTypes:JSON.stringify(jSQL.tables[n].types),keys:JSON.stringify(r),ai_col:jSQL.tables[n].auto_inc_col})}}l.api.delete("jSQL_data_schema",function(){l.api.insert("jSQL_data_schema",t,e)})},l.load=function(e){if("function"!=typeof e&&(e=function(){}),l.loadingCallbacks.push(e),l.loaded)for(;l.loadingCallbacks.length;)l.loadingCallbacks.shift()();l.isLoading||(l.isLoading=!0,l.initiated?l.rollback(function(){for(l.isLoading=!1,l.loaded=!0;l.loadingCallbacks.length;)l.loadingCallbacks.shift()()}):l.init(function(){l.rollback(function(){for(l.isLoading=!1,l.loaded=!0;l.loadingCallbacks.length;)l.loadingCallbacks.shift()()})}))},l.rollback=function(u){"function"!=typeof u&&(u=function(){}),mute_jsql_errors=!0,function t(n){try{l.api.select("jSQL_data_schema",function(e){if(jSQL.tables={},0===e.length)return mute_jsql_errors=!1,void u();for(var t=e.length;t--;){var n=e[t].table,r=JSON.parse(e[t].data),i=JSON.parse(e[t].colTypes),a=JSON.parse(e[t].keys),s=e[t].ai_col;if(void 0===jSQL.tables[n])if(Array.isArray(r))o=r,jSQL.createTable(n,o,i,a,s).execute();else{var o=[];for(var l in r)r.hasOwnProperty(l)&&o.push(l);jSQL.createTable(n,o,i,a,s).execute()}if(!Array.isArray(r)){for(var l in r)r.hasOwnProperty(l)&&(r[l]=jSQL.tables[n].normalizeColumnFetchValue(l,r[l]));jSQL.tables[n].insertRow(r,!0)}}mute_jsql_errors=!1,u()})}catch(e){if(500<n){for(mute_jsql_errors=!1,l.isLoading=!1,l.loaded=!0;l.loadingCallbacks.length;)l.loadingCallbacks.shift()();return}setTimeout(function(){t(n+1)},10)}}(0)},l.init=function(n){if("function"!=typeof n&&(n=function(){}),l.initiated=!0,isNode)l.api=new API.nodeAPI,l.api.init([{name:"jSQL_data_schema",rows:[]}],n);else{var r=l.api_user_priority.concat(l.api_default_priority),i=[],a=!1;!function e(t){if(t>=r.length&&!a)return _throw(new jSQL_Error("0063"));if(-1===l.api_default_priority.indexOf(r[t]))return e(1+t);if(-1<i.indexOf(r[t]))return e(1+t);try{l.api=new API[r[t]],l.api.init([{name:"jSQL_data_schema",rows:[]}],n),a=!0}catch(e){a=!1}a||e(1+t)}(0)}}};function createTable(e,t,n,r,i){var a=void 0===t&&void 0===n&&"object"==typeof e&&void 0===r,s=Array.isArray(t)&&void 0===n&&"object"==typeof e&&void 0===r;if(a||s)for(var o in s&&(r=void 0===t?[]:t),void 0===r&&(r=[]),t=[],n=[],e)if(e.hasOwnProperty(o)){var l=e[o];e=o;for(var u=0;u<l.length;u++){var h=l[u].name;t.push(h),n.push({type:l[u].type,args:void 0===l[u].args?[]:l[u].args,default:void 0===l[u].default?void 0:l[u].default,null:void 0===l[u].null||l[u].null}),l[u].hasOwnProperty("key")&&Array.isArray(r)&&r.push({column:l[u].name,type:l[u].key}),l[u].hasOwnProperty("auto_increment")&&!0===l[u].auto_increment&&(i=l[u].name)}break}return Array.isArray(t)||(t=[t]),void 0===r&&(r=[]),Array.isArray(r)||(r=[r]),new jSQLQuery("CREATE").init(e,t,n,r,i)}function select(e){return Array.isArray(e)||(e=[e]),new jSQLQuery("SELECT").init(e)}function update(e){return new jSQLQuery("UPDATE").init(e)}function insertInto(e){return new jSQLQuery("INSERT").init(e)}function dropTable(e){return new jSQLQuery("DROP").init(e)}function deleteFrom(e){return new jSQLQuery("DELETE").init(e)}function tokenize(e){return new jSQLLexer(e).getTokens()}function jSQLReset(){jSQL.tables={},jSQL.commit()}function jSQLMinifier(e){for(var t=new jSQLLexer(e).getTokens(),n=[],r=0;r<t.length;r++)n.push(t[r].literal);return n.join(" ")}function removeQuotes(e){for(var t=['"',"'","`"],n=t.length;n--;)if(e.substr(0,1)==t[n]&&e.substr(e.length-1,1)==t[n])return e.substr(1,e.length-2);return e}function jsql_export(e,t){e=void 0===e||!!e,t=t||[];var n=[];for(var r in jSQL.tables)if(jSQL.tables.hasOwnProperty(r)&&(!t.length||~t.indexOf(r))){if(e){for(var i=[],a=0;a<jSQL.tables[r].columns.length;a++){var s=[];s.push("`"+jSQL.tables[r].columns[a]+"` ");var o="";jSQL.tables[r].types[a].args.length&&(o=JSON.stringify(jSQL.tables[r].types[a].args).trim().slice(1,-1)),s.push(jSQL.tables[r].types[a].type+"("+o+") "),s.push(jSQL.tables[r].types[a].null?"NULL ":"NOT NULL "),jSQL.tables[r].types[a].default&&s.push("DEFAULT "+JSON.stringify(jSQL.tables[r].types[a].default)+" "),jSQL.tables[r].columns[a]===jSQL.tables[r].auto_inc_col&&s.push("AUTO_INCREMENT"),i.push("\n\t"+s.join("").trim())}if(jSQL.tables[r].keys.primary.column){if(s=[],Array.isArray(jSQL.tables[r].keys.primary.column))for(a=0;a<jSQL.tables[r].keys.primary.column.length;a++)s.push("`"+jSQL.tables[r].keys.primary.column[a]+"`");else s.push("`"+jSQL.tables[r].keys.primary.column+"`");i.push("\n\tPRIMARY KEY ("+s.join(",")+")")}if(jSQL.tables[r].keys.unique.length)for(var l=0;l<jSQL.tables[r].keys.unique.length;l++){if(s=[],Array.isArray(jSQL.tables[r].keys.unique[l].column))for(a=0;a<jSQL.tables[r].keys.unique[l].column.length;a++)s.push("`"+jSQL.tables[r].keys.unique[l].column[a]+"`");else s.push("`"+jSQL.tables[r].keys.unique[l].column+"`");i.push("\n\tUNIQUE KEY ("+s.join(",")+")")}n.push("CREATE TABLE `"+r+"` ("+i.join(",")+"\n)")}for(a=0;a<jSQL.tables[r].data.length;a++){var u=JSON.stringify(jSQL.tables[r].data[a]).trim().slice(1,-1).replace(/"jsqlNull"/g,"null");n.push("INSERT INTO `"+r+"` (`"+jSQL.tables[r].columns.join("`,`")+"`) VALUES ("+u+")")}}var h=["-- Exported by jSQL v"+jSQL.version+" "+(new Date).toUTCString()],c="-".repeat(h[0].length);return h.unshift(c),h.push(c),h.join("\n")+"\n"+n.join(";\n")}function jsql_import(e){e=e.split(";\n");for(var t=0;t<e.length;t++)jSQL.query(e[t]).execute()}return{version:"4.0.34",tables:{},query:jSQLParseQuery,createTable:createTable,dropTable:dropTable,select:select,update:update,deleteFrom:deleteFrom,insertInto:insertInto,types:new jSQLDataTypeList,load:persistenceManager.load,onError:onError,reset:jSQLReset,minify:jSQLMinifier,commit:persistenceManager.commit,rollback:persistenceManager.rollback,setApiPriority:persistenceManager.setApiPriority,getApi:persistenceManager.getApi,tokenize:tokenize,export:jsql_export,import:jsql_import}}();isNode?module.exports=jSQL:window.jSQL=jSQL}();